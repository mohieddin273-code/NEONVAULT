<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEON VAULT 2.0</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;user-select:none}
:root{
--nc:#00fff5;--np:#ff006e;--ng:#ffd700;--ngr:#39ff14;
--npu:#bf00ff;--db:#050510;--cb:rgba(10,10,30,0.95);
--gl:rgba(255,255,255,0.04);--br:rgba(0,255,245,0.2);
}
body{background:var(--db);color:#fff;font-family:'Rajdhani',sans-serif;overflow-x:hidden;min-height:100vh}
canvas#bg{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none}
::-webkit-scrollbar{width:4px;background:transparent}
::-webkit-scrollbar-thumb{background:rgba(0,255,245,0.3);border-radius:2px}

.hud{position:fixed;top:0;left:0;right:0;z-index:100;display:flex;align-items:center;justify-content:space-between;
padding:10px 20px;background:rgba(5,5,16,0.95);backdrop-filter:blur(20px);
border-bottom:1px solid var(--br);box-shadow:0 0 40px rgba(0,255,245,0.12);flex-wrap:wrap;gap:8px}
.hud-left{display:flex;align-items:center;gap:12px}
.hud-logo{font-family:'Orbitron',monospace;font-size:16px;font-weight:900;
background:linear-gradient(90deg,var(--nc),var(--np));-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:3px}
.active-char-mini{display:flex;align-items:center;gap:6px;padding:4px 10px;border-radius:20px;
border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.03);cursor:pointer}
.active-char-mini svg{width:28px;height:28px}
.active-char-mini .char-label{font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,255,255,0.6)}
.active-char-mini .char-mult{font-family:'Orbitron',monospace;font-size:11px;font-weight:700}
.hud-stats{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.sp{display:flex;align-items:center;gap:6px;padding:5px 12px;border-radius:999px;border:1px solid;
font-family:'Orbitron',monospace;font-size:11px;font-weight:700;background:rgba(0,0,0,0.4);transition:all 0.3s}
.sp.cash{border-color:var(--ng);color:var(--ng);box-shadow:0 0 12px rgba(255,215,0,0.15)}
.sp.btc{border-color:var(--np);color:var(--np);box-shadow:0 0 12px rgba(255,0,110,0.15)}
.sp.dy{border-color:var(--nc);color:var(--nc);box-shadow:0 0 12px rgba(0,255,245,0.15)}
.sp.inc{border-color:var(--ngr);color:var(--ngr);box-shadow:0 0 12px rgba(57,255,20,0.15)}
.sp .ico{font-size:14px}
.swf{animation:swf 0.5s ease}
@keyframes swf{0%{transform:scale(1)}40%{transform:scale(1.18)}100%{transform:scale(1)}}
.music-btn{padding:5px 12px;border-radius:999px;border:1px solid rgba(255,255,255,0.2);
background:rgba(255,255,255,0.04);color:rgba(255,255,255,0.6);cursor:pointer;
font-family:'Orbitron',monospace;font-size:10px;font-weight:700;transition:all 0.25s}
.music-btn.on{border-color:var(--npu);color:var(--npu);background:rgba(191,0,255,0.08);box-shadow:0 0 12px rgba(191,0,255,0.2)}

.nb.s2{border-color:rgba(255,215,0,0.5);color:var(--ng);background:rgba(255,215,0,0.06);animation:s2pulse 2s infinite}
@keyframes s2pulse{0%,100%{box-shadow:0 0 0 0 rgba(255,215,0,0.3)}50%{box-shadow:0 0 14px 3px rgba(255,215,0,0.2)}}
.nb.s2.active{box-shadow:0 0 20px rgba(255,215,0,0.35)}
.s2-gate{position:relative;overflow:hidden;border-radius:24px;margin:0 20px 30px;
background:linear-gradient(135deg,rgba(20,10,5,0.98),rgba(40,20,0,0.98));
border:2px solid rgba(255,215,0,0.25);padding:60px 40px;text-align:center;
box-shadow:0 0 80px rgba(255,165,0,0.08),inset 0 1px 0 rgba(255,215,0,0.08)}
.s2-gate::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;
background:linear-gradient(90deg,transparent,var(--ng),transparent);animation:scan 3s linear infinite}
@keyframes scan{0%{opacity:0.4}50%{opacity:1}100%{opacity:0.4}}
.s2-gate-title{font-family:'Orbitron',monospace;font-size:32px;font-weight:900;
background:linear-gradient(135deg,#ffd700,#ff8c00,#ffd700);-webkit-background-clip:text;-webkit-text-fill-color:transparent;
margin-bottom:8px;letter-spacing:4px}
.s2-gate-sub{font-family:'Orbitron',monospace;font-size:12px;color:rgba(255,215,0,0.5);letter-spacing:3px;margin-bottom:32px}
.s2-progress-bar{width:100%;max-width:500px;height:12px;background:rgba(255,255,255,0.06);border-radius:999px;margin:0 auto 12px;overflow:hidden;border:1px solid rgba(255,215,0,0.15)}
.s2-progress-fill{height:100%;background:linear-gradient(90deg,#b8860b,#ffd700,#ff8c00);border-radius:999px;transition:width 0.5s;box-shadow:0 0 12px rgba(255,215,0,0.4)}
.s2-price-tag{font-family:'Orbitron',monospace;font-size:26px;font-weight:900;color:var(--ng);margin:16px 0}
.s2-tabs{display:flex;gap:8px;justify-content:center;margin-bottom:20px;flex-wrap:wrap;padding:0 20px}
.s2-tab{padding:9px 22px;border-radius:10px;border:1px solid rgba(255,215,0,0.2);background:rgba(255,215,0,0.04);
color:rgba(255,215,0,0.5);cursor:pointer;font-family:'Orbitron',monospace;font-size:11px;font-weight:700;transition:all 0.22s}
.s2-tab.active{border-color:var(--ng);color:var(--ng);background:rgba(255,215,0,0.1);box-shadow:0 0 18px rgba(255,215,0,0.15)}
.s2-content{display:none}.s2-content.active{display:block}
.s2-sec-title{text-align:center;font-family:'Orbitron',monospace;font-size:20px;font-weight:900;
color:var(--ng);margin-bottom:20px;letter-spacing:3px;padding:0 20px}
.gp.s2-card::before{background:linear-gradient(90deg,transparent,var(--ng),transparent)}
.gp.s2-card{border-color:rgba(255,215,0,0.2);box-shadow:0 8px 40px rgba(0,0,0,0.6),inset 0 1px 0 rgba(255,215,0,0.06)}
.pt.gold{color:var(--ng)}
.q-asset{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;
background:rgba(255,215,0,0.04);border:1px solid rgba(255,215,0,0.12);margin-bottom:8px;transition:border-color 0.3s}
.q-asset:hover{border-color:rgba(255,215,0,0.25)}
.q-ico{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.q-info{flex:1}
.q-ticker{font-family:'Orbitron',monospace;font-size:13px;font-weight:900}
.q-price{font-family:'Orbitron',monospace;font-size:11px;color:rgba(255,255,255,0.5)}
.q-chg{font-family:'Orbitron',monospace;font-size:10px;font-weight:700}
.q-chg.up{color:#39ff14}.q-chg.dn{color:#f44}
.q-actions{display:flex;gap:5px;align-items:center}
.heist-card{padding:16px;border-radius:14px;border:1px solid rgba(255,100,0,0.2);background:rgba(255,50,0,0.04);
margin-bottom:12px;cursor:pointer;transition:all 0.22s;position:relative;overflow:hidden}
.heist-card:hover{border-color:rgba(255,150,0,0.4);box-shadow:0 0 20px rgba(255,100,0,0.1)}
.heist-card.selected{border-color:#ff6600;background:rgba(255,100,0,0.08);box-shadow:0 0 24px rgba(255,100,0,0.15)}
.heist-name{font-family:'Orbitron',monospace;font-size:14px;font-weight:900;color:#ff8c00;margin-bottom:4px}
.heist-meta{display:flex;gap:16px;font-size:11px;font-family:'Orbitron',monospace;color:rgba(255,255,255,0.45);margin-bottom:8px}
.heist-risk-bar{height:6px;border-radius:3px;background:rgba(255,255,255,0.07);overflow:hidden;margin-bottom:4px}
.heist-risk-fill{height:100%;border-radius:3px;transition:width 0.5s}
.heist-log{background:rgba(0,0,0,0.5);border-radius:10px;padding:14px;font-family:'Orbitron',monospace;font-size:10px;
line-height:1.8;color:rgba(255,255,255,0.6);margin-top:10px;min-height:80px;border:1px solid rgba(255,100,0,0.1)}
.heist-log .hl{color:#ff8c00}.heist-log .hg{color:#39ff14}.heist-log .hr{color:#f44}
.arena-bracket{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px}
.arena-slot{padding:12px;border-radius:10px;border:1px solid rgba(255,0,110,0.2);background:rgba(255,0,50,0.04);
text-align:center;font-family:'Orbitron',monospace;font-size:10px;transition:all 0.25s}
.arena-slot.you{border-color:var(--nc);background:rgba(0,255,245,0.06);color:var(--nc)}
.arena-slot.alive{border-color:rgba(255,255,255,0.2);color:rgba(255,255,255,0.5)}
.arena-slot.dead{border-color:rgba(255,0,0,0.1);color:rgba(255,0,0,0.3);text-decoration:line-through;opacity:0.4}
.arena-slot.winner{border-color:var(--ng);background:rgba(255,215,0,0.08);color:var(--ng);box-shadow:0 0 14px rgba(255,215,0,0.15)}
.arena-prize{text-align:center;font-family:'Orbitron',monospace;font-size:22px;font-weight:900;color:var(--ng);margin:10px 0}
.arena-round-badge{display:inline-block;padding:4px 14px;border-radius:999px;font-family:'Orbitron',monospace;
font-size:11px;font-weight:700;background:rgba(255,0,110,0.15);border:1px solid rgba(255,0,110,0.3);color:var(--np);margin-bottom:12px}
.unlock-s2-overlay{position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.95);display:none;
flex-direction:column;align-items:center;justify-content:center;text-align:center;overflow:hidden}
.unlock-s2-overlay.show{display:flex}
.unlock-s2-particles{position:absolute;inset:0;pointer-events:none}
.unlock-s2-logo{font-family:'Orbitron',monospace;font-size:14px;letter-spacing:6px;color:rgba(255,215,0,0.4);margin-bottom:20px}
.unlock-s2-title{font-family:'Orbitron',monospace;font-size:48px;font-weight:900;
background:linear-gradient(135deg,#ffd700,#ff8c00,#fff,#ffd700);-webkit-background-clip:text;-webkit-text-fill-color:transparent;
animation:s2shine 2s linear infinite;letter-spacing:6px}
@keyframes s2shine{0%{filter:brightness(1)}50%{filter:brightness(1.4)}100%{filter:brightness(1)}}
.unlock-s2-sub{font-family:'Orbitron',monospace;font-size:14px;color:rgba(255,215,0,0.7);margin:12px 0 32px;letter-spacing:2px}
.s2-unlock-items{display:flex;gap:20px;flex-wrap:wrap;justify-content:center;margin-bottom:32px}
.s2-unlock-item{padding:14px 20px;border-radius:12px;border:1px solid rgba(255,215,0,0.3);
background:rgba(255,215,0,0.06);font-family:'Orbitron',monospace;font-size:11px;color:rgba(255,215,0,0.9);min-width:140px}
.s2-unlock-item .uico{font-size:28px;display:block;margin-bottom:8px}
.s2-short-sell-badge{display:inline-block;padding:2px 8px;border-radius:4px;background:rgba(255,0,110,0.2);
border:1px solid rgba(255,0,110,0.3);color:var(--np);font-size:9px;font-family:'Orbitron',monospace;font-weight:700}

.nav{position:fixed;top:60px;left:0;right:0;z-index:99;display:flex;justify-content:center;gap:3px;
padding:8px 16px;background:rgba(5,5,16,0.9);backdrop-filter:blur(15px);border-bottom:1px solid var(--br);flex-wrap:wrap}
.nb{padding:7px 18px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);
background:transparent;color:rgba(255,255,255,0.4);cursor:pointer;font-family:'Orbitron',monospace;
font-size:10px;font-weight:700;letter-spacing:1px;transition:all 0.25s;position:relative;white-space:nowrap}
.nb:hover{color:#fff;border-color:rgba(255,255,255,0.25)}
.nb.active{color:var(--nc);border-color:var(--nc);background:rgba(0,255,245,0.06);box-shadow:0 0 16px rgba(0,255,245,0.15)}
.nb.locked{color:rgba(255,0,110,0.4);border-color:rgba(255,0,110,0.2);cursor:not-allowed}
.nb .notif{position:absolute;top:-4px;right:-4px;width:8px;height:8px;
background:var(--np);border-radius:50%;animation:pls 1.5s infinite}
@keyframes pls{0%,100%{box-shadow:0 0 0 0 rgba(255,0,110,0.6)}50%{box-shadow:0 0 0 5px rgba(255,0,110,0)}}
.lock-badge{position:absolute;top:-6px;right:-6px;background:rgba(255,0,110,0.9);
border-radius:999px;padding:2px 6px;font-size:8px;font-family:'Orbitron',monospace;color:#fff}

.main{position:relative;z-index:10;padding-top:118px;padding-bottom:46px;min-height:100vh}
.sec{display:none;animation:fi 0.35s ease}
.sec.active{display:block}
@keyframes fi{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.sec-title{text-align:center;font-family:'Orbitron',monospace;font-size:26px;font-weight:900;
margin-bottom:24px;padding-top:10px;background:linear-gradient(135deg,var(--nc),var(--npu));
-webkit-background-clip:text;-webkit-text-fill-color:transparent}

.gg{display:grid;grid-template-columns:repeat(auto-fit,minmax(310px,1fr));gap:20px;max-width:1200px;margin:0 auto;padding:0 20px}
.gp{background:var(--cb);border:1px solid var(--br);border-radius:18px;padding:24px;
backdrop-filter:blur(20px);position:relative;overflow:hidden;
box-shadow:0 8px 40px rgba(0,0,0,0.6),inset 0 1px 0 rgba(255,255,255,0.04);transition:box-shadow 0.3s}
.gp:hover{box-shadow:0 8px 40px rgba(0,0,0,0.6),0 0 30px rgba(0,255,245,0.05),inset 0 1px 0 rgba(255,255,255,0.04)}
.gp::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;
background:linear-gradient(90deg,transparent,var(--nc),transparent)}
.pt{font-family:'Orbitron',monospace;font-size:13px;font-weight:700;color:var(--nc);
margin-bottom:18px;letter-spacing:2px;display:flex;align-items:center;gap:8px}
.pt .em{font-size:17px}

.btn{padding:9px 20px;border-radius:9px;border:none;cursor:pointer;font-family:'Orbitron',monospace;
font-size:11px;font-weight:700;letter-spacing:1px;transition:all 0.18s;position:relative;overflow:hidden}
.btn::after{content:'';position:absolute;inset:0;background:rgba(255,255,255,0);transition:background 0.18s}
.btn:hover::after{background:rgba(255,255,255,0.12)}
.btn:active{transform:scale(0.95)}
.btn-cy{background:linear-gradient(135deg,#00b8c4,var(--nc));color:#000;box-shadow:0 0 18px rgba(0,255,245,0.25)}
.btn-pk{background:linear-gradient(135deg,#b0004f,var(--np));color:#fff;box-shadow:0 0 18px rgba(255,0,110,0.25)}
.btn-gd{background:linear-gradient(135deg,#c4a000,var(--ng));color:#000;box-shadow:0 0 18px rgba(255,215,0,0.25)}
.btn-gr{background:linear-gradient(135deg,#158000,var(--ngr));color:#000;box-shadow:0 0 18px rgba(57,255,20,0.25)}
.btn-pu{background:linear-gradient(135deg,#6000a0,var(--npu));color:#fff;box-shadow:0 0 18px rgba(191,0,255,0.25)}
.btn-rd{background:linear-gradient(135deg,#900,#f44);color:#fff;box-shadow:0 0 18px rgba(255,50,50,0.25)}
.btn-sl{background:linear-gradient(135deg,#2a2a4a,#3a3a6a);color:rgba(255,255,255,0.7);border:1px solid rgba(255,255,255,0.1)}
.btn:disabled{opacity:0.35;cursor:not-allowed;transform:none!important}

.ir{display:flex;gap:8px;align-items:flex-end;margin-bottom:14px;flex-wrap:wrap}
.gi{background:rgba(0,0,0,0.45);border:1px solid var(--br);border-radius:8px;padding:7px 12px;
color:#fff;font-family:'Orbitron',monospace;font-size:12px;font-weight:700;width:130px;
outline:none;transition:border-color 0.2s}
.gi:focus{border-color:var(--nc);box-shadow:0 0 8px rgba(0,255,245,0.15)}
.il{color:rgba(255,255,255,0.45);font-size:11px;font-weight:500;margin-bottom:3px;font-family:'Orbitron',monospace;letter-spacing:0.5px}
.iw{display:flex;flex-direction:column;gap:2px}

.mines-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:7px;margin:14px 0}
.mc{aspect-ratio:1;border-radius:9px;border:1px solid rgba(255,255,255,0.09);
background:linear-gradient(135deg,rgba(255,255,255,0.055),rgba(255,255,255,0.02));
cursor:pointer;font-size:20px;display:flex;align-items:center;justify-content:center;
transition:all 0.18s;position:relative;overflow:hidden}
.mc:hover:not(.rs):not(.rm):not(.dis){border-color:var(--nc);background:rgba(0,255,245,0.08);
box-shadow:0 0 12px rgba(0,255,245,0.18);transform:scale(1.06)}
.mc.rs{background:linear-gradient(135deg,rgba(57,255,20,0.14),rgba(0,180,90,0.09));
border-color:var(--ngr);animation:cr 0.38s cubic-bezier(0.34,1.56,0.64,1)}
.mc.rm{background:linear-gradient(135deg,rgba(255,50,50,0.22),rgba(180,0,0,0.12));
border-color:#f44;animation:me 0.45s ease}
.mc.dis{pointer-events:none;opacity:0.55}
@keyframes cr{0%{transform:scale(0.4) rotate(12deg)}100%{transform:scale(1) rotate(0)}}
@keyframes me{0%{transform:scale(1.25)}30%{transform:scale(0.88) rotate(-4deg)}60%{transform:scale(1.08) rotate(2deg)}100%{transform:scale(1)}}
.ms{text-align:center;padding:9px;border-radius:9px;margin-top:6px;font-family:'Orbitron',monospace;
font-size:12px;font-weight:700;transition:all 0.35s;min-height:38px;display:flex;align-items:center;justify-content:center;gap:6px}
.ms.win{background:rgba(57,255,20,0.08);border:1px solid var(--ngr);color:var(--ngr)}
.ms.lose{background:rgba(255,50,50,0.08);border:1px solid #f44;color:#f44}
.ms.play{background:rgba(0,255,245,0.04);border:1px solid var(--br);color:rgba(255,255,255,0.6)}

.slots-wrap{display:flex;gap:10px;justify-content:center;margin:16px 0;
background:rgba(0,0,0,0.55);border-radius:14px;padding:18px;border:1px solid var(--br);position:relative;overflow:hidden}
.reel{width:86px;height:234px;overflow:hidden;border-radius:11px;border:1px solid rgba(255,255,255,0.09);background:rgba(0,0,0,0.65);position:relative}
.reel-inner{display:flex;flex-direction:column;will-change:transform}
.reel-sym{width:86px;height:78px;display:flex;align-items:center;justify-content:center;font-size:36px;flex-shrink:0}
.reel-win{position:absolute;inset:0;pointer-events:none;
background:linear-gradient(to bottom,rgba(0,0,0,0.7) 0%,transparent 28%,transparent 72%,rgba(0,0,0,0.7) 100%)}
.slots-line{position:absolute;left:0;right:0;top:50%;transform:translateY(-50%);
height:80px;border-top:2px solid rgba(255,215,0,0.35);border-bottom:2px solid rgba(255,215,0,0.35);pointer-events:none}
.swf2{animation:swf2 0.45s ease 3}
@keyframes swf2{0%,100%{box-shadow:none}50%{box-shadow:0 0 40px var(--ng),inset 0 0 30px rgba(255,215,0,0.08)}}

.rm2{text-align:center;font-family:'Orbitron',monospace;font-size:13px;font-weight:700;
min-height:28px;padding:5px;border-radius:7px;transition:all 0.25s}
.jp-box{text-align:center;padding:18px;border-radius:13px;
background:radial-gradient(ellipse,rgba(255,215,0,0.07),transparent);border:1px solid rgba(255,215,0,0.18);margin-bottom:16px}
.jp-lbl{font-family:'Orbitron',monospace;font-size:10px;color:rgba(255,255,255,0.35);letter-spacing:3px}
.jp-val{font-family:'Orbitron',monospace;font-size:30px;font-weight:900;
color:var(--ng);text-shadow:0 0 25px rgba(255,215,0,0.4);transition:all 0.3s}
.jp-boom{animation:jpb 0.4s ease 4}
@keyframes jpb{0%,100%{transform:scale(1)}50%{transform:scale(1.08);text-shadow:0 0 50px var(--ng)}}

.coin-area{display:flex;flex-direction:column;align-items:center;gap:18px}
.coin3d{width:112px;height:112px;border-radius:50%;position:relative;transform-style:preserve-3d;perspective:500px}
.coin-f{position:absolute;inset:0;border-radius:50%;backface-visibility:hidden;
display:flex;align-items:center;justify-content:center;font-size:46px;border:4px solid;
box-shadow:inset 0 0 20px rgba(0,0,0,0.5)}
.cf-h{background:radial-gradient(circle,#ffdc00,#b8860b);border-color:var(--ng)}
.cf-t{background:radial-gradient(circle,#c4c4c4,#686868);border-color:#aaa;transform:rotateY(180deg)}
@keyframes cf{0%{transform:rotateY(0)}100%{transform:rotateY(var(--fto,1800deg))}}
.coin3d.flipping{animation:cf var(--fdur,1.5s) ease forwards}
.cbtns{display:flex;gap:10px}

.wheel-wrap2{position:relative;width:256px;height:256px}
#wc{border-radius:50%;box-shadow:0 0 35px rgba(0,255,245,0.18)}
.wptr{position:absolute;top:-10px;left:50%;transform:translateX(-50%);
width:0;height:0;border-left:11px solid transparent;border-right:11px solid transparent;
border-top:22px solid var(--ng);filter:drop-shadow(0 0 7px var(--ng))}

.crash-wrap{position:relative;height:200px;border-radius:13px;background:rgba(0,0,0,0.55);
border:1px solid var(--br);overflow:hidden;margin-bottom:14px}
#cc{width:100%;height:100%}
.cm{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
font-family:'Orbitron',monospace;font-size:46px;font-weight:900;pointer-events:none;text-shadow:0 0 25px currentColor}
.cm.safe{color:var(--ngr)}
.cm.dng{color:var(--ng)}
.cm.crd{color:#f44;animation:cra 0.45s ease}
@keyframes cra{0%{transform:translate(-50%,-50%) scale(2)}100%{transform:translate(-50%,-50%) scale(1)}}

.toast{position:fixed;bottom:52px;right:20px;z-index:1001;padding:12px 20px;border-radius:11px;border:1px solid;
font-family:'Orbitron',monospace;font-size:11px;font-weight:700;opacity:0;transform:translateX(110px);
transition:all 0.38s cubic-bezier(0.34,1.56,0.64,1);max-width:300px;pointer-events:none;white-space:nowrap}
.toast.show{opacity:1;transform:translateX(0)}
.toast.success{background:rgba(57,255,20,0.13);border-color:var(--ngr);color:var(--ngr)}
.toast.error{background:rgba(255,50,50,0.13);border-color:#f44;color:#f44}
.toast.info{background:rgba(0,255,245,0.09);border-color:var(--nc);color:var(--nc)}
.toast.gold{background:rgba(255,215,0,0.11);border-color:var(--ng);color:var(--ng)}
.toast.purple{background:rgba(191,0,255,0.11);border-color:var(--npu);color:var(--npu)}

.pb{height:5px;border-radius:3px;background:rgba(255,255,255,0.06);overflow:hidden;margin-top:6px}
.pf{height:100%;border-radius:3px;transition:width 0.35s ease;background:linear-gradient(90deg,var(--nc),var(--npu))}

.nwb{position:fixed;bottom:0;left:0;right:0;z-index:99;display:flex;justify-content:center;align-items:center;
gap:18px;padding:7px 20px;background:rgba(5,5,16,0.93);backdrop-filter:blur(10px);
border-top:1px solid var(--br);font-family:'Orbitron',monospace;font-size:10px;flex-wrap:wrap}
.nwi{color:rgba(255,255,255,0.35);display:flex;gap:5px;align-items:center}
.nwi span{color:rgba(255,255,255,0.75)}
.nwi.hl span{color:var(--nc)}

.mining-hero{display:flex;flex-direction:column;align-items:center;gap:14px;position:relative}
.btc-big{font-family:'Orbitron',monospace;font-size:32px;font-weight:900;
color:var(--np);text-shadow:0 0 25px rgba(255,0,110,0.4);letter-spacing:2px;transition:all 0.3s}
.btc-big.pop{animation:bpop 0.3s ease}
@keyframes bpop{0%{transform:scale(1)}50%{transform:scale(1.06);text-shadow:0 0 40px rgba(255,0,110,0.7)}100%{transform:scale(1)}}
.hr-display{font-size:12px;color:rgba(255,255,255,0.45);font-family:'Orbitron',monospace}

.mine-orb{width:150px;height:150px;border-radius:50%;border:3px solid var(--np);
background:radial-gradient(circle at 40% 35%,rgba(255,0,110,0.2),rgba(0,0,0,0.6));
color:var(--np);font-size:40px;cursor:pointer;transition:all 0.12s;
box-shadow:0 0 25px rgba(255,0,110,0.18),inset 0 0 25px rgba(0,0,0,0.5);
display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;position:relative;
overflow:hidden}
.mine-orb::before{content:'';position:absolute;inset:0;border-radius:50%;
background:radial-gradient(circle at 30% 25%,rgba(255,255,255,0.08),transparent 60%)}
.mine-orb:hover{box-shadow:0 0 45px rgba(255,0,110,0.35),inset 0 0 18px rgba(255,0,110,0.08);transform:scale(1.04)}
.mine-orb:active{transform:scale(0.93);box-shadow:0 0 60px rgba(255,0,110,0.5),inset 0 0 30px rgba(255,0,110,0.15)}
.mine-orb .ml{font-family:'Orbitron',monospace;font-size:10px;font-weight:700;letter-spacing:2px;opacity:0.7}
.mine-orb .mo-ring{position:absolute;inset:-3px;border-radius:50%;border:3px solid transparent;
animation:ringPulse 2s ease infinite}
@keyframes ringPulse{0%,100%{box-shadow:0 0 0 0 rgba(255,0,110,0.4)}50%{box-shadow:0 0 0 12px rgba(255,0,110,0)}}
.cprt{position:fixed;pointer-events:none;font-family:'Orbitron',monospace;font-weight:900;
color:var(--np);animation:fup 1s ease forwards;z-index:9999;font-size:13px}
@keyframes fup{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-90px) scale(0.6)}}

.upgrd{display:grid;gap:8px}
.ui{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;
border-radius:11px;border:1px solid rgba(255,255,255,0.07);background:rgba(255,255,255,0.025);
transition:all 0.18s;animation:uiIn 0.3s ease}
@keyframes uiIn{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:translateX(0)}}
.ui:hover{border-color:var(--br);background:rgba(0,255,245,0.035)}
.ui-info{display:flex;flex-direction:column;gap:1px}
.un{font-family:'Orbitron',monospace;font-size:11px;color:rgba(255,255,255,0.82)}
.ud{font-size:10px;color:rgba(255,255,255,0.38)}
.uc{font-family:'Orbitron',monospace;font-size:10px;color:var(--nc)}

.toggle-row{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;
border-radius:11px;border:1px solid rgba(255,255,255,0.07);background:rgba(255,255,255,0.025)}
.toggle{position:relative;width:44px;height:24px;border-radius:12px;cursor:pointer;
background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.15);transition:all 0.25s}
.toggle.on{background:rgba(0,255,245,0.3);border-color:var(--nc)}
.toggle::after{content:'';position:absolute;width:18px;height:18px;top:2px;left:2px;
border-radius:50%;background:#fff;transition:left 0.25s;box-shadow:0 2px 4px rgba(0,0,0,0.4)}
.toggle.on::after{left:22px;background:var(--nc)}

.shop-tabs{display:flex;gap:6px;margin-bottom:16px}
.stab{padding:7px 18px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);
background:transparent;color:rgba(255,255,255,0.45);cursor:pointer;font-family:'Orbitron',monospace;
font-size:10px;font-weight:700;letter-spacing:1px;transition:all 0.2s}
.stab.active{color:var(--nc);border-color:var(--nc);background:rgba(0,255,245,0.07)}
.stab:hover:not(.active){color:rgba(255,255,255,0.7);border-color:rgba(255,255,255,0.2)}

.parts-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(175px,1fr));gap:10px}
.part-card{padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.08);
background:rgba(255,255,255,0.025);cursor:pointer;transition:all 0.2s;position:relative}
.part-card:hover{border-color:var(--br);background:rgba(0,255,245,0.05);transform:translateY(-2px)}
.pc-type{font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,255,255,0.35);letter-spacing:1px;margin-bottom:4px}
.pc-name{font-family:'Orbitron',monospace;font-size:11px;font-weight:700;color:#fff;margin-bottom:3px}
.pc-spec{font-size:10px;color:rgba(255,255,255,0.4);margin-bottom:6px}
.pc-price{font-family:'Orbitron',monospace;font-size:12px;color:var(--ng);font-weight:700}
.pc-tier{position:absolute;top:8px;right:8px;padding:2px 7px;border-radius:999px;font-size:8px;font-family:'Orbitron',monospace}
.tier1{background:rgba(100,100,100,0.3);color:#aaa;border:1px solid rgba(150,150,150,0.2)}
.tier2{background:rgba(0,100,200,0.2);color:#69b4ff;border:1px solid rgba(100,150,255,0.25)}
.tier3{background:rgba(150,0,255,0.2);color:var(--npu);border:1px solid rgba(150,0,255,0.3)}
.part-condition{font-size:9px;margin-top:3px}
.cond-used{color:#ffaa44}
.cond-new{color:var(--ngr)}

.wb-slots{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px;margin-bottom:16px}
.wb-slot{padding:14px 10px;border-radius:11px;border:2px dashed rgba(255,255,255,0.12);
background:rgba(0,0,0,0.2);text-align:center;cursor:pointer;transition:all 0.2s;min-height:80px;
display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px}
.wb-slot.filled{border-style:solid;border-color:var(--nc);background:rgba(0,255,245,0.06)}
.wb-slot.filled:hover{background:rgba(0,255,245,0.1)}
.wb-slot:not(.filled):hover{border-color:rgba(255,255,255,0.25);background:rgba(255,255,255,0.03)}
.wbs-icon{font-size:22px}
.wbs-type{font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,255,255,0.35);letter-spacing:1px}
.wbs-name{font-family:'Orbitron',monospace;font-size:9px;color:var(--nc);margin-top:2px}

.garage-item{display:flex;align-items:center;gap:12px;padding:14px 16px;border-radius:12px;
border:1px solid rgba(255,255,255,0.07);background:rgba(255,255,255,0.025);margin-bottom:8px;
transition:all 0.2s;animation:gi-in 0.4s cubic-bezier(0.34,1.56,0.64,1)}
@keyframes gi-in{from{transform:scale(0.9);opacity:0}to{transform:scale(1);opacity:1}}
.garage-item:hover{border-color:var(--br)}
.gi-icon{font-size:28px;flex-shrink:0}
.gi-info{flex:1}
.gi-name{font-family:'Orbitron',monospace;font-size:12px;font-weight:700}
.gi-spec{font-size:10px;color:rgba(255,255,255,0.4);margin-top:2px}
.gi-val{font-family:'Orbitron',monospace;font-size:14px;color:var(--ng);font-weight:700;margin-right:4px}
.gi-trend{font-size:10px;font-family:'Orbitron',monospace}
.gi-trend.up{color:var(--ngr)}
.gi-trend.dn{color:#f44}

.char-page{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;
max-width:1100px;margin:0 auto;padding:0 20px}
.char-big-card{padding:20px;border-radius:18px;border:2px solid rgba(255,255,255,0.08);
background:var(--cb);text-align:center;transition:all 0.3s;position:relative;overflow:hidden;cursor:pointer}
.char-big-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;
background:linear-gradient(90deg,transparent,var(--card-col,var(--nc)),transparent);
opacity:0;transition:opacity 0.3s}
.char-big-card.owned::before{opacity:1}
.char-big-card.owned{border-color:rgba(255,255,255,0.18)}
.char-big-card.active-char{border-color:var(--card-col,var(--nc));
box-shadow:0 0 30px rgba(0,0,0,0.5),0 0 0 1px var(--card-col,var(--nc));}
.char-big-card:hover{transform:translateY(-5px)}
.char-big-card svg{filter:drop-shadow(0 0 14px rgba(0,255,245,0.3))}
.cbig-name{font-family:'Orbitron',monospace;font-size:15px;font-weight:900;margin:10px 0 4px}
.cbig-title{font-size:11px;color:rgba(255,255,255,0.4);margin-bottom:8px;font-style:italic}
.cbig-mult{font-family:'Orbitron',monospace;font-size:24px;font-weight:900;margin:8px 0}
.cbig-quote{font-size:11px;color:rgba(255,255,255,0.5);margin-bottom:12px;line-height:1.4;min-height:32px}
.cbig-price{font-family:'Orbitron',monospace;font-size:13px;color:var(--ng);margin-bottom:10px}
.cbig-badge{display:inline-block;padding:4px 12px;border-radius:999px;font-family:'Orbitron',monospace;
font-size:10px;font-weight:700;margin-bottom:12px}
.badge-locked{background:rgba(255,255,255,0.06);color:rgba(255,255,255,0.35);border:1px solid rgba(255,255,255,0.1)}
.badge-owned{background:rgba(57,255,20,0.1);color:var(--ngr);border:1px solid rgba(57,255,20,0.3)}
.badge-active{background:rgba(0,255,245,0.1);color:var(--nc);border:1px solid rgba(0,255,245,0.3)}

.char-unlock-anim{position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0);
display:flex;align-items:center;justify-content:center;flex-direction:column;gap:16px;
pointer-events:none;transition:background 0.5s}
.char-unlock-anim.show{background:rgba(0,0,0,0.85)}
.cua-inner{opacity:0;transform:scale(0.5);transition:all 0.6s cubic-bezier(0.34,1.56,0.64,1)}
.cua-inner.show{opacity:1;transform:scale(1)}
.cua-title{font-family:'Orbitron',monospace;font-size:32px;font-weight:900;
background:linear-gradient(135deg,var(--nc),var(--npu));-webkit-background-clip:text;-webkit-text-fill-color:transparent;
text-align:center;margin-top:12px}
.cua-sub{font-family:'Orbitron',monospace;font-size:14px;color:rgba(255,255,255,0.7);text-align:center}

.stock-row2{display:flex;align-items:center;gap:10px;padding:12px 16px;border-radius:13px;
border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.018);transition:all 0.25s;flex-wrap:wrap}
.stock-row2:hover{border-color:var(--br);background:rgba(0,255,245,0.028)}
.sl-ico{width:38px;height:38px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.sl-info{flex:1;min-width:75px}
.sl-tick{font-family:'Orbitron',monospace;font-size:12px;font-weight:700}
.sl-co{font-size:10px;color:rgba(255,255,255,0.38)}
.sl-chart{width:76px;height:30px}
.sl-pc{text-align:right;min-width:78px}
.sl-p{font-family:'Orbitron',monospace;font-size:13px;font-weight:700;color:var(--ng)}
.sl-ch{font-family:'Orbitron',monospace;font-size:10px;font-weight:700;margin-top:1px}
.sl-ch.up{color:var(--ngr)}.sl-ch.dn{color:#f44}
.sl-own{font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,255,255,0.35);min-width:55px;text-align:center}
.sl-act{display:flex;gap:5px;align-items:center}

.ptot{padding:14px;border-radius:13px;background:rgba(255,215,0,0.04);
border:1px solid rgba(255,215,0,0.18);margin-bottom:14px;text-align:center}
.ptot-lbl{font-size:11px;color:rgba(255,255,255,0.4);font-family:'Orbitron',monospace;letter-spacing:2px}
.ptot-val{font-family:'Orbitron',monospace;font-size:22px;font-weight:900;color:var(--ng)}

.day-bar{display:flex;align-items:center;justify-content:space-between;padding:13px 20px;
background:rgba(0,0,0,0.38);border-radius:13px;border:1px solid rgba(0,255,245,0.13);margin-bottom:20px;flex-wrap:wrap;gap:10px}
.di{font-family:'Orbitron',monospace;font-size:12px;color:rgba(255,255,255,0.55)}
.di span{color:var(--nc)}

.lb{background:var(--cb);border:1px solid var(--br);border-radius:18px;padding:24px;max-width:480px;margin:0 auto}
.lr{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.04)}
.lrk{font-family:'Orbitron',monospace;font-size:17px;font-weight:900;width:34px;text-align:center}
.lrk.g{color:var(--ng)}.lrk.s{color:#c0c0c0}.lrk.b{color:#cd7f32}
.lrn{flex:1;font-family:'Orbitron',monospace;font-size:12px}
.lrc{font-family:'Orbitron',monospace;font-size:12px;color:var(--ngr)}

.casino-lock{position:relative}
.casino-lock-overlay{position:absolute;inset:0;background:rgba(5,5,16,0.92);
border-radius:18px;z-index:20;display:flex;flex-direction:column;align-items:center;
justify-content:center;gap:12px;backdrop-filter:blur(8px)}
.clo-icon{font-size:60px;animation:lsway 2s ease infinite}
@keyframes lsway{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}
.clo-text{font-family:'Orbitron',monospace;font-size:22px;font-weight:900;color:var(--np)}
.clo-sub{font-family:'Orbitron',monospace;font-size:12px;color:rgba(255,255,255,0.5);text-align:center}
.clo-day{font-family:'Orbitron',monospace;font-size:16px;color:var(--nc)}
.day-count-ring{position:relative;width:100px;height:100px}
.day-count-ring svg{width:100%;height:100%;transform:rotate(-90deg)}
.day-ring-num{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
font-family:'Orbitron',monospace;font-size:22px;font-weight:900;color:var(--nc)}

.pc-diagram{width:100%;background:rgba(0,0,0,0.4);border-radius:14px;border:1px solid rgba(0,255,245,0.15);
padding:16px;margin-bottom:16px;position:relative;overflow:hidden}
.pc-diagram-title{font-family:'Orbitron',monospace;font-size:10px;color:rgba(0,255,245,0.5);letter-spacing:2px;margin-bottom:12px;text-align:center}
.pc-chassis{display:grid;grid-template-columns:1fr 1fr 1fr;grid-template-rows:auto auto auto auto;
gap:6px;border:2px solid rgba(0,255,245,0.2);border-radius:10px;padding:10px;
background:rgba(0,10,20,0.6);position:relative}
.pc-chassis::before{content:'PC CASE';position:absolute;top:-9px;left:12px;
font-family:'Orbitron',monospace;font-size:8px;color:rgba(0,255,245,0.4);background:rgba(0,10,20,1);padding:0 6px}
.pcd-slot{border-radius:7px;border:1px dashed rgba(255,255,255,0.1);
padding:8px 6px;text-align:center;transition:all 0.3s;min-height:52px;
display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;position:relative;overflow:hidden}
.pcd-slot.pcd-filled{border:1px solid rgba(0,255,245,0.4);background:rgba(0,255,245,0.05)}
.pcd-slot.pcd-filled.pcd-am3warn{border-color:rgba(255,100,0,0.6);background:rgba(255,100,0,0.06)}
.pcd-slot-icon{font-size:18px}
.pcd-slot-label{font-family:'Orbitron',monospace;font-size:7px;color:rgba(255,255,255,0.3);letter-spacing:1px}
.pcd-slot-name{font-family:'Orbitron',monospace;font-size:8px;color:var(--nc);margin-top:1px;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.screw-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
pointer-events:none;opacity:0;font-size:24px;z-index:5}
.screw-overlay.spinning{animation:screwSpin 0.6s ease forwards}
@keyframes screwSpin{0%{opacity:1;transform:rotate(0deg) scale(0.5)}60%{opacity:1;transform:rotate(720deg) scale(1.2)}100%{opacity:0;transform:rotate(1080deg) scale(0.8)}}
.compat-warn{margin-top:8px;padding:8px 12px;border-radius:8px;background:rgba(255,80,0,0.1);
border:1px solid rgba(255,80,0,0.35);color:#ff6020;font-family:'Orbitron',monospace;font-size:10px;display:none}
.compat-warn.show{display:block}
.compat-ok{margin-top:8px;padding:8px 12px;border-radius:8px;background:rgba(57,255,20,0.07);
border:1px solid rgba(57,255,20,0.3);color:var(--ngr);font-family:'Orbitron',monospace;font-size:10px;display:none}
.compat-ok.show{display:block}

.vip-nb{border-color:rgba(255,215,0,0.5)!important;color:var(--ng)!important;background:rgba(255,215,0,0.06)!important;animation:s2pulse 2s infinite}
.poker-table{background:radial-gradient(ellipse at center,#1a5e1a,#0d3b0d);border:3px solid #8B6914;border-radius:18px;padding:16px;margin-bottom:14px;position:relative;overflow:hidden}
.poker-table::before{content:'';position:absolute;inset:4px;border:1px solid rgba(255,215,0,0.15);border-radius:14px;pointer-events:none}
.poker-community{display:flex;gap:6px;justify-content:center;min-height:75px;align-items:center;margin:10px 0;flex-wrap:wrap}
.poker-player-row{display:flex;gap:8px;align-items:flex-end;flex-wrap:wrap}
.poker-ai-row{display:flex;justify-content:space-between;margin-bottom:10px;flex-wrap:wrap;gap:6px}
.poker-ai-hand{text-align:center;font-family:'Orbitron',monospace;font-size:9px}
.poker-ai-cards{display:flex;gap:3px;justify-content:center;margin-bottom:3px}
.pcard{width:42px;height:60px;border-radius:7px;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3px;box-shadow:0 2px 8px rgba(0,0,0,0.5);flex-shrink:0;cursor:default}
.pcard.held{border:2px solid var(--ng);box-shadow:0 0 14px rgba(255,215,0,0.5);transform:translateY(-8px);cursor:pointer}
.pcard.back{background:linear-gradient(135deg,#1a1a4a,#0a0a25);border:1px solid rgba(255,255,255,0.15)}
.pcard.dim{opacity:0.5}
.pcard-r{font-size:13px;font-weight:900;line-height:1}
.pcard-s{font-size:16px;line-height:1}
.pcard.red .pcard-r,.pcard.red .pcard-s{color:#cc0000}
.pcard.black .pcard-r,.pcard.black .pcard-s{color:#111}
.poker-pot{text-align:center;font-family:'Orbitron',monospace;font-size:13px;font-weight:900;color:var(--ng);margin:6px 0}
.poker-action-btns{display:flex;gap:6px;flex-wrap:wrap;justify-content:center;margin-top:8px}
.poker-status{font-family:'Orbitron',monospace;font-size:11px;color:rgba(255,255,255,0.5);text-align:center;min-height:20px;margin:4px 0}
.vp-cards{display:flex;gap:7px;justify-content:center;margin:14px 0;flex-wrap:wrap}
.sic-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px}
.sic-bet-zone{padding:10px;border-radius:10px;border:1px solid rgba(255,215,0,0.18);background:rgba(255,215,0,0.04);text-align:center;cursor:pointer;transition:all 0.2s;font-family:'Orbitron',monospace}
.sic-bet-zone:hover{border-color:rgba(255,215,0,0.4);background:rgba(255,215,0,0.1)}
.sic-bet-zone.selected{border-color:var(--ng);background:rgba(255,215,0,0.15);box-shadow:0 0 12px rgba(255,215,0,0.2)}
.sic-die{width:52px;height:52px;border-radius:10px;background:#fff;display:flex;align-items:center;justify-content:center;font-size:28px;box-shadow:0 4px 12px rgba(0,0,0,0.5)}
.sic-dice-row{display:flex;gap:12px;justify-content:center;margin:14px 0}
.dt-cards{display:flex;gap:20px;justify-content:center;align-items:center;margin:14px 0;flex-wrap:wrap}
.dt-side{text-align:center;font-family:'Orbitron',monospace}
.dt-label{font-size:12px;font-weight:700;margin-bottom:8px}
.dt-bet-row{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
.ld-dice-row{display:flex;gap:10px;justify-content:center;margin:14px 0}
.ld-die{width:58px;height:58px;border-radius:12px;background:linear-gradient(135deg,#1a1a3a,#2a2a5a);display:flex;align-items:center;justify-content:center;font-size:32px;box-shadow:0 4px 14px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.1);transition:all 0.3s}
.ld-die.lit{box-shadow:0 0 20px rgba(255,215,0,0.7);border-color:var(--ng);background:linear-gradient(135deg,#3a3000,#5a4800)}
.ld-bet-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;margin-bottom:12px}
.ld-bet-num{padding:7px 3px;border-radius:7px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.04);text-align:center;cursor:pointer;font-family:'Orbitron',monospace;font-size:9px;transition:all 0.2s}
.ld-bet-num:hover{border-color:rgba(255,215,0,0.3);background:rgba(255,215,0,0.06)}
.ld-bet-num.selected{border-color:var(--ng);background:rgba(255,215,0,0.14);color:var(--ng)}
.ld-bet-num.lit-num{border-color:#ff8c00;background:rgba(255,100,0,0.15);color:#ff8c00;box-shadow:0 0 8px rgba(255,100,0,0.3)}
.re-property{padding:14px;border-radius:13px;border:1px solid rgba(255,215,0,0.15);background:rgba(255,215,0,0.03);margin-bottom:10px;transition:all 0.25s}
.re-property:hover{border-color:rgba(255,215,0,0.3)}
.re-prop-header{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.re-prop-icon{font-size:28px;width:44px;height:44px;border-radius:10px;background:rgba(255,215,0,0.08);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.re-prop-name{font-family:'Orbitron',monospace;font-size:13px;font-weight:700;color:var(--ng)}
.re-prop-tier{font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,215,0,0.5)}
.re-prop-stats{display:flex;gap:14px;font-family:'Orbitron',monospace;font-size:10px;flex-wrap:wrap;margin-bottom:8px}
.re-stat{display:flex;flex-direction:column;gap:2px}
.re-stat-lbl{color:rgba(255,255,255,0.35);font-size:8px}
.re-stat-val{color:var(--ng);font-size:11px;font-weight:700}
.re-event-log{background:rgba(0,0,0,0.5);border-radius:10px;padding:12px;font-family:'Orbitron',monospace;font-size:9px;line-height:1.8;border:1px solid rgba(255,215,0,0.1);color:rgba(255,215,0,0.5);min-height:60px;margin-top:12px}
.bey-part{padding:8px 10px;border-radius:9px;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.03);cursor:pointer;transition:all 0.2s;font-family:'Orbitron',monospace}
.bey-part:hover{border-color:rgba(255,215,0,0.3);background:rgba(255,215,0,0.05)}
.bey-part.selected{border-color:var(--ng);background:rgba(255,215,0,0.1);box-shadow:0 0 12px rgba(255,215,0,0.15)}
.bey-part-name{font-size:10px;font-weight:700;color:var(--ng);margin-bottom:3px}
.bey-part-desc{font-size:8px;color:rgba(255,255,255,0.4);line-height:1.4}
.bey-part-icon{font-size:20px;margin-bottom:4px}
.bey-stat-row{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.bey-stat-lbl{font-family:'Orbitron',monospace;font-size:8px;color:rgba(255,255,255,0.35);width:60px;flex-shrink:0}
.bey-stat-bar{flex:1;height:7px;background:rgba(255,255,255,0.07);border-radius:4px;overflow:hidden}
.bey-stat-fill{height:100%;border-radius:4px;transition:width 0.4s}
.bey-stat-val{font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,255,255,0.5);width:24px;text-align:right}
.bey-power-card{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,215,0,0.2);background:rgba(255,215,0,0.04);font-family:'Orbitron',monospace;font-size:9px;margin-bottom:6px}
.bey-power-name{font-size:10px;font-weight:700;color:var(--ng)}
.bey-power-btn{padding:8px 14px;border-radius:9px;font-family:'Orbitron',monospace;font-size:9px;font-weight:700;cursor:pointer;border:1px solid;transition:all 0.2s;white-space:nowrap}
.bey-power-btn:disabled{opacity:0.35;cursor:not-allowed}
.bey-power-btn.ready{background:rgba(255,215,0,0.1);border-color:rgba(255,215,0,0.5);color:var(--ng)}
.bey-power-btn.active{background:rgba(255,215,0,0.3);border-color:var(--ng);color:var(--ng);box-shadow:0 0 16px rgba(255,215,0,0.4);animation:s2pulse 0.5s infinite}
.bey-power-btn.cooling{background:rgba(255,255,255,0.04);border-color:rgba(255,255,255,0.15);color:rgba(255,255,255,0.3)}
</style>
</head>
<body>
<canvas id="bg"></canvas>

<div class="hud">
  <div class="hud-left">
    <div class="hud-logo">‚¨° NEON VAULT</div>
    <div class="active-char-mini" onclick="showSec('chars')">
      <div id="hudCharSvg"></div>
      <div>
        <div class="char-label" id="hudCharName">ZARA</div>
        <div class="char-mult" id="hudCharMult">1x</div>
      </div>
    </div>
    <button class="music-btn" id="musicBtn" onclick="toggleBgMusic()">üéµ MUSIC: OFF</button>
  </div>
  <div class="hud-stats">
    <div class="sp cash"><span class="ico">üí∞</span><span id="hCash">$1,000.00</span></div>
    <div class="sp btc"><span class="ico">‚Çø</span><span id="hBtc">0.00000000</span></div>
    <div class="sp inc"><span class="ico">‚ö°</span><span id="hInc">$0/s</span></div>
    <div class="sp dy"><span class="ico">üìÖ</span>DAY <span id="hDay">1</span></div>
  </div>
</div>

<div class="nav">
  <button class="nb active" onclick="showSec('mining')" id="n-mining">‚õè MINING</button>
  <button class="nb" onclick="showSec('pcshop')" id="n-pcshop">üñ• PC FLIP</button>
  <button class="nb" onclick="showSec('casino')" id="n-casino">üé∞ CASINO</button>
  <button class="nb" onclick="showSec('stocks')" id="n-stocks">üìà STOCKS</button>
  <button class="nb" onclick="showSec('crash')" id="n-crash">üöÄ CRASH</button>
  <button class="nb" onclick="showSec('chars')" id="n-chars">üë§ REBIRTHS</button>
  <button class="nb" onclick="showSec('lobby')" id="n-lobby">üèÜ LOBBY</button>
  <button class="nb" onclick="showSec('stage2')" id="n-stage2" style="display:none">‚≠ê STAGE II</button>
</div>

<div class="main">

<div class="sec active" id="sec-mining">
  <div class="sec-title">‚õè CRYPTO MINE</div>
  <div style="max-width:980px;margin:0 auto;padding:0 20px">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
      <div class="gp">
        <div class="pt"><span class="em">‚Çø</span>BITCOIN MINER</div>
        <div class="mining-hero">
          <div>
            <div class="btc-big" id="btcDisp">‚Çø 0.00000000</div>
            <div class="hr-display" id="hrDisp">0 H/s | BTC: $<span id="btcPrDisp">50,000</span></div>
          </div>
          <div style="position:relative" id="mineOrbWrap">
            <div class="mine-orb" id="mineOrb" style="cursor:default">
              <div class="mo-ring"></div>
              <span>‚õè</span>
              <span class="ml">PASSIVE</span>
            </div>
          </div>
          <div style="width:100%;display:flex;flex-direction:column;gap:4px">
            <div style="display:flex;justify-content:space-between;font-size:11px;color:rgba(255,255,255,0.38);font-family:'Orbitron',monospace">
              <span>Block Progress</span><span id="bkPct">0%</span>
            </div>
            <div class="pb"><div class="pf" id="bkFill" style="width:0%"></div></div>
          </div>
          <div style="display:flex;gap:8px;width:100%;flex-wrap:wrap">
            <button class="btn btn-pk" onclick="sellBtc()" style="flex:1">SELL ALL BTC ‚Üí $</button>
            <button class="btn btn-cy" onclick="autoSellToggle()" id="autoSellBtn" style="flex:1">AUTO-SELL: OFF</button>
          </div>
          <div class="toggle-row" style="width:100%">
            <div>
              <div style="font-family:'Orbitron',monospace;font-size:11px;color:rgba(255,255,255,0.7)">‚ö° OVERCLOCK</div>
              <div style="font-size:10px;color:rgba(255,0,110,0.6);margin-top:1px">3x hashrate ‚Ä¢ risk of burnout!</div>
            </div>
            <div class="toggle" id="ocToggle" onclick="toggleOverclock()"></div>
          </div>
          <div class="toggle-row" style="width:100%">
            <div>
              <div style="font-family:'Orbitron',monospace;font-size:11px;color:rgba(255,255,255,0.7)">üåê MINING POOL</div>
              <div style="font-size:10px;color:rgba(0,255,245,0.5);margin-top:1px">Steady income +15% bonus</div>
            </div>
            <div class="toggle" id="poolToggle" onclick="togglePool()"></div>
          </div>
        </div>
      </div>
      <div class="gp">
        <div class="pt"><span class="em">üîß</span>RIG UPGRADES</div>
        <div class="upgrd" id="upgradesGrid"></div>
      </div>
    </div>
  </div>
</div>

<div class="sec" id="sec-pcshop">
  <div class="sec-title">üñ• PC FLIP LAB</div>
  <div style="max-width:1100px;margin:0 auto;padding:0 20px">
    <div class="shop-tabs">
      <button class="stab active" onclick="pcTab('shop')" id="ptab-shop">üõí SHOP</button>
      <button class="stab" onclick="pcTab('bench')" id="ptab-bench">üîß WORKBENCH</button>
      <button class="stab" onclick="pcTab('garage')" id="ptab-garage">üè™ GARAGE <span id="garageCount" style="background:rgba(255,0,110,0.3);border-radius:999px;padding:1px 6px;font-size:9px"></span></button>
    </div>
    <div id="pc-shop-content">
      <div class="gp" style="margin-bottom:16px">
        <div class="pt"><span class="em">üõí</span>PARTS MARKET</div>
        <div class="shop-tabs" style="margin-bottom:12px">
          <button class="stab active" onclick="partCondTab('used')" id="ctab-used">üî© USED PARTS</button>
          <button class="stab" onclick="partCondTab('new')" id="ctab-new">‚ú® NEW PARTS</button>
        </div>
        <div class="parts-grid" id="partsGrid"></div>
      </div>
      <div class="gp">
        <div class="pt"><span class="em">üéí</span>INVENTORY <span id="invCount" style="font-size:10px;color:rgba(255,255,255,0.35)"></span></div>
        <div id="inventoryGrid" class="parts-grid" style="min-height:60px"></div>
      </div>
    </div>
    <div id="pc-bench-content" style="display:none">
      <div class="gp">
        <div class="pt"><span class="em">üîß</span>WORKBENCH ‚Äî ASSEMBLE YOUR PC</div>
        <div class="pc-diagram">
          <div class="pc-diagram-title">‚¨° PC ASSEMBLY DIAGRAM ‚Äî 2D VIEW</div>
          <div class="pc-chassis" id="pcDiagram">
            <div class="pcd-slot" id="diag-cooler"><div class="screw-overlay" id="screw-cooler">üî©</div><div class="pcd-slot-icon">‚ùÑÔ∏è</div><div class="pcd-slot-label">COOLER</div></div>
            <div class="pcd-slot" id="diag-cpu" style="grid-column:2"><div class="screw-overlay" id="screw-cpu">üî©</div><div class="pcd-slot-icon">üß†</div><div class="pcd-slot-label">CPU</div></div>
            <div class="pcd-slot" id="diag-ram"><div class="screw-overlay" id="screw-ram">üî©</div><div class="pcd-slot-icon">üíæ</div><div class="pcd-slot-label">RAM</div></div>
            <div class="pcd-slot" id="diag-mobo" style="grid-column:1/4;background:rgba(0,255,245,0.02);border:1px dashed rgba(0,255,245,0.08)"><div class="screw-overlay" id="screw-mobo">üî©</div><div class="pcd-slot-icon">üîå</div><div class="pcd-slot-label">MOTHERBOARD</div></div>
            <div class="pcd-slot" id="diag-gpu" style="grid-column:1/3"><div class="screw-overlay" id="screw-gpu">üî©</div><div class="pcd-slot-icon">üéÆ</div><div class="pcd-slot-label">GPU</div></div>
            <div class="pcd-slot" id="diag-storage"><div class="screw-overlay" id="screw-storage">üî©</div><div class="pcd-slot-icon">üíø</div><div class="pcd-slot-label">STORAGE</div></div>
            <div class="pcd-slot" id="diag-psu"><div class="screw-overlay" id="screw-psu">üî©</div><div class="pcd-slot-icon">‚ö°</div><div class="pcd-slot-label">PSU</div></div>
            <div class="pcd-slot" id="diag-case" style="grid-column:2/4"><div class="screw-overlay" id="screw-case">üî©</div><div class="pcd-slot-icon">üñ•</div><div class="pcd-slot-label">CASE</div></div>
          </div>
          <div class="compat-warn" id="compatWarn">‚ö† INCOMPATIBLE BUILD</div>
          <div class="compat-ok" id="compatOk">‚úì COMPATIBLE BUILD</div>
        </div>
        <div class="wb-slots" id="wbSlots"></div>
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
          <button class="btn btn-cy" id="buildBtn" onclick="buildPC()" disabled style="flex:1">üî® BUILD PC</button>
          <button class="btn btn-sl" onclick="clearBench()">CLEAR</button>
          <div style="font-family:'Orbitron',monospace;font-size:11px;color:rgba(255,255,255,0.4)">Est. value: <span id="buildEst" style="color:var(--ng)">$0</span></div>
        </div>
        <div style="height:14px"></div>
        <div class="pt" style="margin-bottom:10px"><span class="em">üéí</span>INVENTORY</div>
        <div id="benchInventory" class="parts-grid" style="min-height:50px"></div>
      </div>
    </div>
    <div id="pc-garage-content" style="display:none">
      <div class="gp">
        <div class="pt"><span class="em">üè™</span>BUILT PCs FOR SALE</div>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:8px">
          <div style="font-size:11px;color:rgba(255,255,255,0.4);font-family:'Orbitron',monospace">PC market fluctuates daily. Sell high!</div>
          <div style="font-family:'Orbitron',monospace;font-size:11px">Market: <span id="pcMarket" style="color:var(--nc)">Normal</span></div>
        </div>
        <div id="garageGrid"></div>
      </div>
    </div>
  </div>
</div>

<div class="sec" id="sec-casino">
  <div class="sec-title">üé∞ CASINO FLOOR</div>
  <div style="position:relative">
    <div class="casino-lock" id="casinoLockWrap">
      <div class="casino-lock-overlay" id="casinoLock">
        <div class="clo-icon">üîí</div>
        <div class="clo-text">CASINO LOCKED</div>
        <div class="clo-sub">Unlocks on Day 10<br>Build your empire first, then gamble it!</div>
        <div class="day-count-ring">
          <svg viewBox="0 0 36 36">
            <circle cx="18" cy="18" r="15.9" fill="none" stroke="rgba(255,255,255,0.08)" stroke-width="3"/>
            <circle cx="18" cy="18" r="15.9" fill="none" stroke="var(--nc)" stroke-width="3"
              stroke-dasharray="100 100" stroke-dashoffset="0" id="lockRingArc" stroke-linecap="round"/>
          </svg>
          <div class="day-ring-num" id="lockDayNum">1</div>
        </div>
        <div class="clo-day" id="lockDaySub">Day 1 / 10</div>
      </div>
    </div>
    <div class="gg" id="casinoContent">
      <div class="gp">
        <div class="pt"><span class="em">üí£</span>MINES</div>
        <div class="ir">
          <div class="iw"><div class="il">BET ($)</div><input type="number" class="gi" id="mBet" value="50" min="1"></div>
          <div class="iw"><div class="il">MINES (1-24)</div><input type="number" class="gi" id="mCnt" value="3" min="1" max="24"></div>
        </div>
        <div class="ir">
          <button class="btn btn-cy" id="mStartBtn" onclick="startMines()">START</button>
          <button class="btn btn-gd" id="mCashBtn" onclick="cashMines()" disabled>CASH OUT <span id="mMlt">1.00x</span></button>
        </div>
        <div class="mines-grid" id="minesGrid"></div>
        <div class="ms" id="minesStatus">Choose settings and start!</div>
      </div>

      <div class="gp">
        <div class="pt"><span class="em">üé∞</span>MEGA SLOTS</div>
        <div class="jp-box">
          <div class="jp-lbl">JACKPOT POOL</div>
          <div class="jp-val" id="jpVal">$25,000.00</div>
        </div>
        <div class="ir">
          <div class="iw"><div class="il">BET ($)</div><input type="number" class="gi" id="sBet" value="25" min="1"></div>
        </div>
        <div class="slots-wrap" id="slotsWrap">
          <div class="reel"><div class="reel-inner" id="ri0"></div><div class="reel-win"></div></div>
          <div class="reel"><div class="reel-inner" id="ri1"></div><div class="reel-win"></div></div>
          <div class="reel"><div class="reel-inner" id="ri2"></div><div class="reel-win"></div></div>
          <div class="slots-line"></div>
        </div>
        <div class="rm2" id="slotsRes"></div>
        <button class="btn btn-pu" onclick="spinSlots()" id="sBtn" style="width:100%;margin-top:10px">‚ñ∂ SPIN</button>
      </div>

      <div class="gp">
        <div class="pt"><span class="em">ü™ô</span>COIN FLIP</div>
        <div class="coin-area">
          <div class="coin3d" id="coin3d">
            <div class="coin-f cf-h">üëë</div>
            <div class="coin-f cf-t">üåü</div>
          </div>
          <div class="ir" style="justify-content:center">
            <div class="iw"><div class="il">BET ($)</div><input type="number" class="gi" id="cBet" value="100" min="1"></div>
          </div>
          <div class="cbtns">
            <button class="btn btn-gd" onclick="flipCoin('heads')">üëë HEADS (2x)</button>
            <button class="btn btn-cy" onclick="flipCoin('tails')">üåü TAILS (2x)</button>
          </div>
          <div class="rm2" id="coinRes"></div>
        </div>
      </div>

      <div class="gp">
        <div class="pt"><span class="em">üé°</span>FORTUNE WHEEL</div>
        <div style="display:flex;flex-direction:column;align-items:center;gap:14px">
          <div class="wheel-wrap2">
            <canvas id="wc" width="256" height="256"></canvas>
            <div class="wptr"></div>
          </div>
          <div class="ir" style="justify-content:center">
            <div class="iw"><div class="il">BET ($)</div><input type="number" class="gi" id="wBet" value="50" min="1"></div>
          </div>
          <button class="btn btn-pk" onclick="spinWheel()" id="wBtn" style="width:190px">SPIN WHEEL</button>
          <div class="rm2" id="wheelRes"></div>
        </div>
      </div>

      <div class="gp">
        <div class="pt"><span class="em">üÉè</span>BLACKJACK</div>
        <div id="bjArea" style="text-align:center">
          <div style="display:flex;justify-content:space-between;margin-bottom:10px">
            <div style="font-family:'Orbitron',monospace;font-size:10px;color:rgba(255,255,255,0.4)">DEALER</div>
            <div style="font-family:'Orbitron',monospace;font-size:12px;color:var(--np)" id="bjDealerVal">0</div>
          </div>
          <div id="bjDealerCards" style="display:flex;gap:6px;justify-content:center;min-height:70px;margin-bottom:14px;flex-wrap:wrap"></div>
          <div style="display:flex;justify-content:space-between;margin-bottom:10px">
            <div style="font-family:'Orbitron',monospace;font-size:10px;color:rgba(255,255,255,0.4)">YOU</div>
            <div style="font-family:'Orbitron',monospace;font-size:12px;color:var(--ngr)" id="bjPlayerVal">0</div>
          </div>
          <div id="bjPlayerCards" style="display:flex;gap:6px;justify-content:center;min-height:70px;margin-bottom:14px;flex-wrap:wrap"></div>
          <div class="ir" style="justify-content:center">
            <div class="iw"><div class="il">BET ($)</div><input type="number" class="gi" id="bjBet" value="100" min="1" style="width:100px"></div>
          </div>
          <div style="display:flex;gap:6px;justify-content:center;flex-wrap:wrap">
            <button class="btn btn-gr" id="bjDealBtn" onclick="bjDeal()" style="font-size:10px;padding:7px 14px">üÉè DEAL</button>
            <button class="btn btn-cy" id="bjHitBtn" onclick="bjHit()" disabled style="font-size:10px;padding:7px 14px">HIT</button>
            <button class="btn btn-gd" id="bjStandBtn" onclick="bjStand()" disabled style="font-size:10px;padding:7px 14px">STAND</button>
            <button class="btn btn-pk" id="bjDblBtn" onclick="bjDouble()" disabled style="font-size:10px;padding:7px 14px">2√ó</button>
          </div>
          <div class="rm2" id="bjRes" style="margin-top:10px"></div>
        </div>
      </div>

      <div class="gp">
        <div class="pt"><span class="em">üî¥</span>ROULETTE</div>
        <div style="display:flex;flex-direction:column;align-items:center;gap:12px">
          <canvas id="rlCv" width="200" height="200" style="border-radius:50%;box-shadow:0 0 25px rgba(255,0,110,0.2)"></canvas>
          <div id="rlBall" style="font-size:22px;font-family:'Orbitron',monospace;font-weight:900;min-height:28px"></div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center">
            <div class="iw"><div class="il">BET ($)</div><input type="number" class="gi" id="rlBet" value="50" min="1" style="width:90px"></div>
            <div class="iw"><div class="il">BET TYPE</div>
              <select id="rlType" style="background:rgba(0,0,0,0.45);border:1px solid var(--br);border-radius:8px;padding:7px 10px;color:#fff;font-family:'Orbitron',monospace;font-size:10px;outline:none">
                <option value="red">RED (2√ó)</option>
                <option value="black">BLACK (2√ó)</option>
                <option value="even">EVEN (2√ó)</option>
                <option value="odd">ODD (2√ó)</option>
                <option value="low">1-18 (2√ó)</option>
                <option value="high">19-36 (2√ó)</option>
                <option value="doz1">1ST DOZ (3√ó)</option>
                <option value="doz2">2ND DOZ (3√ó)</option>
                <option value="doz3">3RD DOZ (3√ó)</option>
                <option value="num">SINGLE # (36√ó)</option>
              </select>
            </div>
            <div class="iw" id="rlNumWrap" style="display:none"><div class="il">NUMBER</div><input type="number" class="gi" id="rlNum" value="7" min="0" max="36" style="width:80px"></div>
          </div>
          <button class="btn btn-pk" id="rlBtn" onclick="spinRoulette()" style="width:160px">üî¥ SPIN</button>
          <div class="rm2" id="rlRes"></div>
        </div>
      </div>

      <div class="gp">
        <div class="pt"><span class="em">üî∫</span>HI-LO</div>
        <div style="display:flex;flex-direction:column;align-items:center;gap:14px">
          <div id="hlCard" style="width:90px;height:120px;border-radius:12px;background:linear-gradient(135deg,#1a1a3a,#0a0a20);border:2px solid var(--br);
          display:flex;align-items:center;justify-content:center;font-size:36px;font-family:'Orbitron',monospace;font-weight:900;color:#fff;
          box-shadow:0 0 20px rgba(0,255,245,0.15)">üÇ†</div>
          <div id="hlCardLabel" style="font-family:'Orbitron',monospace;font-size:13px;color:rgba(255,255,255,0.5)">Draw a card to start</div>
          <div style="font-family:'Orbitron',monospace;font-size:11px;color:var(--ng)" id="hlStreak">Streak: 0 | Multiplier: 1.00√ó</div>
          <div class="ir" style="justify-content:center">
            <div class="iw"><div class="il">BET ($)</div><input type="number" class="gi" id="hlBet" value="50" min="1" style="width:100px"></div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center">
            <button class="btn btn-gr" id="hlDealBtn" onclick="hlDeal()">üÉè DRAW</button>
            <button class="btn btn-cy" id="hlHighBtn" onclick="hlGuess('high')" disabled>‚ñ≤ HIGHER</button>
            <button class="btn btn-pk" id="hlLowBtn" onclick="hlGuess('low')" disabled>‚ñº LOWER</button>
            <button class="btn btn-gd" id="hlCashBtn" onclick="hlCash()" disabled>üí∞ CASH</button>
          </div>
          <div class="rm2" id="hlRes"></div>
        </div>
      </div>

      <div class="gp">
        <div class="pt"><span class="em">üé¥</span>BACCARAT</div>
        <div style="text-align:center">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px">
            <div style="background:rgba(0,100,50,0.1);border:1px solid rgba(0,255,100,0.2);border-radius:12px;padding:12px">
              <div style="font-family:'Orbitron',monospace;font-size:10px;color:var(--ngr);margin-bottom:8px">PLAYER</div>
              <div id="bacPlayerCards" style="display:flex;gap:4px;justify-content:center;min-height:55px;margin-bottom:6px;flex-wrap:wrap"></div>
              <div id="bacPVal" style="font-family:'Orbitron',monospace;font-size:18px;font-weight:900;color:var(--ngr)">0</div>
            </div>
            <div style="background:rgba(100,0,50,0.1);border:1px solid rgba(255,0,100,0.2);border-radius:12px;padding:12px">
              <div style="font-family:'Orbitron',monospace;font-size:10px;color:var(--np);margin-bottom:8px">BANKER</div>
              <div id="bacBankCards" style="display:flex;gap:4px;justify-content:center;min-height:55px;margin-bottom:6px;flex-wrap:wrap"></div>
              <div id="bacBVal" style="font-family:'Orbitron',monospace;font-size:18px;font-weight:900;color:var(--np)">0</div>
            </div>
          </div>
          <div class="ir" style="justify-content:center">
            <div class="iw"><div class="il">BET ($)</div><input type="number" class="gi" id="bacBet" value="100" min="1" style="width:100px"></div>
          </div>
          <div style="display:flex;gap:6px;justify-content:center;flex-wrap:wrap">
            <button class="btn btn-gr" onclick="playBaccarat('player')" id="bacBtnP" style="font-size:9px;padding:7px 12px">PLAYER (1:1)</button>
            <button class="btn btn-pk" onclick="playBaccarat('banker')" id="bacBtnB" style="font-size:9px;padding:7px 12px">BANKER (0.95:1)</button>
            <button class="btn btn-gd" onclick="playBaccarat('tie')" id="bacBtnT" style="font-size:9px;padding:7px 12px">TIE (8:1)</button>
          </div>
          <div class="rm2" id="bacRes" style="margin-top:10px"></div>
        </div>
      </div>

      <div class="gp">
        <div class="pt"><span class="em">üé±</span>KENO</div>
        <div>
          <div style="font-family:'Orbitron',monospace;font-size:10px;color:rgba(255,255,255,0.4);margin-bottom:8px">PICK UP TO 10 NUMBERS (1-80)</div>
          <div id="kenoGrid" style="display:grid;grid-template-columns:repeat(10,1fr);gap:4px;margin-bottom:12px"></div>
          <div style="font-family:'Orbitron',monospace;font-size:10px;color:var(--nc);margin-bottom:8px">Selected: <span id="kenoCount">0</span>/10</div>
          <div class="ir">
            <div class="iw"><div class="il">BET ($)</div><input type="number" class="gi" id="kenoBet" value="50" min="1" style="width:100px"></div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn btn-pk" id="kenoBtn" onclick="playKeno()">üé± DRAW KENO</button>
            <button class="btn btn-sl" onclick="clearKeno()" style="font-size:9px">CLEAR</button>
          </div>
          <div class="rm2" id="kenoRes" style="margin-top:10px"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="sec" id="sec-stocks">
  <div class="sec-title">üìà STOCK MARKET</div>
  <div style="max-width:700px;margin:0 auto;padding:0 20px">
    <div class="day-bar">
      <div class="di">Market Day: <span id="sDayNum">1</span></div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px">
        <button class="btn btn-cy" id="nextDayBtn" onclick="manualAdvanceDay()">‚è© NEXT DAY</button>
        <div style="font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,255,255,0.3)" id="skipCounter">Skips: 2 / 2 remaining</div>
      </div>
    </div>
    <div class="ptot">
      <div class="ptot-lbl">PORTFOLIO VALUE</div>
      <div class="ptot-val" id="portVal">$0.00</div>
    </div>
    <div class="gp"><div id="stocksGrid" class="stocks-grid"></div></div>
  </div>
</div>

<div class="sec" id="sec-crash">
  <div class="sec-title">üöÄ CRASH</div>
  <div style="max-width:640px;margin:0 auto;padding:0 20px;position:relative">
    <div class="casino-lock-overlay" id="crashLock" style="border-radius:14px;position:relative;display:none;margin-bottom:20px">
      <div class="clo-icon">üöÄ</div>
      <div class="clo-text">CRASH LOCKED</div>
      <div class="clo-sub">Unlocks on Day 15<br>Survive the market first!</div>
      <div class="day-count-ring">
        <svg viewBox="0 0 36 36">
          <circle cx="18" cy="18" r="15.9" fill="none" stroke="rgba(255,255,255,0.08)" stroke-width="3"/>
          <circle cx="18" cy="18" r="15.9" fill="none" stroke="var(--np)" stroke-width="3"
            stroke-dasharray="100 100" stroke-dashoffset="0" id="crashLockArc" stroke-linecap="round"/>
        </svg>
        <div class="day-ring-num" id="crashLockNum" style="color:var(--np)">1</div>
      </div>
      <div class="clo-day" id="crashLockSub" style="color:var(--np)">Day 1 / 15</div>
    </div>
    <div id="crashGameContent">
      <div class="gp">
        <div class="pt"><span class="em">üìä</span>CRASH GAME</div>
        <div class="crash-wrap"><canvas id="cc"></canvas><div class="cm safe" id="cm">1.00x</div></div>
        <div class="ir" style="justify-content:center">
          <div class="iw"><div class="il">BET ($)</div><input type="number" class="gi" id="crBet" value="100" min="1"></div>
        </div>
        <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
          <button class="btn btn-gr" id="crBetBtn" onclick="placeCrashBet()">üöÄ BET & LAUNCH</button>
          <button class="btn btn-gd" id="crCashBtn" onclick="crashCashout()" disabled>üí∞ CASH OUT</button>
        </div>
        <div class="rm2" id="crRes" style="margin-top:10px"></div>
        <div style="height:1px;background:linear-gradient(90deg,transparent,var(--br),transparent);margin:14px 0"></div>
        <div style="display:flex;justify-content:space-between;font-family:'Orbitron',monospace;font-size:10px;color:rgba(255,255,255,0.35)">
          <span>Recent:</span><span id="crHist"></span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="sec" id="sec-chars">
  <div class="sec-title">üë§ REBIRTHS</div>
  <div style="text-align:center;font-size:13px;color:rgba(255,255,255,0.45);margin-bottom:10px;font-family:'Orbitron',monospace;padding:0 20px">
    Buy characters to multiply ALL earnings. Higher rebirth = bigger multiplier. One active at a time.
  </div>
  <div style="text-align:center;font-size:11px;color:rgba(255,80,80,0.7);margin-bottom:20px;font-family:'Orbitron',monospace;padding:0 20px">
    ‚ö† REBIRTH RESETS YOUR CASH TO $1,000
  </div>
  <div class="char-page" id="charPage"></div>
</div>

<div class="sec" id="sec-lobby">
  <div class="sec-title">üèÜ LOBBY</div>
  <div style="max-width:600px;margin:0 auto;padding:0 20px">
    <div class="lb" id="lbEl"></div>
    <div style="height:18px"></div>
    <div class="gp">
      <div class="pt"><span class="em">üìä</span>YOUR STATS</div>
      <div id="pStats" style="display:grid;grid-template-columns:1fr 1fr;gap:10px"></div>
    </div>
    <div style="height:20px"></div>
    <div class="gp s2-card" id="s2GatePanel">
      <div class="pt gold"><span class="em">‚≠ê</span>STAGE II ‚Äî PRESTIGE ASCENSION</div>
      <div style="text-align:center;padding:10px 0">
        <div style="font-size:36px;margin-bottom:8px">üåå</div>
        <div style="font-family:'Orbitron',monospace;font-size:11px;color:rgba(255,215,0,0.55);margin-bottom:20px;line-height:1.8">
          Transcend the limits of Stage 1.<br>Unlock three elite worlds unavailable to ordinary players.
        </div>
        <div class="s2-progress-bar"><div class="s2-progress-fill" id="s2ProgressFill" style="width:0%"></div></div>
        <div style="font-family:'Orbitron',monospace;font-size:10px;color:rgba(255,215,0,0.45);margin-bottom:14px">
          NET WORTH: <span id="s2ProgressLabel">$0 / $100T</span>
        </div>
        <div class="s2-price-tag">$100,000,000,000,000</div>
        <div style="font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,100,0,0.5);margin-bottom:20px">‚ö† NET WORTH REQUIREMENT ‚Äî NOT DEDUCTED FROM CASH</div>
        <button class="btn btn-gd" id="s2UnlockBtn" onclick="unlockStage2()" disabled style="font-size:13px;padding:12px 32px;letter-spacing:2px">üîí STAGE II LOCKED</button>
        <div style="display:flex;justify-content:center;gap:16px;margin-top:20px;flex-wrap:wrap">
          <div style="text-align:center;font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,215,0,0.4)">üåå<br>QUANTUM<br>EXCHANGE</div>
          <div style="text-align:center;font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,215,0,0.4)">üî•<br>SYNDICATE<br>HEIST</div>
          <div style="text-align:center;font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,215,0,0.4)">‚öîÔ∏è<br>PRESTIGE<br>ARENA</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="sec" id="sec-stage2">
  <div class="sec-title" style="background:linear-gradient(135deg,#ffd700,#ff8c00,#ffd700);-webkit-background-clip:text;-webkit-text-fill-color:transparent">‚≠ê STAGE II ‚Äî ASCENDED</div>
  <div class="s2-tabs">
    <button class="s2-tab active" onclick="s2Tab('quantum')" id="s2t-quantum">üåå QUANTUM EXCHANGE</button>
    <button class="s2-tab" onclick="s2Tab('heist')" id="s2t-heist">üî• SYNDICATE HEIST</button>
    <button class="s2-tab" onclick="s2Tab('arena')" id="s2t-arena">‚öîÔ∏è PRESTIGE ARENA</button>
    <button class="s2-tab" onclick="s2Tab('realestate')" id="s2t-realestate">üè† REAL ESTATE</button>
    <button class="s2-tab" onclick="s2Tab('beyblade')" id="s2t-beyblade">üåÄ BEYBLADE</button>
  </div>

  <!-- QUANTUM EXCHANGE -->
  <div class="s2-content active" id="s2c-quantum">
    <div class="s2-sec-title">üåå QUANTUM EXCHANGE</div>
    <div style="max-width:800px;margin:0 auto;padding:0 20px">
      <div class="gp s2-card">
        <div class="pt gold"><span class="em">üì°</span>QUANTUM ASSETS <span class="s2-short-sell-badge" style="margin-left:8px">SHORT SELLING ENABLED</span></div>
        <div style="font-size:10px;font-family:'Orbitron',monospace;color:rgba(255,215,0,0.4);margin-bottom:14px">Extreme volatility quantum-tier instruments. Prices shift ¬±40% daily.</div>
        <div id="qAssetsGrid"></div>
        <div style="height:1px;background:linear-gradient(90deg,transparent,rgba(255,215,0,0.2),transparent);margin:16px 0"></div>
        <div style="display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap">
          <div class="iw"><div class="il" style="color:rgba(255,215,0,0.5)">ASSET</div>
            <select id="qSelect" style="background:rgba(0,0,0,0.55);border:1px solid rgba(255,215,0,0.25);border-radius:8px;padding:7px 10px;color:var(--ng);font-family:'Orbitron',monospace;font-size:11px;outline:none"></select>
          </div>
          <div class="iw"><div class="il" style="color:rgba(255,215,0,0.5)">QTY</div><input type="number" class="gi" id="qQty" value="1" min="1" style="border-color:rgba(255,215,0,0.25);color:var(--ng);width:90px"></div>
          <button class="btn btn-gd" onclick="qBuy()" style="font-size:10px">üìà LONG</button>
          <button class="btn btn-pk" onclick="qSell()" style="font-size:10px">üìâ SHORT SELL</button>
          <button class="btn btn-sl" onclick="qClose()" style="font-size:10px">‚úñ CLOSE POS</button>
        </div>
        <div class="rm2" id="qRes" style="margin-top:10px"></div>
      </div>
      <div class="gp s2-card">
        <div class="pt gold"><span class="em">‚ö°</span>QUANTUM SURGE EVENTS</div>
        <div id="qEventLog" style="background:rgba(0,0,0,0.5);border-radius:10px;padding:14px;font-family:'Orbitron',monospace;font-size:10px;line-height:2;min-height:80px;border:1px solid rgba(255,215,0,0.1);color:rgba(255,215,0,0.6)">Awaiting quantum market activity...</div>
      </div>
    </div>
  </div>

  <!-- SYNDICATE HEIST -->
  <div class="s2-content" id="s2c-heist">
    <div class="s2-sec-title">üî• SYNDICATE HEIST</div>
    <div style="max-width:760px;margin:0 auto;padding:0 20px">
      <div class="gp s2-card">
        <div class="pt gold"><span class="em">üó∫</span>CHOOSE YOUR MARK</div>
        <div id="heistMissions"></div>
      </div>
      <div class="gp s2-card" id="heistOpPanel">
        <div class="pt gold"><span class="em">üîß</span>CREW &amp; LOADOUT</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px" id="crewGrid"></div>
        <div style="font-family:'Orbitron',monospace;font-size:10px;color:rgba(255,200,100,0.5);margin-bottom:4px">CREW COST: <span id="crewCostLabel" style="color:var(--ng)">$0</span></div>
        <div style="font-family:'Orbitron',monospace;font-size:10px;color:rgba(255,200,100,0.5);margin-bottom:14px">POTENTIAL PAYOUT: <span id="heistPayoutLabel" style="color:var(--ngr)">$0</span></div>
        <button class="btn btn-pk" id="heistGoBtn" onclick="launchHeist()" style="width:100%;font-size:13px;padding:12px;letter-spacing:2px">üö® EXECUTE HEIST</button>
      </div>
      <div class="gp s2-card">
        <div class="pt gold"><span class="em">üìü</span>OPERATION LOG</div>
        <div class="heist-log" id="heistLog">Select a target and assemble your crew...</div>
        <div class="rm2" id="heistRes" style="margin-top:10px"></div>
      </div>
    </div>
  </div>

  <!-- PRESTIGE ARENA -->
  <div class="s2-content" id="s2c-arena">
    <div class="s2-sec-title">‚öîÔ∏è PRESTIGE ARENA</div>
    <div style="max-width:700px;margin:0 auto;padding:0 20px">
      <div class="gp s2-card">
        <div class="pt gold"><span class="em">üèü</span>ARENA TOURNAMENT</div>
        <div style="text-align:center;margin-bottom:16px">
          <div class="arena-round-badge" id="arenaRoundLabel">NO ACTIVE TOURNAMENT</div>
          <div class="arena-prize" id="arenaPrizePot">$0</div>
          <div style="font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,215,0,0.4)">PRIZE POT</div>
        </div>
        <div class="arena-bracket" id="arenaBracket"></div>
        <div class="rm2" id="arenaRoundRes" style="margin:10px 0"></div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <div class="iw"><div class="il" style="color:rgba(255,0,110,0.5)">ENTRY FEE ($)</div><input type="number" class="gi" id="arenaFee" value="1000000" min="100000" style="border-color:rgba(255,0,110,0.3);color:var(--np);width:140px"></div>
          <button class="btn btn-pk" id="arenaEnterBtn" onclick="enterArena()" style="font-size:11px">‚öîÔ∏è ENTER TOURNAMENT</button>
          <button class="btn btn-cy" id="arenaFightBtn" onclick="arenaFight()" disabled style="font-size:11px">‚ñ∂ FIGHT ROUND</button>
        </div>
        <div style="height:1px;background:linear-gradient(90deg,transparent,rgba(255,0,110,0.2),transparent);margin:14px 0"></div>
        <div class="heist-log" id="arenaLog" style="border-color:rgba(255,0,110,0.1);color:rgba(255,100,100,0.7)">Enter a tournament to begin...</div>
      </div>
    </div>
  </div>

  <!-- REAL ESTATE -->
  <div class="s2-content" id="s2c-realestate">
    <div class="s2-sec-title">üè† REAL ESTATE EMPIRE</div>
    <div style="max-width:840px;margin:0 auto;padding:0 20px">
      <div class="gp s2-card">
        <div class="pt gold"><span class="em">üìä</span>PORTFOLIO OVERVIEW</div>
        <div style="display:flex;gap:16px;flex-wrap:wrap;margin-bottom:6px">
          <div style="font-family:'Orbitron',monospace;font-size:11px">Total Value: <span id="reTotalVal" style="color:var(--ng)">$0</span></div>
          <div style="font-family:'Orbitron',monospace;font-size:11px">Daily Rent: <span id="reDailyRent" style="color:var(--ngr)">$0/day</span></div>
          <div style="font-family:'Orbitron',monospace;font-size:11px">Properties: <span id="reCount" style="color:var(--nc)">0</span></div>
        </div>
        <div class="re-event-log" id="reEventLog">Market is stable...</div>
      </div>
      <div class="gp s2-card">
        <div class="pt gold"><span class="em">üèó</span>AVAILABLE PROPERTIES</div>
        <div id="reMarket"></div>
      </div>
      <div class="gp s2-card" id="rePortfolioPanel" style="display:none">
        <div class="pt gold"><span class="em">üèò</span>YOUR PROPERTIES</div>
        <div id="rePortfolio"></div>
      </div>
    </div>
  </div>

  <!-- BEYBLADE -->
  <div class="s2-content" id="s2c-beyblade">
    <div class="s2-sec-title">üåÄ BEYBLADE ARENA</div>
    <div style="max-width:900px;margin:0 auto;padding:0 20px">
      <div style="display:flex;gap:6px;justify-content:center;margin-bottom:18px;flex-wrap:wrap">
        <button class="s2-tab active" onclick="beyTab('build')" id="beyt-build">‚öôÔ∏è BUILD</button>
        <button class="s2-tab" onclick="beyTab('battle')" id="beyt-battle">‚öîÔ∏è BATTLE</button>
      </div>

      <div id="beyc-build">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;max-width:860px;margin:0 auto">
          <div class="gp s2-card">
            <div class="pt gold"><span class="em">‚öôÔ∏è</span>BLADE WORKSHOP</div>
            <div style="font-size:10px;font-family:'Orbitron',monospace;color:rgba(255,215,0,0.4);margin-bottom:14px">Combine Layer + Disc + Driver to forge your blade. Parts define stats and grant unique powers.</div>
            <div style="margin-bottom:12px">
              <div style="font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,255,255,0.4);letter-spacing:2px;margin-bottom:7px">‚¨° LAYER ‚Äî Attack / Defense profile</div>
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px" id="beyLayerGrid"></div>
            </div>
            <div style="margin-bottom:12px">
              <div style="font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,255,255,0.4);letter-spacing:2px;margin-bottom:7px">‚ö° DISC ‚Äî Stamina / Weight</div>
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px" id="beyDiscGrid"></div>
            </div>
            <div style="margin-bottom:14px">
              <div style="font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,255,255,0.4);letter-spacing:2px;margin-bottom:7px">üî© DRIVER ‚Äî Movement style</div>
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px" id="beyDriverGrid"></div>
            </div>
            <button class="btn btn-gd" onclick="beyBuild()" style="width:100%;font-size:12px;padding:11px;letter-spacing:2px">üî® FORGE BEYBLADE</button>
          </div>
          <div class="gp s2-card">
            <div class="pt gold"><span class="em">üåÄ</span>CURRENT BLADE</div>
            <div style="text-align:center;padding:10px 0">
              <div style="font-size:64px;margin-bottom:8px;filter:drop-shadow(0 0 20px rgba(255,215,0,0.5))" id="beyBladeIcon">üåÄ</div>
              <div style="font-family:'Orbitron',monospace;font-size:15px;font-weight:900;color:var(--ng)" id="beyBladeName">NO BLADE FORGED</div>
              <div style="font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,255,255,0.35);margin:5px 0 14px" id="beyBladeType">Select parts and forge</div>
              <div id="beyStatBars" style="text-align:left;margin-bottom:14px"></div>
              <div id="beyPowersList"></div>
            </div>
          </div>
        </div>
      </div>

      <div id="beyc-battle" style="display:none">
        <div class="gp s2-card" style="max-width:640px;margin:0 auto">
          <div class="pt gold"><span class="em">‚öîÔ∏è</span>BATTLE ARENA ‚Äî 1v1 vs AI</div>
          <div style="font-size:10px;font-family:'Orbitron',monospace;color:rgba(255,215,0,0.4);margin-bottom:10px">Use arrow keys or the d-pad to steer your blade. Ram the AI to drain its stamina. Use powers at the right moment!</div>

          <div style="position:relative;width:100%;max-width:480px;margin:0 auto 12px">
            <canvas id="beyCanvas" width="480" height="480" style="width:100%;display:block;border-radius:50%;background:radial-gradient(circle,#12122a 60%,#0a0a18);border:3px solid rgba(255,215,0,0.5);box-shadow:0 0 50px rgba(255,215,0,0.15),inset 0 0 40px rgba(0,0,0,0.5)"></canvas>
            <div id="beyRoundLabel" style="position:absolute;top:10px;left:50%;transform:translateX(-50%);font-family:'Orbitron',monospace;font-size:10px;font-weight:700;color:rgba(255,215,0,0.8);pointer-events:none">READY</div>
          </div>

          <div style="display:flex;gap:12px;margin-bottom:10px">
            <div style="flex:1">
              <div style="font-family:'Orbitron',monospace;font-size:9px;color:var(--nc);margin-bottom:3px" id="beyPlayerLabel">YOU</div>
              <div style="height:8px;background:rgba(255,255,255,0.07);border-radius:4px;overflow:hidden"><div id="beyPlayerStam" style="height:100%;width:100%;background:linear-gradient(90deg,#00fff5,#bf00ff);border-radius:4px;transition:width 0.15s"></div></div>
            </div>
            <div style="flex:1">
              <div style="font-family:'Orbitron',monospace;font-size:9px;color:var(--np);margin-bottom:3px;text-align:right" id="beyAiLabel">AI BOT</div>
              <div style="height:8px;background:rgba(255,255,255,0.07);border-radius:4px;overflow:hidden"><div id="beyAiStam" style="height:100%;width:100%;background:linear-gradient(90deg,#ff006e,#ff8c00);border-radius:4px;transition:width 0.15s;float:right"></div></div>
            </div>
          </div>

          <div style="margin-bottom:10px">
            <div style="font-family:'Orbitron',monospace;font-size:9px;color:rgba(255,215,0,0.5);margin-bottom:6px">‚ö° POWERS (click or press 1-3)</div>
            <div style="display:flex;gap:6px;flex-wrap:wrap" id="beyPowerBtns"></div>
          </div>

          <div style="display:flex;justify-content:center;margin-bottom:12px">
            <div style="display:grid;grid-template-columns:42px 42px 42px;grid-template-rows:42px 42px;gap:5px">
              <div></div>
              <button class="btn btn-cy" style="padding:0;font-size:18px;width:42px;height:42px" id="bdUp" onpointerdown="beySetDir('up',true)" onpointerup="beySetDir('up',false)" onpointerleave="beySetDir('up',false)">‚ñ≤</button>
              <div></div>
              <button class="btn btn-cy" style="padding:0;font-size:18px;width:42px;height:42px" id="bdLeft" onpointerdown="beySetDir('left',true)" onpointerup="beySetDir('left',false)" onpointerleave="beySetDir('left',false)">‚óÄ</button>
              <button class="btn btn-cy" style="padding:0;font-size:18px;width:42px;height:42px" id="bdDown" onpointerdown="beySetDir('down',true)" onpointerup="beySetDir('down',false)" onpointerleave="beySetDir('down',false)">‚ñº</button>
              <button class="btn btn-cy" style="padding:0;font-size:18px;width:42px;height:42px" id="bdRight" onpointerdown="beySetDir('right',true)" onpointerup="beySetDir('right',false)" onpointerleave="beySetDir('right',false)">‚ñ∂</button>
            </div>
          </div>

          <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:10px">
            <div class="iw"><div class="il">BET ($)</div><input type="number" class="gi" id="beyBet" value="1000000" min="100000" style="width:130px;border-color:rgba(255,215,0,0.3);color:var(--ng)"></div>
            <button class="btn btn-gd" id="beyStartBtn" onclick="beyStartBattle()" style="font-size:12px;letter-spacing:1px">üåÄ LET IT RIP!</button>
            <button class="btn btn-sl" id="beyStopBtn" onclick="beyForfeit()" disabled style="font-size:11px">üè≥ FORFEIT</button>
          </div>
          <div style="text-align:center;font-family:'Orbitron',monospace;font-size:12px;font-weight:700;min-height:20px;color:rgba(255,255,255,0.5)" id="beyBattleStatus">Forge a blade first, then battle!</div>
          <div class="rm2" id="beyRes" style="margin-top:6px"></div>
        </div>
      </div>
    </div>
  </div>

</div>

<div class="nwb">
  <div class="nwi">NET WORTH <span id="nwT">$1,000.00</span></div>
  <div class="nwi">WON <span id="nwW">$0.00</span></div>
  <div class="nwi">LOST <span id="nwL">$0.00</span></div>
  <div class="nwi">STREAK <span id="nwS">0</span></div>
  <div class="nwi hl">BEST WIN <span id="nwB">$0.00</span></div>
</div>

<div class="unlock-s2-overlay" id="s2UnlockOverlay">
  <canvas id="s2ParticlesCv" class="unlock-s2-particles"></canvas>
  <div class="unlock-s2-logo">NEON VAULT</div>
  <div class="unlock-s2-title">STAGE II</div>
  <div class="unlock-s2-sub">YOU HAVE ASCENDED THE VAULT</div>
  <div class="s2-unlock-items">
    <div class="s2-unlock-item"><span class="uico">üåå</span>QUANTUM EXCHANGE<br><span style="color:rgba(255,255,255,0.4);font-size:9px">SHORT SELL ‚Ä¢ SURGE EVENTS</span></div>
    <div class="s2-unlock-item"><span class="uico">üî•</span>SYNDICATE HEIST<br><span style="color:rgba(255,255,255,0.4);font-size:9px">CREW MISSIONS ‚Ä¢ BILLIONS</span></div>
    <div class="s2-unlock-item"><span class="uico">‚öîÔ∏è</span>PRESTIGE ARENA<br><span style="color:rgba(255,255,255,0.4);font-size:9px">TOURNAMENT ‚Ä¢ WINNER TAKES ALL</span></div>
  </div>
  <button class="btn btn-gd" onclick="closeS2Overlay()" style="font-size:13px;padding:12px 40px;letter-spacing:2px">ENTER THE ASCENDED REALM ‚Üí</button>
</div>

<div class="toast" id="toast"></div>

<div class="char-unlock-anim" id="cuaEl">
  <div class="cua-inner" id="cuaInner">
    <div id="cuaSvg" style="display:flex;justify-content:center"></div>
    <div class="cua-title" id="cuaTitle">REBIRTH UNLOCKED!</div>
    <div class="cua-sub" id="cuaSub"></div>
  </div>
</div>

<script>
let audioCtx=null;
function initAudio(){if(!audioCtx){audioCtx=new(window.AudioContext||window.webkitAudioContext)()}}
document.addEventListener('click',initAudio,{once:true});
function tone(freq,dur,type='sine',vol=0.25,delay=0){
  if(!audioCtx)return;
  try{
    const o=audioCtx.createOscillator();
    const g=audioCtx.createGain();
    o.type=type;o.frequency.value=freq;
    g.gain.setValueAtTime(vol,audioCtx.currentTime+delay);
    g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+delay+dur);
    o.connect(g);g.connect(audioCtx.destination);
    o.start(audioCtx.currentTime+delay);o.stop(audioCtx.currentTime+delay+dur+0.05);
  }catch(e){}
}
function sfx(n){
  if(!audioCtx)return;
  switch(n){
    case'click':tone(700,0.05,'sine',0.12);break;
    case'mine':tone(140,0.07,'square',0.12);tone(100,0.05,'sawtooth',0.08,0.04);break;
    case'win':[523,659,784,1047].forEach((f,i)=>tone(f,0.2,'sine',0.22,i*0.07));break;
    case'bigwin':[523,659,784,880,1047,1319,1568].forEach((f,i)=>tone(f,0.25,'triangle',0.28,i*0.06));break;
    case'jackpot':
      [523,659,784,880,1047,1319,1568,2093].forEach((f,i)=>tone(f,0.3,'triangle',0.3,i*0.05));
      setTimeout(()=>[523,659,784,880,1047].forEach((f,i)=>tone(f,0.35,'sine',0.25,i*0.04)),600);break;
    case'lose':[400,300,220].forEach((f,i)=>tone(f,0.15,'sawtooth',0.15,i*0.07));break;
    case'boom':tone(80,0.6,'sawtooth',0.3);tone(60,0.8,'square',0.2,0.05);break;
    case'buy':tone(880,0.08,'sine',0.18);tone(1100,0.1,'sine',0.14,0.07);break;
    case'sell':tone(660,0.08,'sine',0.2);tone(880,0.12,'sine',0.18,0.07);break;
    case'build':[440,554,659,880,1100].forEach((f,i)=>tone(f,0.12,'triangle',0.18,i*0.05));break;
    case'upgrade':[440,660,880].forEach((f,i)=>tone(f,0.1,'triangle',0.18,i*0.04));break;
    case'unlock':[300,500,700,900,1200].forEach((f,i)=>tone(f,0.2,'sine',0.22,i*0.06));break;
    case'char':
      [523,659,784,880,1047,1319,1568,2093].forEach((f,i)=>tone(f,0.3,'sine',0.3,i*0.05));
      setTimeout(()=>[1568,1319,1047,880].forEach((f,i)=>tone(f,0.2,'triangle',0.22,i*0.05)),600);break;
    case'slot':for(let i=0;i<4;i++)tone(350+Math.random()*200,0.04,'square',0.08,i*0.04);break;
    case'flip':tone(800,0.08,'sine',0.15);break;
    case'spin':tone(200,0.4,'sine',0.1);break;
    case'crash_tick':tone(440,0.03,'square',0.06);break;
    case'day':[440,554,659].forEach((f,i)=>tone(f,0.15,'sine',0.2,i*0.06));break;
    case'pc_sell':[880,1100,1320,1760].forEach((f,i)=>tone(f,0.15,'triangle',0.22,i*0.05));break;
  }
}

let bgMusicOn=false;
let bgMusicNodes=[];
let bgMusicScheduler=null;
let bgBeat=0;

const BG_BPM=118;
const BG_BEAT_DUR=60/BG_BPM;
const BG_BASS=[65.41,65.41,73.42,77.78,65.41,65.41,87.31,82.41];
const BG_BASS_OCT=[130.81,130.81,146.83,155.56,130.81,130.81,174.61,164.81];
const BG_PAD_FREQS=[261.63,329.63,392,523.25];

function bgTone(freq,dur,type,vol,delay,dest){
  if(!audioCtx)return;
  try{
    const o=audioCtx.createOscillator();
    const g=audioCtx.createGain();
    const filt=audioCtx.createBiquadFilter();
    filt.type='lowpass';filt.frequency.value=2200;
    o.type=type;o.frequency.value=freq;
    g.gain.setValueAtTime(0,audioCtx.currentTime+delay);
    g.gain.linearRampToValueAtTime(vol,audioCtx.currentTime+delay+0.02);
    g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+delay+dur);
    o.connect(filt);filt.connect(g);g.connect(dest);
    o.start(audioCtx.currentTime+delay);o.stop(audioCtx.currentTime+delay+dur+0.05);
    bgMusicNodes.push(o);
  }catch(e){}
}

function scheduleBgMeasure(){
  if(!bgMusicOn||!audioCtx)return;
  const masterGain=audioCtx.createGain();masterGain.gain.value=0.18;masterGain.connect(audioCtx.destination);
  const compressor=audioCtx.createDynamicsCompressor();compressor.connect(masterGain);
  const measure=bgBeat*BG_BEAT_DUR*8;
  for(let b=0;b<8;b++){
    const bt=measure+b*BG_BEAT_DUR;
    bgTone(BG_BASS[b],BG_BEAT_DUR*0.85,'sawtooth',0.18,bt,compressor);
    bgTone(BG_BASS_OCT[b],BG_BEAT_DUR*0.55,'sawtooth',0.06,bt,compressor);
    if(b%2===0){
      bgTone(80,0.04,'square',0.15,bt,compressor);
    }
    if(b%2===1){
      for(let i=0;i<3;i++){
        bgTone(220+Math.random()*20,0.05,'square',0.04,bt+0.01+i*0.015,compressor);
      }
    }
    if(b===0||b===4){
      BG_PAD_FREQS.forEach((f,i)=>{
        bgTone(f,BG_BEAT_DUR*3.8,'sine',0.025,bt+i*0.01,compressor);
        bgTone(f*2,BG_BEAT_DUR*2,'sine',0.01,bt,compressor);
      });
    }
    if(b%4===2){
      bgTone(440,BG_BEAT_DUR*0.5,'triangle',0.04,bt,compressor);
      bgTone(554,BG_BEAT_DUR*0.5,'triangle',0.03,bt+0.01,compressor);
    }
  }
  bgBeat++;
}

function startBgMusic(){
  if(!audioCtx)initAudio();
  bgMusicOn=true;bgBeat=0;
  bgMusicNodes=[];
  scheduleBgMeasure();
  bgMusicScheduler=setInterval(()=>{
    if(!bgMusicOn){clearInterval(bgMusicScheduler);return}
    scheduleBgMeasure();
  },BG_BEAT_DUR*8*1000-100);
  document.getElementById('musicBtn').textContent='üéµ MUSIC: ON';
  document.getElementById('musicBtn').classList.add('on');
}

function stopBgMusic(){
  bgMusicOn=false;
  clearInterval(bgMusicScheduler);
  bgMusicNodes.forEach(n=>{try{n.stop()}catch(e){}});
  bgMusicNodes=[];
  document.getElementById('musicBtn').textContent='üéµ MUSIC: OFF';
  document.getElementById('musicBtn').classList.remove('on');
}

function toggleBgMusic(){
  initAudio();
  if(bgMusicOn)stopBgMusic();else startBgMusic();
}

const S={
  cash:1000,btc:0,btcPrice:50000,hashrate:1,
  btcPerClick:0.000001,miningProgress:0,
  autoSell:false,overclocked:false,poolActive:false,
  day:1,jackpot:25000,
  totalWon:0,totalLost:0,biggestWin:0,winStreak:0,
  minesActive:false,minesGrid:[],minesRevealed:0,minesCount:3,minesBet:0,
  coinFlipping:false,wheelSpinning:false,slotsSpinning:false,
  crashActive:false,crashBet:0,crashHistory:[],
  crashState:'idle',crashBetActive:false,
  pcInventory:[],builtPCs:[],
  pcBench:{cpu:null,gpu:null,ram:null,psu:null,mobo:null,case:null,cooler:null,storage:null},
  selectedPart:null,currentCondTab:'used',
  activeChar:0,ownedChars:[0],
  upgrades:{
    lgpu:{count:0,cost:200,name:'Laptop GPU',icon:'üíª',boost:20,desc:'+20 H/s'},
    dgpu:{count:0,cost:800,name:'Desktop GPU',icon:'üéÆ',boost:100,desc:'+100 H/s'},
    rig:{count:0,cost:3500,name:'GPU Mining Rig',icon:'‚öôÔ∏è',boost:600,desc:'+600 H/s'},
    asic:{count:0,cost:8000,name:'ASIC Miner',icon:'üî©',boost:2000,desc:'+2,000 H/s'},
    farm:{count:0,cost:30000,name:'Mining Farm',icon:'üè≠',boost:10000,desc:'+10,000 H/s'},
    quantum:{count:0,cost:100000,name:'Quantum Array',icon:'‚öõÔ∏è',boost:50000,desc:'+50,000 H/s'},
    moon:{count:0,cost:500000,name:'Moon Cluster',icon:'üåô',boost:500000,desc:'+500K H/s'}
  },
  stocks:{},pcMarketMult:1,
  daySkipsUsed:0,daySkipResetAt:12
};

const CHARS=[
  {name:'ZARA',title:'The Beginner',quote:'Double or nothing, darling! This is just the start.',color:'#bf00ff',skin:'#8B4513',hair:'#9400D3',price:0,mult:1,unlockText:'Your starting character!'},
  {name:'MAX',title:'The Hustler',quote:'Feeling lucky? I always do. Grind never stops.',color:'#00fff5',skin:'#FFDEAD',hair:'#1a1a1a',price:150000,mult:1.5,unlockText:'ALL earnings 1.5√ó!'},
  {name:'LUNA',title:'The Oracle',quote:'The odds are merely suggestions to someone like me.',color:'#ffd700',skin:'#FAEBD7',hair:'#C0C0C0',price:750000,mult:2,unlockText:'ALL earnings 2√ó!'},
  {name:'RICO',title:'The Whale',quote:'Big bets, bigger wins. Fortune favors the bold.',color:'#39ff14',skin:'#D2691E',hair:'#2F1B0E',price:3000000,mult:2.5,unlockText:'ALL earnings 2.5√ó!'},
  {name:'NEO',title:'The Algorithm',quote:'I see the matrix of probability. Nothing is chance.',color:'#ff006e',skin:'#F5DEB3',hair:'#00ff00',price:15000000,mult:3,unlockText:'ALL earnings 3√ó! GODMODE.'}
];

const HAIRSVG=[
  (h)=>`<ellipse cx="35" cy="14" rx="16" ry="12" fill="${h}"/><rect x="19" y="14" width="32" height="8" fill="${h}" rx="2"/>`,
  (h)=>`<rect x="20" y="6" width="30" height="16" fill="${h}" rx="4"/><rect x="24" y="4" width="6" height="14" fill="${h}" rx="2"/>`,
  (h)=>`<ellipse cx="35" cy="13" rx="17" ry="10" fill="${h}"/><ellipse cx="22" cy="20" rx="4" ry="10" fill="${h}"/><ellipse cx="48" cy="20" rx="4" ry="10" fill="${h}"/>`,
  (h)=>`<path d="M19 22 Q22 8 35 10 Q48 8 51 22 Q45 16 35 16 Q25 16 19 22Z" fill="${h}"/><circle cx="26" cy="24" r="4" fill="${h}"/><circle cx="44" cy="24" r="4" fill="${h}"/>`,
  (h)=>`<rect x="28" y="4" width="14" height="22" fill="${h}" rx="3"/><ellipse cx="35" cy="14" rx="12" ry="6" fill="${h}"/>`
];
const ACCSVG=[
  ()=>'',
  (c)=>`<rect x="30" y="28" width="10" height="3" fill="#333" rx="1"/><rect x="26" y="29" width="5" height="3" fill="#555" rx="1"/><rect x="39" y="29" width="5" height="3" fill="#555" rx="1"/>`,
  (c)=>`<circle cx="22" cy="32" r="3" fill="${c}" opacity="0.8"/>`,
  (c)=>`<polygon points="35,24 37,28 35,30 33,28" fill="${c}"/>`,
  ()=>`<rect x="20" y="27" width="30" height="4" fill="#333" rx="2"/>`
];

function mkCharSVG(c,idx,w=70,h=110){
  return `<svg width="${w}" height="${h}" viewBox="0 0 70 110">
    <circle cx="35" cy="28" r="16" fill="${c.skin}"/>
    ${HAIRSVG[idx](c.hair)}
    <circle cx="30" cy="26" r="2.5" fill="#222"/>
    <circle cx="40" cy="26" r="2.5" fill="#222"/>
    <circle cx="31" cy="25.5" r="1" fill="#fff"/>
    <circle cx="41" cy="25.5" r="1" fill="#fff"/>
    <ellipse cx="35" cy="33" rx="4" ry="2" fill="${c.skin}" opacity="0.6"/>
    <path d="M31 36 Q35 39 39 36" stroke="#c0706b" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    ${ACCSVG[idx](c.color)}
    <rect x="24" y="43" width="22" height="28" rx="6" fill="${c.color}" opacity="0.9"/>
    <rect x="24" y="43" width="22" height="6" rx="3" fill="${c.color}"/>
    <line x1="35" y1="43" x2="35" y2="71" stroke="rgba(0,0,0,0.22)" stroke-width="1.5"/>
    <rect x="12" y="44" width="14" height="20" rx="5" fill="${c.skin}"/>
    <rect x="44" y="44" width="14" height="20" rx="5" fill="${c.skin}"/>
    <rect x="26" y="70" width="9" height="28" rx="5" fill="${c.skin}"/>
    <rect x="35" y="70" width="9" height="28" rx="5" fill="${c.skin}"/>
    <rect x="24" y="85" width="11" height="10" rx="3" fill="#222"/>
    <rect x="35" y="85" width="11" height="10" rx="3" fill="#222"/>
  </svg>`;
}

const PARTS_CAT={
  cpu:[
    {id:'c0',name:'Phenom II X4 965',tier:1,nP:40,uP:18,spec:'4-core 3.4GHz AM3',icon:'üß†',socket:'AM3',ramType:'DDR3'},
    {id:'c0b',name:'AMD FX-8350',tier:1,nP:55,uP:28,spec:'8-core 4.0GHz AM3+',icon:'üß†',socket:'AM3+',ramType:'DDR3'},
    {id:'c1',name:'Celeron G6900',tier:1,nP:80,uP:45,spec:'2-core 3.4GHz LGA1700',icon:'üß†',socket:'LGA1700',ramType:'DDR4'},
    {id:'c1b',name:'Core i7-12700K',tier:2,nP:420,uP:250,spec:'12-core 5.0GHz LGA1700',icon:'üß†',socket:'LGA1700',ramType:'DDR4'},
    {id:'c2',name:'Ryzen 5 5600X',tier:2,nP:320,uP:185,spec:'6-core 4.6GHz AM4',icon:'üß†',socket:'AM4',ramType:'DDR4'},
    {id:'c2b',name:'Ryzen 9 7950X',tier:3,nP:750,uP:440,spec:'16-core 5.7GHz AM5',icon:'üß†',socket:'AM5',ramType:'DDR5'},
    {id:'c3',name:'Core i9-13900K',tier:3,nP:800,uP:480,spec:'24-core 5.8GHz LGA1700',icon:'üß†',socket:'LGA1700',ramType:'DDR4'}
  ],
  gpu:[
    {id:'g0',name:'RX 580',tier:1,nP:150,uP:75,spec:'8GB GDDR5 1340MHz',icon:'üéÆ'},
    {id:'g1',name:'GT 1030',tier:1,nP:120,uP:65,spec:'2GB GDDR5',icon:'üéÆ'},
    {id:'g1b',name:'RX 6600',tier:2,nP:280,uP:165,spec:'8GB GDDR6 2491MHz',icon:'üéÆ'},
    {id:'g2',name:'RTX 3060',tier:2,nP:450,uP:260,spec:'12GB GDDR6',icon:'üéÆ'},
    {id:'g2b',name:'RTX 4070 Ti',tier:3,nP:900,uP:540,spec:'12GB GDDR6X',icon:'üéÆ'},
    {id:'g3',name:'RTX 4090',tier:3,nP:1600,uP:950,spec:'24GB GDDR6X',icon:'üéÆ'},
    {id:'g3b',name:'RX 7900 XTX',tier:3,nP:1100,uP:660,spec:'24GB GDDR6',icon:'üéÆ'}
  ],
  ram:[
    {id:'r0',name:'4GB DDR3',tier:1,nP:18,uP:8,spec:'4GB 1333MHz DDR3',icon:'üíæ',ramType:'DDR3'},
    {id:'r0b',name:'16GB DDR3',tier:1,nP:35,uP:18,spec:'16GB 1600MHz DDR3',icon:'üíæ',ramType:'DDR3'},
    {id:'r1',name:'8GB DDR4',tier:1,nP:35,uP:20,spec:'8GB 3200MHz DDR4',icon:'üíæ',ramType:'DDR4'},
    {id:'r1b',name:'16GB DDR4',tier:2,nP:65,uP:38,spec:'16GB 3600MHz DDR4',icon:'üíæ',ramType:'DDR4'},
    {id:'r2',name:'32GB DDR5',tier:2,nP:130,uP:80,spec:'32GB 5600MHz DDR5',icon:'üíæ',ramType:'DDR5'},
    {id:'r3',name:'64GB DDR5 OC',tier:3,nP:320,uP:190,spec:'64GB 6000MHz DDR5',icon:'üíæ',ramType:'DDR5'}
  ],
  psu:[
    {id:'p0',name:'350W Bronze',tier:1,nP:38,uP:18,spec:'350W 80+ Bronze',icon:'‚ö°'},
    {id:'p1',name:'450W Bronze',tier:1,nP:50,uP:28,spec:'450W 80+ Bronze',icon:'‚ö°'},
    {id:'p2',name:'750W Gold',tier:2,nP:120,uP:72,spec:'750W 80+ Gold',icon:'‚ö°'},
    {id:'p2b',name:'850W Platinum',tier:2,nP:160,uP:95,spec:'850W 80+ Platinum',icon:'‚ö°'},
    {id:'p3',name:'1200W Platinum',tier:3,nP:280,uP:165,spec:'1200W 80+ Platinum',icon:'‚ö°'},
    {id:'p3b',name:'1600W Titanium',tier:3,nP:420,uP:250,spec:'1600W 80+ Titanium',icon:'‚ö°'}
  ],
  mobo:[
    {id:'m0',name:'990FX Sabertooth',tier:1,nP:60,uP:35,spec:'AM3+, DDR3',icon:'üîå',socket:'AM3+',ramType:'DDR3'},
    {id:'m1',name:'B450 AORUS',tier:1,nP:90,uP:55,spec:'AM4, 4√óDDR4',icon:'üîå',socket:'AM4',ramType:'DDR4'},
    {id:'m1b',name:'Z490 Gaming',tier:2,nP:150,uP:90,spec:'LGA1200, DDR4',icon:'üîå',socket:'LGA1700',ramType:'DDR4'},
    {id:'m2',name:'B650E Carbon',tier:2,nP:200,uP:120,spec:'AM5, 4√óDDR5',icon:'üîå',socket:'AM5',ramType:'DDR5'},
    {id:'m2b',name:'X670E ROG',tier:3,nP:340,uP:200,spec:'AM5, OC DDR5',icon:'üîå',socket:'AM5',ramType:'DDR5'},
    {id:'m3',name:'Z790 APEX',tier:3,nP:380,uP:230,spec:'LGA1700, OC DDR4',icon:'üîå',socket:'LGA1700',ramType:'DDR4'}
  ],
  case:[
    {id:'cs1',name:'Budget Mini',tier:1,nP:35,uP:18,spec:'Micro ATX',icon:'üñ•'},
    {id:'cs1b',name:'Fractal Meshify C',tier:2,nP:65,uP:38,spec:'Mid Tower ATX',icon:'üñ•'},
    {id:'cs2',name:'NZXT H7 Flow',tier:2,nP:90,uP:55,spec:'Mid Tower ATX',icon:'üñ•'},
    {id:'cs2b',name:'Corsair 5000X',tier:2,nP:110,uP:65,spec:'Mid Tower ATX RGB',icon:'üñ•'},
    {id:'cs3',name:'Lian Li O11 XL',tier:3,nP:180,uP:110,spec:'Full Tower E-ATX',icon:'üñ•'},
    {id:'cs3b',name:'Phanteks Enthoo',tier:3,nP:220,uP:130,spec:'Full Tower E-ATX',icon:'üñ•'}
  ],
  cooler:[
    {id:'co1',name:'Box Cooler',tier:1,nP:25,uP:10,spec:'Air 65W',icon:'‚ùÑÔ∏è'},
    {id:'co1b',name:'Deepcool AK620',tier:2,nP:55,uP:32,spec:'Air 260W Dual Tower',icon:'‚ùÑÔ∏è'},
    {id:'co2',name:'Noctua NH-D15',tier:2,nP:80,uP:50,spec:'Air 250W',icon:'‚ùÑÔ∏è'},
    {id:'co2b',name:'240mm AIO',tier:2,nP:100,uP:60,spec:'240mm Liquid',icon:'‚ùÑÔ∏è'},
    {id:'co3',name:'360mm AIO',tier:3,nP:190,uP:112,spec:'360mm Liquid',icon:'‚ùÑÔ∏è'},
    {id:'co3b',name:'Custom Loop',tier:3,nP:350,uP:210,spec:'Full Custom Liquid',icon:'‚ùÑÔ∏è'}
  ],
  storage:[
    {id:'st1',name:'500GB HDD',tier:1,nP:30,uP:14,spec:'500GB 7200RPM SATA',icon:'üíø'},
    {id:'st1b',name:'1TB HDD',tier:1,nP:45,uP:22,spec:'1TB 7200RPM SATA',icon:'üíø'},
    {id:'st2',name:'500GB SSD',tier:2,nP:70,uP:40,spec:'500GB SATA 550MB/s',icon:'üíø'},
    {id:'st2b',name:'1TB NVMe Gen3',tier:2,nP:110,uP:65,spec:'1TB PCIe 3.0 3500MB/s',icon:'üíø'},
    {id:'st3',name:'2TB NVMe Gen4',tier:3,nP:220,uP:130,spec:'2TB PCIe 4.0 7000MB/s',icon:'üíø'},
    {id:'st3b',name:'4TB NVMe Gen5',tier:3,nP:420,uP:250,spec:'4TB PCIe 5.0 12000MB/s',icon:'üíø'}
  ]
};

const SLOT_TYPES=['cpu','gpu','ram','psu','mobo','case','cooler','storage'];
const SLOT_LABELS={cpu:'CPU',gpu:'GPU',ram:'RAM',psu:'PSU',mobo:'MOTHERBOARD',case:'CASE',cooler:'COOLER',storage:'STORAGE'};
const SLOT_ICONS={cpu:'üß†',gpu:'üéÆ',ram:'üíæ',psu:'‚ö°',mobo:'üîå',case:'üñ•',cooler:'‚ùÑÔ∏è',storage:'üíø'};
const TIER_NAMES={1:'BUDGET',2:'MID-RANGE',3:'HIGH-END'};

const STOCKS=[
  {ticker:'NEON',name:'Neon Corp',icon:'üí°',price:120,color:'#00fff5',history:[]},
  {ticker:'VCOIN',name:'VaultCoin',icon:'ü™ô',price:450,color:'#ffd700',history:[]},
  {ticker:'QNTM',name:'Quantum AI',icon:'‚öõÔ∏è',price:890,color:'#bf00ff',history:[]},
  {ticker:'MTRX',name:'Matrix Labs',icon:'üîÆ',price:67,color:'#39ff14',history:[]},
  {ticker:'XNRG',name:'X-Energy',icon:'‚ö°',price:234,color:'#ff006e',history:[]}
];
STOCKS.forEach(st=>{
  S.stocks[st.ticker]={owned:0,avgBuy:0};
  for(let i=0;i<20;i++) st.history.push(st.price*(0.8+Math.random()*0.4));
});

const bgCv=document.getElementById('bg');
const bgX=bgCv.getContext('2d');
let pts=[];
function rszBg(){bgCv.width=innerWidth;bgCv.height=innerHeight}
rszBg();window.addEventListener('resize',rszBg);
class Pt{
  constructor(){this.rst()}
  rst(){this.x=Math.random()*bgCv.width;this.y=Math.random()*bgCv.height;
    this.sz=Math.random()*2+0.5;this.vx=(Math.random()-0.5)*0.38;this.vy=(Math.random()-0.5)*0.38;
    this.op=Math.random()*0.5+0.1;this.hue=Math.random()<0.5?180:300}
  upd(){this.x+=this.vx;this.y+=this.vy;
    if(this.x<0||this.x>bgCv.width||this.y<0||this.y>bgCv.height)this.rst()}
  drw(){bgX.save();bgX.globalAlpha=this.op;bgX.fillStyle=`hsl(${this.hue},100%,60%)`;
    bgX.shadowBlur=6;bgX.shadowColor=`hsl(${this.hue},100%,60%)`;
    bgX.beginPath();bgX.arc(this.x,this.y,this.sz,0,Math.PI*2);bgX.fill();bgX.restore()}
}
for(let i=0;i<120;i++) pts.push(new Pt());
let bgt=0;
function animBg(){
  bgX.clearRect(0,0,bgCv.width,bgCv.height);
  bgX.fillStyle='rgba(5,5,16,0.28)';bgX.fillRect(0,0,bgCv.width,bgCv.height);
  bgt+=0.0018;
  const grd=bgX.createRadialGradient(bgCv.width*0.5+Math.sin(bgt)*bgCv.width*0.28,
    bgCv.height*0.5+Math.cos(bgt*0.7)*bgCv.height*0.28,0,bgCv.width*0.5,bgCv.height*0.5,bgCv.width*0.8);
  grd.addColorStop(0,'rgba(0,50,70,0.1)');grd.addColorStop(0.5,'rgba(50,0,70,0.05)');grd.addColorStop(1,'transparent');
  bgX.fillStyle=grd;bgX.fillRect(0,0,bgCv.width,bgCv.height);
  pts.forEach(p=>{p.upd();p.drw()});
  for(let i=0;i<pts.length;i++){
    for(let j=i+1;j<pts.length;j++){
      const dx=pts[i].x-pts[j].x,dy=pts[i].y-pts[j].y,d=Math.sqrt(dx*dx+dy*dy);
      if(d<75){bgX.save();bgX.globalAlpha=0.035*(1-d/75);bgX.strokeStyle='#00fff5';
        bgX.lineWidth=0.5;bgX.beginPath();bgX.moveTo(pts[i].x,pts[i].y);bgX.lineTo(pts[j].x,pts[j].y);bgX.stroke();bgX.restore()}
    }
  }
  requestAnimationFrame(animBg);
}
animBg();

function fmt(n){return'$'+n.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,',')}
function fmtN(n){if(n>=1e12)return'$'+(n/1e12).toFixed(2)+'T';if(n>=1e9)return'$'+(n/1e9).toFixed(2)+'B';
  if(n>=1e6)return'$'+(n/1e6).toFixed(2)+'M';if(n>=1e3)return'$'+(n/1e3).toFixed(2)+'K';return'$'+n.toFixed(2)}
function fmtB(n){return n.toFixed(8)}
function fmtH(n){if(n>=1e12)return(n/1e12).toFixed(2)+'TH/s';if(n>=1e9)return(n/1e9).toFixed(2)+'GH/s';
  if(n>=1e6)return(n/1e6).toFixed(2)+'MH/s';if(n>=1e3)return(n/1e3).toFixed(2)+'KH/s';return n+' H/s'}

function getMult(){return CHARS[S.activeChar].mult}

function portVal(){return STOCKS.reduce((a,st)=>a+(S.stocks[st.ticker].owned*st.price),0)}

function updHUD(){
  document.getElementById('hCash').textContent=fmtN(S.cash);
  document.getElementById('hBtc').textContent=fmtB(S.btc);
  document.getElementById('hDay').textContent=S.day;
  const eff=S.overclocked?S.hashrate*3:S.hashrate;
  const pool=S.poolActive?1.15:1;
  const inc=(eff*0.000001/60)*S.btcPrice*pool*getMult();
  document.getElementById('hInc').textContent=fmtN(inc)+'/s';
  document.getElementById('nwT').textContent=fmtN(S.cash+S.btc*S.btcPrice+portVal());
  document.getElementById('nwW').textContent=fmtN(S.totalWon);
  document.getElementById('nwL').textContent=fmtN(S.totalLost);
  document.getElementById('nwS').textContent=S.winStreak;
  document.getElementById('nwB').textContent=fmtN(S.biggestWin);
  const c=CHARS[S.activeChar];
  document.getElementById('hudCharName').textContent=c.name;
  document.getElementById('hudCharMult').textContent=c.mult+'x';
  document.getElementById('hudCharMult').style.color=c.color;
  document.getElementById('hudCharSvg').innerHTML=mkCharSVG(c,S.activeChar,28,28);
}

function updLocks(){
  const casinoLocked=S.day<10;
  const crashLocked=S.day<15;

  const cOverlay=document.getElementById('casinoLock');
  const cNavBtn=document.getElementById('n-casino');
  if(cOverlay){
    cOverlay.style.display=casinoLocked?'flex':'none';
    if(casinoLocked){
      document.getElementById('lockDayNum').textContent=S.day;
      document.getElementById('lockDaySub').textContent=`Day ${S.day} / 10`;
      const arc=document.getElementById('lockRingArc');
      arc.setAttribute('stroke-dasharray',`${(S.day/10)*100} 100`);
    }
  }
  if(cNavBtn){
    if(casinoLocked){cNavBtn.classList.add('locked');cNavBtn.title='Unlocks on Day 10'}
    else{cNavBtn.classList.remove('locked');cNavBtn.title=''}
  }

  const crOverlay=document.getElementById('crashLock');
  const crNavBtn=document.getElementById('n-crash');
  if(crOverlay){
    crOverlay.style.display=crashLocked?'flex':'none';
    if(crashLocked){
      document.getElementById('crashLockNum').textContent=S.day;
      document.getElementById('crashLockSub').textContent=`Day ${S.day} / 15`;
      document.getElementById('crashLockArc').setAttribute('stroke-dasharray',`${(S.day/15)*100} 100`);
    }
  }
  if(crNavBtn){
    if(crashLocked){crNavBtn.classList.add('locked');crNavBtn.title='Unlocks on Day 15'}
    else{crNavBtn.classList.remove('locked');crNavBtn.title=''}
  }
}

function flash(id){const el=document.getElementById(id);if(!el)return;
  const p=el.parentElement;p.classList.remove('swf');void p.offsetWidth;p.classList.add('swf')}

function toast(msg,type='info'){
  const t=document.getElementById('toast');t.textContent=msg;t.className='toast '+type;
  void t.offsetWidth;t.classList.add('show');clearTimeout(t._t);
  t._t=setTimeout(()=>t.classList.remove('show'),3000);
}

function win(amount,skipMult=false){
  const mult=skipMult?1:getMult();
  const actual=amount*mult;
  S.cash+=actual;S.totalWon+=actual;S.winStreak++;
  if(actual>S.biggestWin){S.biggestWin=actual;if(actual>1000)toast('üèÜ NEW BEST WIN! '+fmtN(actual),'gold')}
  flash('hCash');updHUD();return actual;
}
function lose(amount){
  const actual=Math.min(amount,S.cash);
  S.cash-=actual;S.totalLost+=actual;S.winStreak=0;flash('hCash');updHUD();return actual;
}

function showSec(id){
  if(id==='casino'&&S.day<10){toast('üîí Casino unlocks on Day 10!','error');sfx('lose');return}
  if(id==='crash'&&S.day<15){toast('üîí Crash unlocks on Day 15!','error');sfx('lose');return}
  if(id==='stage2'&&!S.stage2){toast('üîí Reach $100T net worth to unlock!','error');sfx('lose');return}
    document.querySelectorAll('.sec').forEach(s=>{s.classList.remove('active');s.style.display=''});
  document.querySelectorAll('.nb').forEach(b=>b.classList.remove('active'));
  const secEl=document.getElementById('sec-'+id);
  if(secEl){secEl.classList.add('active')}
  const nbEl=document.getElementById('n-'+id);
  if(nbEl)nbEl.classList.add('active');
  sfx('click');
  window.scrollTo({top:0,behavior:'instant'});
  if(id==='stocks'){updStocksUI()}
  if(id==='lobby'){updLobby()}
  if(id==='chars'){buildCharPage()}
  if(id==='pcshop'){renderPartsGrid();renderInventory();renderGarage()}
}

function clickMine(e){
  sfx('mine');
  const btn=document.getElementById('mineOrb');
  const p=document.createElement('div');p.className='cprt';
  const eff=S.overclocked?S.hashrate*3:S.hashrate;
  const pool=S.poolActive?1.15:1;
  const perClick=S.btcPerClick*(1+eff*0.1)*pool;
  p.textContent='+‚Çø'+perClick.toFixed(8);
  p.style.left=(e.clientX-20)+'px';p.style.top=(e.clientY-20)+'px';
  p.style.position='fixed';
  document.body.appendChild(p);
  setTimeout(()=>p.remove(),1050);
  S.btc+=perClick;
  const mult=getMult();
  if(S.autoSell&&S.btcPrice>50000){
    const val=S.btc*S.btcPrice;win(val,true);
    S.totalWon+=val*(mult-1);S.btc=0;
    document.getElementById('btcDisp').textContent='‚Çø 0.00000000';
  } else {
    S.miningProgress+=perClick;
    if(S.miningProgress>=0.001){S.miningProgress=0;toast('‚õè Block reward! +‚Çø0.001','info')}
    const pct=Math.min((S.miningProgress/0.001)*100,100);
    document.getElementById('bkPct').textContent=pct.toFixed(1)+'%';
    document.getElementById('bkFill').style.width=pct+'%';
    const bEl=document.getElementById('btcDisp');bEl.textContent='‚Çø '+fmtB(S.btc);
    bEl.classList.remove('pop');void bEl.offsetWidth;bEl.classList.add('pop');
  }
  if(S.overclocked&&Math.random()<0.004){
    toast('üî• Overclock burnout! Hashrate reset for 5s','error');sfx('boom');
    S.overclocked=false;
    document.getElementById('ocToggle').classList.remove('on');
    setTimeout(()=>{S.overclocked=true;document.getElementById('ocToggle').classList.add('on')},5000);
  }
  updHUD();
}

function sellBtc(){
  if(S.btc<0.00000001){toast('No BTC to sell!','error');return}
  sfx('sell');
  const usd=S.btc*S.btcPrice*getMult();
  S.cash+=usd;S.totalWon+=usd;
  toast('‚Çø Sold for '+fmtN(usd),'gold');
  S.btc=0;document.getElementById('btcDisp').textContent='‚Çø 0.00000000';
  flash('hCash');updHUD();
}

function autoSellToggle(){
  sfx('click');
  S.autoSell=!S.autoSell;
  document.getElementById('autoSellBtn').textContent='AUTO-SELL: '+(S.autoSell?'ON':'OFF');
  document.getElementById('autoSellBtn').style.opacity=S.autoSell?'1':'0.7';
}

function toggleOverclock(){
  sfx('click');
  S.overclocked=!S.overclocked;
  const t=document.getElementById('ocToggle');
  t.classList.toggle('on',S.overclocked);
  toast(S.overclocked?'‚ö° Overclock ON ‚Äî 3x hashrate!':'Overclock off.',S.overclocked?'info':'info');
  updHUD();
}

function togglePool(){
  sfx('click');
  S.poolActive=!S.poolActive;
  const t=document.getElementById('poolToggle');
  t.classList.toggle('on',S.poolActive);
  toast(S.poolActive?'üåê Mining Pool joined! +15% income':'Left mining pool.',S.poolActive?'success':'info');
  updHUD();
}

function buildUpgrades(){
  const g=document.getElementById('upgradesGrid');g.innerHTML='';
  Object.entries(S.upgrades).forEach(([k,u])=>{
    const r=document.createElement('div');r.className='ui';
    r.innerHTML=`<div class="ui-info">
      <div class="un">${u.icon} ${u.name}</div>
      <div class="ud">${u.desc}</div>
      <div class="uc">Owned: ${u.count} | HR: ${fmtH(u.count*u.boost)}</div>
    </div>
    <button class="btn btn-pk" onclick="buyUpgrade('${k}')" id="upg-${k}" style="font-size:9px;padding:5px 10px;white-space:nowrap">
      ${fmtN(u.cost)}</button>`;
    g.appendChild(r);
  });
}

function buyUpgrade(k){
  const u=S.upgrades[k];
  if(S.cash<u.cost){toast('Not enough cash!','error');sfx('lose');return}
  sfx('upgrade');S.cash-=u.cost;u.count++;
  S.hashrate+=u.boost;u.cost=Math.round(u.cost*1.55);
  S.btcPerClick=0.000001*(1+S.hashrate*0.08);
  toast(u.icon+' Bought '+u.name+'! '+fmtH(u.boost)+' added','success');
  buildUpgrades();updHUD();
}

function startPassiveMine(){
  setInterval(()=>{
    if(S.hashrate<=1)return;
    const eff=S.overclocked?S.hashrate*3:S.hashrate;
    const pool=S.poolActive?1.15:1;
    const gain=(eff*0.000001)/60*pool;
    S.btc+=gain;
    const btcEl=document.getElementById('btcDisp');
    if(btcEl) btcEl.textContent='‚Çø '+fmtB(S.btc);
    S.miningProgress+=gain;
    if(S.miningProgress>=0.001){S.miningProgress=0}
    const pct=Math.min((S.miningProgress/0.001)*100,100);
    const bkPct=document.getElementById('bkPct');
    const bkFill=document.getElementById('bkFill');
    if(bkPct)bkPct.textContent=pct.toFixed(1)+'%';
    if(bkFill)bkFill.style.width=pct+'%';
    if(S.autoSell&&S.btc*S.btcPrice>100){
      const val=S.btc*S.btcPrice*getMult();
      S.cash+=val;S.totalWon+=val;S.btc=0;
      if(btcEl)btcEl.textContent='‚Çø 0.00000000';flash('hCash');
    }
    S.btcPrice+=Math.round((Math.random()-0.48)*300);
    S.btcPrice=Math.max(15000,Math.min(300000,S.btcPrice));
    const btcPr=document.getElementById('btcPrDisp');
    if(btcPr)btcPr.textContent=S.btcPrice.toLocaleString();
    updHUD();
  },1000);
}

function renderPartsGrid(){
  const g=document.getElementById('partsGrid');if(!g)return;
  g.innerHTML='';
  const cond=S.currentCondTab;
  Object.entries(PARTS_CAT).forEach(([type,parts])=>{
    parts.forEach(pt=>{
      const price=cond==='used'?pt.uP:pt.nP;
      const c=document.createElement('div');c.className='part-card';
      let socketInfo='';
      if(pt.socket)socketInfo=`<div style="font-size:9px;color:rgba(255,150,50,0.8);margin-top:2px">Socket: ${pt.socket} | ${pt.ramType||''}</div>`;
      else if(pt.ramType&&type==='ram')socketInfo=`<div style="font-size:9px;color:rgba(100,180,255,0.8);margin-top:2px">${pt.ramType}</div>`;
      c.innerHTML=`<div class="pc-tier ${cond==='used'?'tier'+(pt.tier-1+1):'tier'+pt.tier}">${TIER_NAMES[pt.tier]}</div>
        <div class="pc-type">${type.toUpperCase()}</div>
        <div class="pc-name">${pt.icon} ${pt.name}</div>
        <div class="pc-spec">${pt.spec}</div>
        ${socketInfo}
        <div class="pc-price">${fmt(price)}</div>
        <div class="part-condition ${cond==='used'?'cond-used':'cond-new'}">${cond==='used'?'üî© USED ‚Äî may have wear':'‚ú® NEW ‚Äî mint condition'}</div>`;
      c.onclick=()=>buyPart(type,pt,cond);
      g.appendChild(c);
    });
  });
}

function partCondTab(cond){
  S.currentCondTab=cond;sfx('click');
  document.getElementById('ctab-used').classList.toggle('active',cond==='used');
  document.getElementById('ctab-new').classList.toggle('active',cond==='new');
  renderPartsGrid();
}

function buyPart(type,pt,cond){
  const price=cond==='used'?pt.uP:pt.nP;
  if(S.cash<price){toast('Not enough cash!','error');sfx('lose');return}
  sfx('buy');S.cash-=price;
  S.pcInventory.push({type,id:pt.id,name:pt.name,spec:pt.spec,icon:pt.icon,tier:pt.tier,
    cond,price,sellVal:cond==='used'?Math.round(price*0.75):price,
    socket:pt.socket||null,ramType:pt.ramType||null});
  toast('üõí Bought '+pt.name+' ('+cond+')','success');
  renderInventory();renderBenchInventory();
  document.getElementById('invCount').textContent='('+S.pcInventory.length+' parts)';
  updHUD();
}

function renderInventory(){
  const g=document.getElementById('inventoryGrid');if(!g)return;
  g.innerHTML='';
  if(!S.pcInventory.length){g.innerHTML='<div style="color:rgba(255,255,255,0.25);font-size:11px;font-family:Orbitron,monospace;grid-column:1/-1;padding:16px">No parts yet. Buy some!</div>';return}
  S.pcInventory.forEach((p,i)=>{
    const c=document.createElement('div');c.className='part-card';
    c.style.border=S.pcBench[p.type]===p?'1px solid var(--nc)':'';
    c.innerHTML=`<div class="pc-type">${p.type.toUpperCase()}</div>
      <div class="pc-name">${p.icon} ${p.name}</div>
      <div class="pc-spec">${p.spec}</div>
      <div class="pc-price">${fmt(p.price)}</div>
      <div class="part-condition ${p.cond==='used'?'cond-used':'cond-new'}">${p.cond==='used'?'üî© Used':'‚ú® New'}</div>`;
    g.appendChild(c);
  });
}

function pcTab(tab){
  sfx('click');
  ['shop','bench','garage'].forEach(t=>{
    document.getElementById('ptab-'+t).classList.toggle('active',t===tab);
    document.getElementById('pc-'+t+'-content').style.display=t===tab?'block':'none';
  });
  if(tab==='bench'){renderWbSlots();renderBenchInventory();updBuildEst();updDiagram()}
  if(tab==='garage'){renderGarage()}
}

function checkCompatibility(){
  const cpu=S.pcBench.cpu;
  const mobo=S.pcBench.mobo;
  const ram=S.pcBench.ram;
  const issues=[];
  if(cpu&&mobo){
    const cpuSock=cpu.socket;
    const mobSock=mobo.socket;
    const ok=(cpuSock===mobSock)||(cpuSock==='AM3'&&mobSock==='AM3+');
    if(!ok)issues.push(`CPU ${cpuSock} ‚â† Mobo ${mobSock} socket`);
  }
  if(mobo&&ram){
    const moboRam=mobo.ramType;
    const ramType=ram.ramType;
    if(moboRam&&ramType&&moboRam!==ramType)issues.push(`Mobo ${moboRam} ‚â† RAM ${ramType}`);
  }
  if(cpu&&ram){
    const cpuRam=cpu.ramType;
    const ramType=ram.ramType;
    if(cpuRam&&ramType&&cpuRam!==ramType)issues.push(`CPU needs ${cpuRam}, RAM is ${ramType}`);
  }
  return issues;
}

function updDiagram(){
  SLOT_TYPES.forEach(type=>{
    const slot=document.getElementById('diag-'+type);
    if(!slot)return;
    const part=S.pcBench[type];
    const nameEl=slot.querySelector('.pcd-slot-name');
    if(part){
      slot.classList.add('pcd-filled');
      if(!nameEl){
        const nd=document.createElement('div');nd.className='pcd-slot-name';
        nd.textContent=part.name;slot.appendChild(nd);
      }else{nameEl.textContent=part.name}
      const isAM3Part=(part.socket==='AM3'||part.socket==='AM3+')||(part.ramType==='DDR3');
      slot.classList.toggle('pcd-am3warn',isAM3Part);
    }else{
      slot.classList.remove('pcd-filled');
      slot.classList.remove('pcd-am3warn');
      if(nameEl)nameEl.remove();
    }
  });
  const issues=checkCompatibility();
  const warnEl=document.getElementById('compatWarn');
  const okEl=document.getElementById('compatOk');
  const hasAnyPart=SLOT_TYPES.some(t=>S.pcBench[t]);
  const allFilled=SLOT_TYPES.every(t=>S.pcBench[t]);
  if(hasAnyPart&&issues.length>0){
    warnEl.textContent='‚ö† '+issues.join(' | ');
    warnEl.classList.add('show');okEl.classList.remove('show');
  }else if(allFilled&&issues.length===0){
    okEl.classList.add('show');warnEl.classList.remove('show');
  }else{
    warnEl.classList.remove('show');okEl.classList.remove('show');
  }
}

function playScrew(type){
  const screw=document.getElementById('screw-'+type);
  if(!screw)return;
  screw.classList.remove('spinning');
  void screw.offsetWidth;
  screw.classList.add('spinning');
  setTimeout(()=>screw.classList.remove('spinning'),700);
}

function renderWbSlots(){
  const g=document.getElementById('wbSlots');if(!g)return;g.innerHTML='';
  SLOT_TYPES.forEach(type=>{
    const filled=S.pcBench[type];
    const d=document.createElement('div');d.className='wb-slot '+(filled?'filled':'');
    d.innerHTML=`<div class="wbs-icon">${filled?filled.icon:SLOT_ICONS[type]}</div>
      <div class="wbs-type">${SLOT_LABELS[type]}</div>
      ${filled?`<div class="wbs-name">${filled.name}</div>`:''}`;
    d.onclick=()=>{if(filled){sfx('click');S.pcBench[type]=null;renderWbSlots();renderBenchInventory();updBuildEst();updDiagram();}};
    g.appendChild(d);
  });
  const allFilled=SLOT_TYPES.every(t=>S.pcBench[t]);
  const issues=checkCompatibility();
  document.getElementById('buildBtn').disabled=!allFilled||issues.length>0;
}

function renderBenchInventory(){
  const g=document.getElementById('benchInventory');if(!g)return;g.innerHTML='';
  const avail=S.pcInventory.filter(p=>!SLOT_TYPES.some(t=>S.pcBench[t]===p));
  if(!avail.length){g.innerHTML='<div style="color:rgba(255,255,255,0.25);font-size:11px;font-family:Orbitron,monospace;grid-column:1/-1;padding:10px">All parts installed or no parts owned</div>';return}
  avail.forEach(p=>{
    const slotFilled=S.pcBench[p.type]!==null;
    const c=document.createElement('div');c.className='part-card';
    if(slotFilled)c.style.opacity='0.4';
    let sockInfo='';
    if(p.socket)sockInfo=`<div style="font-size:9px;color:rgba(255,150,50,0.8);margin-top:1px">${p.socket} ${p.ramType||''}</div>`;
    else if(p.ramType&&p.type==='ram')sockInfo=`<div style="font-size:9px;color:rgba(100,180,255,0.8);margin-top:1px">${p.ramType}</div>`;
    c.innerHTML=`<div class="pc-type">${p.type.toUpperCase()}</div>
      <div class="pc-name">${p.icon} ${p.name}</div>
      <div class="pc-spec">${p.spec}</div>
      ${sockInfo}
      <div class="part-condition ${p.cond==='used'?'cond-used':'cond-new'}">${p.cond==='used'?'üî© Used':'‚ú® New'}</div>
      <div style="margin-top:6px"><button class="btn btn-cy" style="font-size:9px;padding:4px 10px;width:100%" ${slotFilled?'disabled':''}>INSTALL</button></div>`;
    if(!slotFilled){c.querySelector('button').onclick=(e)=>{
      e.stopPropagation();sfx('click');S.pcBench[p.type]=p;
      playScrew(p.type);
      renderWbSlots();renderBenchInventory();updBuildEst();updDiagram();
    }}
    g.appendChild(c);
  });
}

function updBuildEst(){
  let total=0;let tiers=[];
  SLOT_TYPES.forEach(t=>{if(S.pcBench[t]){total+=S.pcBench[t].sellVal;tiers.push(S.pcBench[t].tier)}});
  if(!total){document.getElementById('buildEst').textContent='$0';return}
  const avgTier=tiers.reduce((a,b)=>a+b,0)/tiers.length;
  const markup=1.3+avgTier*0.25;
  const est=Math.round(total*markup*S.pcMarketMult);
  document.getElementById('buildEst').textContent=fmtN(est);
}

function buildPC(){
  const parts=SLOT_TYPES.map(t=>S.pcBench[t]);
  if(parts.some(p=>!p)){toast('Install all 8 parts first!','error');return}
  const issues=checkCompatibility();
  if(issues.length>0){toast('‚ö† Incompatible parts: '+issues[0],'error');sfx('lose');return}
  sfx('build');
  let totalCost=0;let tiers=[];let hasUsed=false;
  parts.forEach(p=>{totalCost+=p.price;tiers.push(p.tier);if(p.cond==='used')hasUsed=true});
  const avgTier=tiers.reduce((a,b)=>a+b,0)/tiers.length;
  const markup=1.3+avgTier*0.28;
  const condMod=hasUsed?0.82:1.0;
  const baseVal=Math.round(totalCost*markup*condMod*S.pcMarketMult);
  const build={
    id:Date.now(),name:getPCName(avgTier),parts:[...parts],
    tier:Math.round(avgTier),value:baseVal,hasUsed,built:S.day,
    specs:parts.map(p=>p.name).join(' | ')
  };
  S.pcInventory=S.pcInventory.filter(p=>!parts.includes(p));
  SLOT_TYPES.forEach(t=>{S.pcBench[t]=null});
  S.builtPCs.push(build);
  document.getElementById('garageCount').textContent=S.builtPCs.length;
  toast('üî® '+build.name+' built! Est. value: '+fmtN(baseVal),'success');
  renderWbSlots();renderBenchInventory();updBuildEst();updDiagram();
  document.getElementById('invCount').textContent='('+S.pcInventory.length+' parts)';
  setTimeout(()=>pcTab('garage'),500);
}

function clearBench(){
  sfx('click');SLOT_TYPES.forEach(t=>{S.pcBench[t]=null});renderWbSlots();renderBenchInventory();updBuildEst();updDiagram();
}

function getPCName(avgTier){
  const budg=['Budget Box','Office Rig','Basic Build','Legacy Rig'];
  const mid=['Mid Beast','Value King','Gaming Rig','Balanced Build'];
  const high=['Ultra Build','NEON X Elite','Quantum Beast','Apex Machine'];
  const arr=avgTier<1.7?budg:avgTier<2.5?mid:high;
  return arr[Math.floor(Math.random()*arr.length)];
}

function renderGarage(){
  const g=document.getElementById('garageGrid');if(!g)return;g.innerHTML='';
  const mLabels=['üìâ Buyer\'s Market','Normal','üìà Seller\'s Market'];
  const mIdx=S.pcMarketMult<0.95?0:S.pcMarketMult>1.15?2:1;
  document.getElementById('pcMarket').textContent=mLabels[mIdx];
  document.getElementById('pcMarket').style.color=mIdx===2?'var(--ngr)':mIdx===0?'#f44':'var(--nc)';
  if(!S.builtPCs.length){
    g.innerHTML='<div style="color:rgba(255,255,255,0.25);font-size:12px;font-family:Orbitron,monospace;padding:20px;text-align:center">No PCs built yet.<br>Go to Workbench and assemble!</div>';return;
  }
  S.builtPCs.forEach(pc=>{
    const currentVal=Math.round(pc.value*S.pcMarketMult);
    const profit=currentVal-pc.parts.reduce((a,p)=>a+p.price,0);
    const row=document.createElement('div');row.className='garage-item';
    row.innerHTML=`<div class="gi-icon">${pc.tier>=3?'üñ•':'üíª'}</div>
      <div class="gi-info">
        <div class="gi-name">${pc.name}</div>
        <div class="gi-spec">Built Day ${pc.built} ‚Ä¢ ${pc.hasUsed?'üî© Mixed':'‚ú® New'} ‚Ä¢ Tier ${pc.tier}</div>
        <div class="gi-spec" style="margin-top:3px;font-size:9px;color:rgba(255,255,255,0.3)">${pc.parts.map(p=>p.name).join(' + ')}</div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px">
        <div class="gi-val">${fmtN(currentVal)}</div>
        <div class="gi-trend ${profit>=0?'up':'dn'}">${profit>=0?'‚ñ≤':'‚ñº'} ${fmtN(Math.abs(profit))} profit</div>
        <button class="btn btn-gr" onclick="sellPC(${pc.id})" style="font-size:9px;padding:5px 12px">SELL PC</button>
      </div>`;
    g.appendChild(row);
  });
}

function sellPC(id){
  const pc=S.builtPCs.find(p=>p.id===id);if(!pc)return;
  sfx('pc_sell');
  const val=Math.round(pc.value*S.pcMarketMult);
  win(val);
  S.builtPCs=S.builtPCs.filter(p=>p.id!==id);
  document.getElementById('garageCount').textContent=S.builtPCs.length||'';
  toast('üñ• Sold '+pc.name+' for '+fmtN(val*getMult())+'!','gold');
  renderGarage();updHUD();
}

function minesMult(rev,total,mines){
  let m=1;
  for(let i=0;i<rev;i++){const s=total-mines-i,r=total-i;m*=r/s}
  return Math.max(m*0.97,1.01);
}

function startMines(){
  const bet=parseFloat(document.getElementById('mBet').value)||50;
  const mines=parseInt(document.getElementById('mCnt').value)||3;
  if(bet<=0||mines<1||mines>24){toast('Invalid settings!','error');return}
  if(S.cash<bet){toast('Not enough cash!','error');sfx('lose');return}
  sfx('click');
  S.cash-=bet;S.minesBet=bet;S.minesCount=mines;S.minesActive=true;S.minesRevealed=0;
  S.totalLost+=bet;S.winStreak=0;
  const pos=Array.from({length:25},(_,i)=>i);
  for(let i=pos.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[pos[i],pos[j]]=[pos[j],pos[i]]}
  const mSet=new Set(pos.slice(0,mines));
  S.minesGridFull=Array.from({length:25},(_,i)=>mSet.has(i));
  renderMinesGrid();
  document.getElementById('mStartBtn').disabled=true;
  document.getElementById('mCashBtn').disabled=false;
  document.getElementById('mMlt').textContent='1.00x';
  const st=document.getElementById('minesStatus');st.className='ms play';
  st.textContent=`üéÆ ${mines} mines hidden ‚Äî Bet: ${fmt(bet)}`;
  updHUD();
}

function renderMinesGrid(){
  const g=document.getElementById('minesGrid');g.innerHTML='';
  for(let i=0;i<25;i++){
    const c=document.createElement('div');c.className='mc'+(S.minesActive?'':' dis');
    c.dataset.i=i;if(S.minesActive)c.onclick=()=>revealCell(i);g.appendChild(c);
  }
}

function revealCell(idx){
  if(!S.minesActive)return;
  const cells=document.querySelectorAll('.mc');
  const cell=cells[idx];
  if(cell.classList.contains('rs')||cell.classList.contains('rm'))return;
  if(S.minesGridFull[idx]){
    sfx('boom');cell.classList.add('rm');cell.textContent='üí£';S.minesActive=false;
    cells.forEach(c=>{c.classList.add('dis');c.onclick=null});
    cells.forEach((c,i)=>{if(S.minesGridFull[i]&&!c.classList.contains('rm'))setTimeout(()=>{c.classList.add('rm');c.textContent='üí£'},80+i*25)});
    const st=document.getElementById('minesStatus');st.className='ms lose';st.textContent='üí• MINE HIT! Lost '+fmt(S.minesBet);
    document.getElementById('mStartBtn').disabled=false;document.getElementById('mCashBtn').disabled=true;
    toast('üí£ BOOM! Lost '+fmt(S.minesBet),'error');updHUD();
  } else {
    sfx('win');cell.classList.add('rs');cell.textContent='üíé';S.minesRevealed++;
    const safesLeft=25-S.minesCount-S.minesRevealed;
    if(safesLeft===0){cashMines();return}
    const mult=minesMult(S.minesRevealed,25,S.minesCount);
    document.getElementById('mMlt').textContent=mult.toFixed(2)+'x';
    const st=document.getElementById('minesStatus');st.className='ms play';
    st.textContent=`‚úÖ ${S.minesRevealed} safe! Cash out: ${fmt(S.minesBet*mult)}`;
  }
}

function cashMines(){
  if(!S.minesActive&&S.minesRevealed===0)return;
  if(S.minesRevealed===0){toast('Reveal at least one tile!','error');return}
  S.minesActive=false;sfx('bigwin');
  const mult=minesMult(S.minesRevealed,25,S.minesCount);
  const prize=S.minesBet*mult;
  document.querySelectorAll('.mc').forEach(c=>{c.classList.add('dis');c.onclick=null});
  win(prize);
  const st=document.getElementById('minesStatus');st.className='ms win';
  st.textContent=`üèÜ Cashed out! ${fmt(prize*getMult())} (${mult.toFixed(2)}x)`;
  document.getElementById('mStartBtn').disabled=false;document.getElementById('mCashBtn').disabled=true;
  toast('üí∞ Cashed out! +'+fmtN(prize*getMult()),'success');updHUD();
}

const SYMS=['7Ô∏è‚É£','üçí','üíé','‚Çø','‚≠ê','üîî','üçã','üéØ'];
const SPAYS={'7Ô∏è‚É£':{3:50,2:3},'‚Çø':{3:25,2:2},'üíé':{3:15,2:1.5},'‚≠ê':{3:8,2:1},'üéØ':{3:6,2:0.8},'üîî':{3:5,2:0.5},'üçí':{3:4,2:0.3},'üçã':{3:3,2:0}};

function initSlots(){
  for(let r=0;r<3;r++){
    const ri=document.getElementById('ri'+r);ri.innerHTML='';
    for(let i=0;i<24;i++){const s=document.createElement('div');s.className='reel-sym';s.textContent=SYMS[Math.floor(Math.random()*SYMS.length)];ri.appendChild(s)}
  }
}

function spinSlots(){
  if(S.slotsSpinning)return;
  const bet=parseFloat(document.getElementById('sBet').value)||25;
  if(S.cash<bet){toast('Not enough cash!','error');sfx('lose');return}
  if(bet<=0)return;
  sfx('slot');S.cash-=bet;S.totalLost+=bet;S.winStreak=0;S.slotsSpinning=true;
  document.getElementById('sBtn').disabled=true;
  const res=document.getElementById('slotsRes');res.textContent='';res.style.background='transparent';
  const jackpot=Math.random()<0.0004;
  S.jackpot+=bet*0.025;document.getElementById('jpVal').textContent=fmt(S.jackpot);
  const tgt=[];
  if(jackpot){for(let i=0;i<3;i++)tgt.push('7Ô∏è‚É£')}
  else if(Math.random()<0.28){const s=SYMS[Math.floor(Math.random()*SYMS.length)];tgt.push(s,s,s)}
  else if(Math.random()<0.45){const s=SYMS[Math.floor(Math.random()*SYMS.length)];const o=SYMS[Math.floor(Math.random()*SYMS.length)];
    const a=[s,s,o];for(let i=2;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}tgt.push(...a)}
  else{for(let i=0;i<3;i++)tgt.push(SYMS[Math.floor(Math.random()*SYMS.length)])}
  let done=0;
  [1200,1650,2100].forEach((dur,r)=>{
    const ri=document.getElementById('ri'+r);let pos=0,el=0;
    const iv=setInterval(()=>{
      pos-=18;if(pos<-78)pos+=78*(ri.children.length);
      ri.style.transform=`translateY(${pos-78}px)`;el+=16;
      if(el>=dur){
        clearInterval(iv);sfx('slot');
        const ln=ri.children.length-1;
        ri.children[ln].textContent=tgt[r];
        ri.children[ln-1].textContent=SYMS[Math.floor(Math.random()*SYMS.length)];
        ri.children[ln-2].textContent=SYMS[Math.floor(Math.random()*SYMS.length)];
        ri.style.transform=`translateY(${-(ri.children.length-3)*78}px)`;
        done++;if(done===3)setTimeout(()=>evalSlots(tgt,bet,jackpot),120);
      }
    },16);
  });
  updHUD();
}

function evalSlots(syms,bet,jackpot){
  S.slotsSpinning=false;document.getElementById('sBtn').disabled=false;
  const res=document.getElementById('slotsRes');
  if(jackpot){
    const prize=S.jackpot;S.jackpot=5000;document.getElementById('jpVal').textContent=fmt(S.jackpot);
    document.getElementById('jpVal').classList.add('jp-boom');
    setTimeout(()=>document.getElementById('jpVal').classList.remove('jp-boom'),2500);
    sfx('jackpot');win(prize);
    res.style.cssText='background:rgba(255,215,0,0.14);border:1px solid #ffd700;color:#ffd700';
    res.textContent='üéâ JACKPOT!! +'+fmtN(prize*getMult());
    document.getElementById('slotsWrap').classList.add('swf2');
    setTimeout(()=>document.getElementById('slotsWrap').classList.remove('swf2'),1600);
    toast('üé∞ JACKPOT!!! +'+fmtN(prize*getMult()),'gold');
  } else if(syms[0]===syms[1]&&syms[1]===syms[2]){
    const m=SPAYS[syms[0]]?.[3]||5;const prize=bet*m;
    sfx('bigwin');win(prize);
    res.style.cssText='background:rgba(57,255,20,0.1);border:1px solid #39ff14;color:#39ff14';
    res.textContent=`üé∞ THREE ${syms[0]}! +${fmtN(prize*getMult())} (${m}x)`;
    document.getElementById('slotsWrap').classList.add('swf2');
    setTimeout(()=>document.getElementById('slotsWrap').classList.remove('swf2'),1600);
    toast('üé∞ THREE OF A KIND! +'+fmtN(prize*getMult()),'success');
  } else if(syms[0]===syms[1]||syms[1]===syms[2]||syms[0]===syms[2]){
    const ms=syms[0]===syms[1]?syms[0]:syms[0]===syms[2]?syms[0]:syms[1];
    const m=SPAYS[ms]?.[2]||0;
    if(m>0){const prize=bet*m;sfx('win');win(prize);
      res.style.cssText='background:rgba(0,255,245,0.07);border:1px solid #00fff5;color:#00fff5';
      res.textContent=`‚ú® PAIR ${ms}! +${fmtN(prize*getMult())} (${m}x)`;
    } else {sfx('lose');res.style.cssText='background:rgba(255,0,0,0.07);border:1px solid #f44;color:#f44';res.textContent=`‚ùå No win! Lost ${fmt(bet)}`}
  } else {sfx('lose');res.style.cssText='background:rgba(255,0,0,0.07);border:1px solid #f44;color:#f44';res.textContent=`‚ùå No win! Lost ${fmt(bet)}`}
  updHUD();
}

function flipCoin(choice){
  if(S.coinFlipping)return;
  const bet=parseFloat(document.getElementById('cBet').value)||100;
  if(S.cash<bet){toast('Not enough cash!','error');sfx('lose');return}
  sfx('flip');S.cash-=bet;S.totalLost+=bet;S.winStreak=0;S.coinFlipping=true;
  const result=Math.random()<0.5?'heads':'tails';
  const coin=document.getElementById('coin3d');
  const spins=10+Math.floor(Math.random()*5);
  const endDeg=result==='heads'?spins*360:spins*360+180;
  coin.style.setProperty('--fto',endDeg+'deg');coin.style.setProperty('--fdur','1.6s');
  coin.classList.remove('flipping');void coin.offsetWidth;coin.classList.add('flipping');
  const res=document.getElementById('coinRes');res.textContent='üîÑ Flipping...';res.style.color='rgba(255,255,255,0.5)';
  setTimeout(()=>{
    S.coinFlipping=false;
    if(result===choice){sfx('win');const prize=bet*2;win(prize);
      res.textContent=`${result==='heads'?'üëë':'üåü'} ${result.toUpperCase()}! WIN +${fmtN(bet*getMult())}`;res.style.color='var(--ngr)';
      toast('ü™ô '+result.toUpperCase()+'! +'+fmtN(bet*getMult()),'success');
    } else {sfx('lose');
      res.textContent=`${result==='heads'?'üëë':'üåü'} ${result.toUpperCase()}! LOSE -${fmt(bet)}`;res.style.color='#f44';
      toast('ü™ô '+result.toUpperCase()+'! LOSE -'+fmt(bet),'error');
    }
    updHUD();
  },1700);
  updHUD();
}

const WSEGS=[
  {label:'LOSE',mult:0,col:'#2a0a0a'},{label:'2√ó',mult:2,col:'#0a2a0a'},
  {label:'LOSE',mult:0,col:'#1a0a2a'},{label:'3√ó',mult:3,col:'#1a2a0a'},
  {label:'0.5√ó',mult:0.5,col:'#0a1a2a'},{label:'5√ó',mult:5,col:'#2a2a0a'},
  {label:'LOSE',mult:0,col:'#2a0a1a'},{label:'1.5√ó',mult:1.5,col:'#0a2a1a'},
  {label:'LOSE',mult:0,col:'#2a1a0a'},{label:'10√ó',mult:10,col:'#1a2a1a'},
  {label:'2√ó',mult:2,col:'#0a1a1a'},{label:'50√óüéØ',mult:50,col:'#2a1a0a'}
];
let wAngle=0;

function drawWheel(ang){
  const cv=document.getElementById('wc');const ctx=cv.getContext('2d');
  const cx=128,cy=128,r=123;ctx.clearRect(0,0,256,256);
  const seg=2*Math.PI/WSEGS.length;
  WSEGS.forEach((s,i)=>{
    const st=ang+i*seg,en=st+seg;
    ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,r,st,en);ctx.closePath();
    ctx.fillStyle=s.col;ctx.fill();ctx.strokeStyle='rgba(255,255,255,0.08)';ctx.lineWidth=1;ctx.stroke();
    const mid=st+seg/2;ctx.save();ctx.translate(cx+Math.cos(mid)*r*0.64,cy+Math.sin(mid)*r*0.64);
    ctx.rotate(mid+Math.PI/2);ctx.fillStyle=s.mult===0?'#ff5555':s.mult>=10?'#ffd700':'#fff';
    ctx.font='bold 10px Orbitron,monospace';ctx.textAlign='center';ctx.fillText(s.label,0,0);ctx.restore();
  });
  ctx.beginPath();ctx.arc(cx,cy,18,0,Math.PI*2);ctx.fillStyle='#050510';ctx.fill();
  ctx.strokeStyle='var(--nc)';ctx.lineWidth=2;ctx.stroke();
  ctx.beginPath();ctx.arc(cx,cy,r+1,0,Math.PI*2);ctx.strokeStyle='rgba(0,255,245,0.35)';ctx.lineWidth=3;ctx.stroke();
}
drawWheel(0);

function spinWheel(){
  if(S.wheelSpinning)return;
  const bet=parseFloat(document.getElementById('wBet').value)||50;
  if(S.cash<bet){toast('Not enough cash!','error');sfx('lose');return}
  sfx('spin');S.cash-=bet;S.totalLost+=bet;S.winStreak=0;S.wheelSpinning=true;
  document.getElementById('wBtn').disabled=true;document.getElementById('wheelRes').textContent='';
  const tIdx=Math.floor(Math.random()*WSEGS.length);
  const seg=2*Math.PI/WSEGS.length;
  const spins=8+Math.floor(Math.random()*5);
  const tAng=-( tIdx*seg+seg/2)+Math.PI*1.5;
  const total=spins*2*Math.PI+((tAng-wAngle)%(2*Math.PI)+2*Math.PI)%(2*Math.PI);
  const dur=3600;const start=wAngle;const t0=performance.now();
  function ease(t){return 1-Math.pow(1-t,3.5)}
  function frame(now){
    const t=Math.min((now-t0)/dur,1);wAngle=start+total*ease(t);drawWheel(wAngle);
    if(t<1){requestAnimationFrame(frame)}else{
      S.wheelSpinning=false;document.getElementById('wBtn').disabled=false;
      const ws=WSEGS[tIdx];const res=document.getElementById('wheelRes');
      if(ws.mult===0){sfx('lose');res.style.cssText='color:#f44';res.textContent=`‚ùå LOSE! -${fmt(bet)}`;toast('üé° LOSE! -'+fmt(bet),'error')}
      else if(ws.mult===50){sfx('jackpot');const p=bet*50;win(p);res.style.cssText='color:var(--ng)';res.textContent=`üéâ 50√ó! +${fmtN(p*getMult())}`;toast('üé° 50√ó! MASSIVE WIN!','gold')}
      else{const p=bet*ws.mult;sfx(ws.mult>=3?'bigwin':'win');win(p);
        res.style.cssText=`color:${ws.mult>=3?'var(--ngr)':'var(--nc)'}`;res.textContent=`‚ú® ${ws.label}! +${fmtN(p*getMult())}`;
        toast('üé° '+ws.label+'! +'+fmtN(p*getMult()),ws.mult>=3?'success':'info');
      }
      updHUD();
    }
  }
  requestAnimationFrame(frame);updHUD();
}

let crCv,crCtx,crAnim,crState='idle',crPts=[],crBetActive=false;

function initCrash(){
  crCv=document.getElementById('cc');crCtx=crCv.getContext('2d');
  const rsz=()=>{crCv.width=crCv.offsetWidth;crCv.height=crCv.offsetHeight};
  rsz();window.addEventListener('resize',rsz);drawCrashIdle();
}

function drawCrashIdle(){
  if(!crCv)return;const w=crCv.width,h=crCv.height;crCtx.clearRect(0,0,w,h);
  crCtx.fillStyle='rgba(0,0,0,0.08)';crCtx.fillRect(0,0,w,h);
  crCtx.strokeStyle='rgba(255,255,255,0.04)';crCtx.lineWidth=1;
  for(let i=0;i<5;i++){crCtx.beginPath();crCtx.moveTo(0,(h/5)*i);crCtx.lineTo(w,(h/5)*i);crCtx.stroke()}
}

function genCrMult(){
  const r=Math.random();
  if(r<0.30)return 1.0+Math.random()*0.2;
  if(r<0.55)return 1.2+Math.random()*0.8;
  if(r<0.72)return 2.0+Math.random()*1.5;
  if(r<0.84)return 3.5+Math.random()*3.5;
  if(r<0.92)return 7+Math.random()*8;
  if(r<0.97)return 15+Math.random()*10;
  if(r<0.99)return 25+Math.random()*25;
  return 50+Math.random()*50;
}

function runCrash(tgt){
  crState='running';crPts=[];crBetActive=true;
  const t0=performance.now();const dur=2200+Math.log(tgt)*2200;
  document.getElementById('cm').className='cm safe';
  document.getElementById('crCashBtn').disabled=false;
  function frame(now){
    const t=Math.min((now-t0)/dur,1);
    if(t>=1||crState==='crashed'||crState==='cashed'){
      if(crState!=='cashed'){
        document.getElementById('cm').textContent=tgt.toFixed(2)+'x';
        document.getElementById('cm').className='cm crd';
        if(crBetActive){sfx('boom');toast('üí• Crashed at '+tgt.toFixed(2)+'x! Lost '+fmt(S.crashBet),'error');crBetActive=false}
        S.crashHistory.unshift(tgt.toFixed(2)+'x');if(S.crashHistory.length>6)S.crashHistory.pop();
        document.getElementById('crHist').textContent=S.crashHistory.join(' | ');
        document.getElementById('crRes').textContent='üí• CRASHED at '+tgt.toFixed(2)+'x';
        document.getElementById('crRes').style.color='#f44';
        document.getElementById('crBetBtn').disabled=false;document.getElementById('crCashBtn').disabled=true;
        crState='idle';
        setTimeout(()=>{drawCrashIdle();document.getElementById('cm').textContent='1.00x';document.getElementById('cm').className='cm safe'},2000);
      }
      return;
    }
    const disp=1+(tgt-1)*Math.pow(t,1.5);
    document.getElementById('cm').textContent=disp.toFixed(2)+'x';
    if(disp>3)document.getElementById('cm').className='cm dng';
    const w=crCv.width,h=crCv.height,px=t*w,py=h-Math.pow(t,1.45)*(h*0.84);
    crPts.push({x:px,y:py});
    crCtx.clearRect(0,0,w,h);crCtx.fillStyle='rgba(0,0,0,0.04)';crCtx.fillRect(0,0,w,h);
    crCtx.beginPath();crCtx.moveTo(0,h);crPts.forEach(p=>crCtx.lineTo(p.x,p.y));
    crCtx.strokeStyle=disp>5?'#ffd700':disp>2?'#00fff5':'#39ff14';
    crCtx.lineWidth=2.5;crCtx.shadowBlur=8;crCtx.shadowColor=crCtx.strokeStyle;crCtx.stroke();crCtx.shadowBlur=0;
    const grd=crCtx.createLinearGradient(0,0,0,h);grd.addColorStop(0,'rgba(57,255,20,0.12)');grd.addColorStop(1,'transparent');
    crCtx.fillStyle=grd;crCtx.lineTo(w,h);crCtx.lineTo(0,h);crCtx.fill();
    if(Math.floor(now/100)%2===0)sfx('crash_tick');
    crAnim=requestAnimationFrame(frame);
  }
  crAnim=requestAnimationFrame(frame);
}

function placeCrashBet(){
  if(crState==='running'){toast('Wait for round end!','error');return}
  const bet=parseFloat(document.getElementById('crBet').value)||100;
  if(S.cash<bet){toast('Not enough cash!','error');sfx('lose');return}
  sfx('click');S.cash-=bet;S.crashBet=bet;S.totalLost+=bet;S.winStreak=0;
  document.getElementById('crBetBtn').disabled=true;
  document.getElementById('crRes').textContent='üöÄ Launched! Cash out before crash!';
  document.getElementById('crRes').style.color='var(--nc)';
  crPts=[];crState='running';runCrash(genCrMult());updHUD();
}

function crashCashout(){
  if(crState!=='running'||!crBetActive)return;
  const mult=parseFloat(document.getElementById('cm').textContent);
  const prize=S.crashBet*mult;sfx('bigwin');win(prize);crBetActive=false;crState='cashed';
  document.getElementById('crCashBtn').disabled=true;
  document.getElementById('crRes').textContent=`üí∞ Cashed at ${mult.toFixed(2)}√ó! +${fmtN(prize*getMult())}`;
  document.getElementById('crRes').style.color='var(--ngr)';
  toast('üöÄ Cashed at '+mult.toFixed(2)+'√ó! +'+fmtN(prize*getMult()),'success');
  cancelAnimationFrame(crAnim);
  setTimeout(()=>{crState='idle';document.getElementById('crBetBtn').disabled=false;
    document.getElementById('cm').textContent='1.00x';drawCrashIdle()},1500);
  updHUD();
}

function buildStocksUI(){
  const g=document.getElementById('stocksGrid');g.innerHTML='';
  STOCKS.forEach(st=>{
    const own=S.stocks[st.ticker];
    const chg=st.history.length>1?((st.price-st.history[st.history.length-2])/st.history[st.history.length-2]*100):0;
    const row=document.createElement('div');row.className='stock-row2';
    row.innerHTML=`<div class="sl-ico" style="background:${st.color}18;border:1px solid ${st.color}30">${st.icon}</div>
      <div class="sl-info"><div class="sl-tick" style="color:${st.color}">${st.ticker}</div><div class="sl-co">${st.name}</div></div>
      <canvas class="sl-chart" id="sc-${st.ticker}" width="76" height="30"></canvas>
      <div class="sl-pc"><div class="sl-p">${fmt(st.price)}</div><div class="sl-ch ${chg>=0?'up':'dn'}">${chg>=0?'‚ñ≤':'‚ñº'} ${Math.abs(chg).toFixed(2)}%</div></div>
      <div class="sl-own">√ó${own.owned}<br>${own.owned>0?fmtN(own.owned*st.price):''}</div>
      <div class="sl-act">
        <input type="number" id="sq-${st.ticker}" value="1" min="1" style="width:48px;background:rgba(0,0,0,0.4);border:1px solid rgba(255,255,255,0.1);border-radius:6px;padding:4px 6px;color:#fff;font-size:10px;font-family:Orbitron,monospace">
        <button class="btn btn-gr" onclick="buyStock('${st.ticker}')" style="font-size:9px;padding:4px 10px">BUY</button>
        <button class="btn btn-rd" onclick="sellStock('${st.ticker}')" style="font-size:9px;padding:4px 10px">SELL</button>
      </div>`;
    g.appendChild(row);
  });
  drawCharts();
}

function drawCharts(){
  STOCKS.forEach(st=>{
    const cv=document.getElementById('sc-'+st.ticker);if(!cv)return;
    const ctx=cv.getContext('2d');const w=cv.width,h=cv.height;ctx.clearRect(0,0,w,h);
    const hist=st.history.slice(-20);const mn=Math.min(...hist),mx=Math.max(...hist),rng=mx-mn||1;
    ctx.beginPath();hist.forEach((v,i)=>{const x=(i/(hist.length-1))*w,y=h-((v-mn)/rng*h*0.8+h*0.1);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)});
    ctx.strokeStyle=hist[hist.length-1]>=hist[0]?'#39ff14':'#f44';ctx.lineWidth=1.5;ctx.stroke();
  });
}

function updStocksUI(){
  STOCKS.forEach(st=>{
    const own=S.stocks[st.ticker];
    const chg=st.history.length>1?((st.price-st.history[st.history.length-2])/st.history[st.history.length-2]*100):0;
    const pEl=document.querySelector(`#sc-${st.ticker}`)?.parentElement;
    if(!pEl)return;
    const pc=pEl.querySelector('.sl-p');const cc=pEl.querySelector('.sl-ch');const oc=pEl.querySelector('.sl-own');
    if(pc)pc.textContent=fmt(st.price);
    if(cc){cc.textContent=(chg>=0?'‚ñ≤':'‚ñº')+' '+Math.abs(chg).toFixed(2)+'%';cc.className='sl-ch '+(chg>=0?'up':'dn')}
    if(oc)oc.innerHTML=`√ó${own.owned}<br>${own.owned>0?fmtN(own.owned*st.price):''}`;
  });
  drawCharts();document.getElementById('portVal').textContent=fmtN(portVal());
}

function buyStock(ticker){
  const st=STOCKS.find(s=>s.ticker===ticker);
  const qty=parseInt(document.getElementById('sq-'+ticker).value)||1;
  const cost=st.price*qty;if(S.cash<cost){toast('Not enough cash!','error');sfx('lose');return}
  sfx('buy');S.cash-=cost;const own=S.stocks[ticker];
  own.avgBuy=(own.avgBuy*own.owned+cost)/(own.owned+qty);own.owned+=qty;
  toast('üìà Bought '+qty+'√ó '+ticker+' for '+fmtN(cost),'success');updStocksUI();updHUD();
}

function sellStock(ticker){
  const st=STOCKS.find(s=>s.ticker===ticker);
  const qty=Math.min(parseInt(document.getElementById('sq-'+ticker).value)||1,S.stocks[ticker].owned);
  if(qty<=0){toast('No shares!','error');return}
  const rev=st.price*qty;
  const cost=S.stocks[ticker].avgBuy*qty;
  const profit=Math.max(0,rev-cost);
  sfx('sell');win(rev,true);
  if(profit>0){S.cash+=profit*(getMult()-1);S.totalWon+=profit*(getMult()-1)}
  S.stocks[ticker].owned-=qty;if(!S.stocks[ticker].owned)S.stocks[ticker].avgBuy=0;
  toast('üìâ Sold '+qty+'√ó '+ticker+' for '+fmtN(rev),'info');updStocksUI();updHUD();
}

let _advancingDay=false;
function advanceDay(){
  if(_advancingDay)return;
  _advancingDay=true;
  try{
    sfx('day');S.day++;
    document.getElementById('hDay').textContent=S.day;
    document.getElementById('sDayNum').textContent=S.day;
    STOCKS.forEach(st=>{
      const vol=st.price*0.09;st.price=Math.max(1,Math.round(st.price+vol*(Math.random()-0.46)*2));
      st.history.push(st.price);if(st.history.length>50)st.history.shift();
    });
    S.btcPrice+=Math.round((Math.random()-0.44)*3000);S.btcPrice=Math.max(15000,Math.min(300000,S.btcPrice));
    S.jackpot+=Math.round(Math.random()*800+300);document.getElementById('jpVal').textContent=fmt(S.jackpot);
    S.pcMarketMult=0.8+Math.random()*0.6;
    if(S.day===10){sfx('unlock');toast('üé∞ CASINO UNLOCKED! Day 10 reached!','gold')}
    if(S.day===15){sfx('unlock');toast('üöÄ CRASH UNLOCKED! Day 15 reached!','gold')}
    if(S.day>=S.daySkipResetAt){
      S.daySkipsUsed=0;
      S.daySkipResetAt=S.day+12;
      toast('üîÑ Day skip allowance refreshed! +2 skips','info');
    }
    if(S.stage2)tickQuantumMarket();
    if(S.stage2)collectRent();
    updLocks();
    updStocksUI();
    updHUD();
    updS2Gate();
    updSkipUI();
    if(document.getElementById('sec-pcshop').classList.contains('active'))renderGarage();
    toast('üìÖ Day '+S.day+' ‚Äî Markets updated!','info');
  }finally{
    _advancingDay=false;
  }
}

function buildCharPage(){
  const pg=document.getElementById('charPage');pg.innerHTML='';
  CHARS.forEach((c,i)=>{
    const owned=S.ownedChars.includes(i);const active=S.activeChar===i;
    const card=document.createElement('div');card.className='char-big-card '+(owned?'owned ':''+(active?'active-char':''));
    card.style.setProperty('--card-col',c.color);
    card.innerHTML=`<div style="display:flex;justify-content:center;filter:drop-shadow(0 0 16px ${c.color}55)">${mkCharSVG(c,i,100,155)}</div>
      <div class="cbig-name" style="color:${c.color}">${c.name}</div>
      <div class="cbig-title">${c.title}</div>
      <div class="cbig-mult" style="color:${c.color}">${c.mult}√ó</div>
      <div class="cbig-quote">"${c.quote}"</div>
      ${i===0?'':`<div class="cbig-price">${fmtN(c.price)}</div>`}
      ${i!==0?`<div style="font-size:9px;color:rgba(255,80,80,0.7);font-family:'Orbitron',monospace;margin-bottom:8px">‚ö† RESETS CASH TO $1,000</div>`:''}
      <div class="cbig-badge ${active?'badge-active':owned?'badge-owned':'badge-locked'}">${active?'‚òÖ ACTIVE':owned?'‚úì OWNED':'üîí LOCKED'}</div>
      ${!owned?`<button class="btn btn-pu" onclick="buyChar(${i})" style="width:100%">UNLOCK ${c.mult}√ó</button>`
        :!active?`<button class="btn btn-cy" onclick="activateChar(${i})" style="width:100%">ACTIVATE</button>`
        :`<div style="font-family:'Orbitron',monospace;font-size:10px;color:var(--ngr);padding:8px">‚úì Currently Active</div>`}`;
    pg.appendChild(card);
  });
}

function buyChar(i){
  const c=CHARS[i];if(S.cash<c.price){toast('Need '+fmtN(c.price)+'!','error');sfx('lose');return}
  if(S.ownedChars.includes(i)){toast('Already owned!','info');return}
  sfx('char');S.cash-=c.price;
  S.cash=1000;
  S.ownedChars.push(i);
  showUnlockAnim(i);setTimeout(()=>{activateChar(i);buildCharPage();updHUD()},2500);
  toast('‚ö† Cash reset to $1,000 on rebirth!','error');
}

function activateChar(i){
  sfx('unlock');S.activeChar=i;buildCharPage();updHUD();
  toast('‚òÖ '+CHARS[i].name+' ACTIVATED! '+CHARS[i].mult+'√ó multiplier','purple');
}

function showUnlockAnim(i){
  const c=CHARS[i];const el=document.getElementById('cuaEl');const inner=document.getElementById('cuaInner');
  document.getElementById('cuaSvg').innerHTML=`<div style="filter:drop-shadow(0 0 30px ${c.color})">${mkCharSVG(c,i,130,200)}</div>`;
  document.getElementById('cuaTitle').textContent='REBIRTH UNLOCKED!';
  document.getElementById('cuaSub').textContent=`${c.name} ‚Äî ${c.mult}√ó All Earnings\n"${c.quote}"`;
  el.classList.add('show');inner.classList.add('show');el.style.pointerEvents='all';
  el.onclick=()=>{el.classList.remove('show');inner.classList.remove('show');el.style.pointerEvents='none'};
  setTimeout(()=>{el.classList.remove('show');inner.classList.remove('show');el.style.pointerEvents='none'},4000);
}

const DECK_SUITS=['‚ô†','‚ô•','‚ô¶','‚ô£'];
const DECK_RANKS=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
function mkDeck(){const d=[];DECK_SUITS.forEach(s=>DECK_RANKS.forEach(r=>d.push({r,s})));return d}
function shuffleDeck(d){for(let i=d.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[d[i],d[j]]=[d[j],d[i]];}return d}
function cardVal(r){if(['J','Q','K'].includes(r))return 10;if(r==='A')return 11;return parseInt(r)}
function handVal(h){let v=h.reduce((a,c)=>a+cardVal(c.r),0),aces=h.filter(c=>c.r==='A').length;while(v>21&&aces>0){v-=10;aces--}return v}
function cardHTML(c,hidden=false){
  if(hidden)return`<div style="width:44px;height:62px;border-radius:8px;background:linear-gradient(135deg,#1a1a4a,#0a0a25);border:1px solid rgba(255,255,255,0.15);display:flex;align-items:center;justify-content:center;font-size:22px">üÇ†</div>`;
  const red=c.s==='‚ô•'||c.s==='‚ô¶';
  return`<div style="width:44px;height:62px;border-radius:8px;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4px;box-shadow:0 2px 8px rgba(0,0,0,0.4)">
    <div style="font-size:14px;font-weight:900;color:${red?'#e00':'#111'};line-height:1">${c.r}</div>
    <div style="font-size:18px;color:${red?'#e00':'#111'};line-height:1">${c.s}</div>
  </div>`;
}
let bjDeck=[],bjPlayer=[],bjDealer=[],bjBetAmt=0,bjActive=false,bjDealerHidden=true;
function bjDeal(){
  if(bjActive)return;
  bjBetAmt=parseFloat(document.getElementById('bjBet').value)||100;
  if(S.cash<bjBetAmt){toast('Not enough cash!','error');return}
  sfx('flip');lose(bjBetAmt);bjActive=true;
  bjDeck=shuffleDeck(mkDeck());bjPlayer=[];bjDealer=[];bjDealerHidden=true;
  bjPlayer.push(bjDeck.pop(),bjDeck.pop());bjDealer.push(bjDeck.pop(),bjDeck.pop());
  bjRender();
  document.getElementById('bjDealBtn').disabled=true;
  document.getElementById('bjHitBtn').disabled=false;
  document.getElementById('bjStandBtn').disabled=false;
  document.getElementById('bjDblBtn').disabled=S.cash<bjBetAmt;
  document.getElementById('bjRes').textContent='';
  if(handVal(bjPlayer)===21){bjDealerHidden=false;bjRender();bjEnd('blackjack');return}
}
function bjRender(){
  document.getElementById('bjPlayerCards').innerHTML=bjPlayer.map(c=>cardHTML(c)).join('');
  document.getElementById('bjDealerCards').innerHTML=bjDealer.map((c,i)=>cardHTML(c,bjDealerHidden&&i===1)).join('');
  document.getElementById('bjPlayerVal').textContent=handVal(bjPlayer);
  document.getElementById('bjDealerVal').textContent=bjDealerHidden?cardVal(bjDealer[0].r)+'?':handVal(bjDealer);
}
function bjHit(){
  if(!bjActive)return;sfx('flip');bjPlayer.push(bjDeck.pop());bjRender();
  if(handVal(bjPlayer)>=21){bjDealerHidden=false;bjRender();bjEnd(handVal(bjPlayer)>21?'bust':'stand')}
}
function bjDouble(){
  if(!bjActive||S.cash<bjBetAmt)return;sfx('flip');lose(bjBetAmt);bjBetAmt*=2;bjPlayer.push(bjDeck.pop());bjRender();
  bjDealerHidden=false;bjRender();bjEnd(handVal(bjPlayer)>21?'bust':'stand');
}
function bjStand(){
  if(!bjActive)return;bjDealerHidden=false;
  while(handVal(bjDealer)<17){bjDealer.push(bjDeck.pop())}bjRender();bjEnd('stand');
}
function bjEnd(reason){
  bjActive=false;
  document.getElementById('bjHitBtn').disabled=true;
  document.getElementById('bjStandBtn').disabled=true;
  document.getElementById('bjDblBtn').disabled=true;
  document.getElementById('bjDealBtn').disabled=false;
  const pv=handVal(bjPlayer),dv=handVal(bjDealer);
  const res=document.getElementById('bjRes');
  let msg='',col='#fff';
  if(reason==='blackjack'){sfx('bigwin');const prize=bjBetAmt*2.5;win(prize,true);msg=`üÉè BLACKJACK! +${fmtN(prize)}`;col='var(--ng)';toast('üÉè BLACKJACK! +'+fmtN(prize),'gold')}
  else if(reason==='bust'||dv<=21&&pv>21){sfx('lose');msg=`üí• BUST! Lost ${fmt(bjBetAmt)}`;col='#f44';toast('üí• Bust! -'+fmt(bjBetAmt),'error')}
  else if(dv>21||pv>dv){sfx('win');const prize=bjBetAmt*2;win(prize,true);msg=`‚úÖ WIN! +${fmtN(prize)}`;col='var(--ngr)';toast('üÉè BJ Win! +'+fmtN(prize),'success')}
  else if(pv===dv){sfx('click');win(bjBetAmt,true);msg=`ü§ù PUSH ‚Äî Bet returned`;col='var(--nc)';toast('ü§ù Push!','info')}
  else{sfx('lose');msg=`‚ùå DEALER WINS! Lost ${fmt(bjBetAmt)}`;col='#f44';toast('üÉè Dealer wins!','error')}
  res.style.color=col;res.textContent=msg;updHUD();
}

const RL_NUMS=[0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
const RL_RED=[1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
let rlSpinning=false,rlAngle=0;
function drawRoulette(ang,ball=null){
  const cv=document.getElementById('rlCv');if(!cv)return;
  const ctx=cv.getContext('2d'),cx=100,cy=100,r=96,ir=72;
  ctx.clearRect(0,0,200,200);
  const seg=2*Math.PI/37;
  RL_NUMS.forEach((n,i)=>{
    const sa=ang+i*seg,ea=sa+seg;
    ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,r,sa,ea);ctx.closePath();
    ctx.fillStyle=n===0?'#186c18':RL_RED.includes(n)?'#c0162a':'#111';ctx.fill();
    ctx.strokeStyle='rgba(255,255,255,0.07)';ctx.lineWidth=0.5;ctx.stroke();
    ctx.save();ctx.translate(cx+Math.cos(sa+seg/2)*(r*0.76),cy+Math.sin(sa+seg/2)*(r*0.76));
    ctx.rotate(sa+seg/2+Math.PI/2);ctx.fillStyle='#fff';ctx.font='bold 7px Orbitron,monospace';ctx.textAlign='center';ctx.fillText(n,0,0);ctx.restore();
  });
  ctx.beginPath();ctx.arc(cx,cy,ir,0,Math.PI*2);ctx.fillStyle='#1a1a3a';ctx.fill();
  ctx.strokeStyle='rgba(255,215,0,0.4)';ctx.lineWidth=2;ctx.stroke();
  if(ball!==null){
    const bidx=RL_NUMS.indexOf(ball);const ba=ang+bidx*seg+seg/2;
    const br=r*0.88;
    ctx.beginPath();ctx.arc(cx+Math.cos(ba)*br,cy+Math.sin(ba)*br,6,0,Math.PI*2);
    ctx.fillStyle='#fff';ctx.shadowBlur=10;ctx.shadowColor='#fff';ctx.fill();ctx.shadowBlur=0;
  }
}
drawRoulette(0);
function spinRoulette(){
  if(rlSpinning)return;
  const bet=parseFloat(document.getElementById('rlBet').value)||50;
  if(S.cash<bet){toast('Not enough cash!','error');return}
  const type=document.getElementById('rlType').value;
  const num=parseInt(document.getElementById('rlNum').value)||0;
  sfx('spin');lose(bet);rlSpinning=true;
  document.getElementById('rlBtn').disabled=true;
  document.getElementById('rlRes').textContent='üé° Spinning...';
  const result=Math.floor(Math.random()*37);
  const tIdx=RL_NUMS.indexOf(result);
  const seg=2*Math.PI/37;
  const spins=8+Math.floor(Math.random()*5);
  const tAng=-(tIdx*seg+seg/2)+Math.PI*1.5;
  const total=spins*2*Math.PI+((tAng-rlAngle)%(2*Math.PI)+2*Math.PI)%(2*Math.PI);
  const dur=4000,start=rlAngle,t0=performance.now();
  function ease(t){return 1-Math.pow(1-t,3.5)}
  function frame(now){
    const t=Math.min((now-t0)/dur,1);
    rlAngle=start+total*ease(t);
    drawRoulette(rlAngle,t>0.85?result:null);
    if(t<1){requestAnimationFrame(frame)}else{
      rlSpinning=false;document.getElementById('rlBtn').disabled=false;
      const isRed=RL_RED.includes(result);const isBlack=result!==0&&!isRed;
      let mult=0;
      if(type==='red'&&isRed)mult=2;else if(type==='black'&&isBlack)mult=2;
      else if(type==='even'&&result!==0&&result%2===0)mult=2;else if(type==='odd'&&result%2===1)mult=2;
      else if(type==='low'&&result>=1&&result<=18)mult=2;else if(type==='high'&&result>=19)mult=2;
      else if(type==='doz1'&&result>=1&&result<=12)mult=3;else if(type==='doz2'&&result>=13&&result<=24)mult=3;
      else if(type==='doz3'&&result>=25&&result<=36)mult=3;
      else if(type==='num'&&result===num)mult=36;
      const lbl=document.getElementById('rlBall');
      lbl.textContent=`${result} ${result===0?'üü¢':isRed?'üî¥':'‚ö´'}`;lbl.style.color=result===0?'#39ff14':isRed?'#ff4444':'#aaa';
      const res=document.getElementById('rlRes');
      if(mult>0){sfx(mult>=10?'bigwin':'win');const prize=bet*mult;win(prize,true);
        res.style.color='var(--ngr)';res.textContent=`‚úÖ ${result}! WIN ${mult}√ó! +${fmtN(prize)}`;
        toast('üî¥ Roulette '+mult+'√ó! +'+fmtN(prize),'success');
      } else{sfx('lose');res.style.color='#f44';res.textContent=`‚ùå ${result}! LOSE -${fmt(bet)}`;
        toast('üî¥ Roulette: '+result+'! Lost -'+fmt(bet),'error');}
      updHUD();
    }
  }
  requestAnimationFrame(frame);
}
document.getElementById('rlType').addEventListener('change',function(){
  document.getElementById('rlNumWrap').style.display=this.value==='num'?'flex':'none';
});

let hlCurrentCard=null,hlBet=0,hlMult=1,hlStreak2=0,hlActive=false;
function hlDeal(){
  hlBet=parseFloat(document.getElementById('hlBet').value)||50;
  if(S.cash<hlBet){toast('Not enough cash!','error');return}
  if(hlActive){sfx('lose');win(0);toast('Game over ‚Äî previous bet lost','error');}
  sfx('flip');lose(hlBet);hlMult=1;hlStreak2=0;hlActive=true;
  const d=shuffleDeck(mkDeck());hlCurrentCard=d[0];
  document.getElementById('hlCard').innerHTML=cardHTML(hlCurrentCard);
  document.getElementById('hlCardLabel').textContent=`${hlCurrentCard.r}${hlCurrentCard.s}`;
  document.getElementById('hlHighBtn').disabled=false;
  document.getElementById('hlLowBtn').disabled=false;
  document.getElementById('hlCashBtn').disabled=false;
  document.getElementById('hlDealBtn').textContent='üîÑ RESET';
  updHLStreak();
  document.getElementById('hlRes').textContent='Will the next card be higher or lower?';
  document.getElementById('hlRes').style.color='var(--nc)';
}
function updHLStreak(){document.getElementById('hlStreak').textContent=`Streak: ${hlStreak2} | Multiplier: ${hlMult.toFixed(2)}√ó`}
function hlGuess(dir){
  if(!hlActive)return;sfx('flip');
  const d=shuffleDeck(mkDeck());const next=d[0];
  const cv=cardVal(hlCurrentCard.r),nv=cardVal(next.r);
  const win2=(dir==='high'&&nv>cv)||(dir==='low'&&nv<cv);
  document.getElementById('hlCard').innerHTML=cardHTML(next);
  document.getElementById('hlCardLabel').textContent=`${next.r}${next.s}`;
  if(win2){sfx('win');hlMult*=1.5;hlStreak2++;hlCurrentCard=next;updHLStreak();
    document.getElementById('hlRes').textContent=`‚úÖ Correct! Next guess to increase ${hlMult.toFixed(2)}√ó`;
    document.getElementById('hlRes').style.color='var(--ngr)';
  } else{sfx('lose');hlActive=false;
    document.getElementById('hlHighBtn').disabled=true;document.getElementById('hlLowBtn').disabled=true;document.getElementById('hlCashBtn').disabled=true;
    document.getElementById('hlDealBtn').textContent='üÉè DRAW';
    document.getElementById('hlRes').textContent=`‚ùå Wrong! Lost ${fmt(hlBet)}`;
    document.getElementById('hlRes').style.color='#f44';
    toast('‚ùå Hi-Lo wrong! Lost '+fmt(hlBet),'error');updHUD();
  }
}
function hlCash(){
  if(!hlActive)return;hlActive=false;sfx('bigwin');
  const prize=hlBet*hlMult;win(prize,true);
  document.getElementById('hlHighBtn').disabled=true;document.getElementById('hlLowBtn').disabled=true;document.getElementById('hlCashBtn').disabled=true;
  document.getElementById('hlDealBtn').textContent='üÉè DRAW';
  document.getElementById('hlRes').textContent=`üí∞ Cashed out! +${fmtN(prize)} (${hlMult.toFixed(2)}√ó)`;
  document.getElementById('hlRes').style.color='var(--ng)';
  toast('üí∞ Hi-Lo cash! +'+fmtN(prize),'success');updHUD();
}

function bacCard(){const d=shuffleDeck(mkDeck());return d[0]}
function bacVal(h){return h.reduce((a,c)=>{let v=cardVal(c.r);if(v>=10)v=0;return(a+v)%10},0)}
function playBaccarat(bet){
  const amount=parseFloat(document.getElementById('bacBet').value)||100;
  if(S.cash<amount){toast('Not enough cash!','error');return}
  sfx('flip');lose(amount);
  ['bacBtnP','bacBtnB','bacBtnT'].forEach(id=>document.getElementById(id).disabled=true);
  const ph=[bacCard(),bacCard()],bh=[bacCard(),bacCard()];
  const pv=bacVal(ph),bv=bacVal(bh);
  const win3=pv>bv?'player':bv>pv?'banker':'tie';
  document.getElementById('bacPlayerCards').innerHTML=ph.map(c=>cardHTML(c)).join('');
  document.getElementById('bacBankCards').innerHTML=bh.map(c=>cardHTML(c)).join('');
  document.getElementById('bacPVal').textContent=pv;
  document.getElementById('bacBVal').textContent=bv;
  const res=document.getElementById('bacRes');
  setTimeout(()=>{
    let msg='',col='#fff';
    if(win3===bet){
      let mult=bet==='player'?2:bet==='banker'?1.95:9;
      sfx(bet==='tie'?'jackpot':'win');const prize=amount*mult;win(prize,true);
      msg=`‚úÖ ${bet.toUpperCase()} WINS ${pv} vs ${bv}! +${fmtN(prize)}`;col='var(--ngr)';
      toast('üé¥ Baccarat win! +'+fmtN(prize),'success');
    } else{sfx('lose');msg=`‚ùå ${win3.toUpperCase()} WINS ${pv} vs ${bv}! Lost ${fmt(amount)}`;col='#f44';
      toast('üé¥ Baccarat loss!','error');}
    res.style.color=col;res.textContent=msg;
    setTimeout(()=>{['bacBtnP','bacBtnB','bacBtnT'].forEach(id=>document.getElementById(id).disabled=false)},800);
    updHUD();
  },700);
}

let kenoSelected=new Set();
function buildKenoGrid(){
  const g=document.getElementById('kenoGrid');if(!g)return;g.innerHTML='';
  for(let i=1;i<=80;i++){
    const b=document.createElement('button');
    b.textContent=i;b.className='btn';
    b.style.cssText='padding:3px 0;font-size:9px;font-family:Orbitron,monospace;background:rgba(30,30,60,0.9);border:1px solid rgba(255,255,255,0.1);border-radius:4px;color:rgba(255,255,255,0.6);transition:all 0.15s;min-width:0;width:100%';
    b.id='kb'+i;
    b.onclick=()=>{
      if(kenoSelected.has(i)){kenoSelected.delete(i);b.style.background='rgba(30,30,60,0.9)';b.style.color='rgba(255,255,255,0.6)';b.style.borderColor='rgba(255,255,255,0.1)'}
      else if(kenoSelected.size<10){kenoSelected.add(i);b.style.background='rgba(0,255,245,0.15)';b.style.color='var(--nc)';b.style.borderColor='var(--nc)'}
      else{toast('Max 10 numbers!','error');return}
      document.getElementById('kenoCount').textContent=kenoSelected.size;
    };
    g.appendChild(b);
  }
}
function clearKeno(){
  kenoSelected.forEach(i=>{const b=document.getElementById('kb'+i);if(b){b.style.background='rgba(30,30,60,0.9)';b.style.color='rgba(255,255,255,0.6)';b.style.borderColor='rgba(255,255,255,0.1)'}});
  kenoSelected.clear();document.getElementById('kenoCount').textContent=0;
}
const KENO_PAYS=[0,0,1,2,4,10,25,75,200,800,2000];
function playKeno(){
  if(kenoSelected.size<2){toast('Pick at least 2 numbers!','error');return}
  const bet=parseFloat(document.getElementById('kenoBet').value)||50;
  if(S.cash<bet){toast('Not enough cash!','error');return}
  sfx('spin');lose(bet);document.getElementById('kenoBtn').disabled=true;
  const drawn=new Set();while(drawn.size<20){drawn.add(Math.floor(Math.random()*80)+1)}
  let matchCount=0;
  kenoSelected.forEach(n=>{
    const b=document.getElementById('kb'+n);
    if(drawn.has(n)){matchCount++;if(b){b.style.background='rgba(255,215,0,0.3)';b.style.borderColor='var(--ng)';b.style.color='var(--ng)'}}
    else{if(b){b.style.background='rgba(255,0,0,0.1)';b.style.borderColor='rgba(255,50,50,0.3)';b.style.color='rgba(255,100,100,0.7)'}}
  });
  setTimeout(()=>{
    const payIdx=Math.min(matchCount,10);
    const payMult=KENO_PAYS[payIdx]||0;
    const res=document.getElementById('kenoRes');
    if(payMult>0){const prize=bet*payMult;sfx(payMult>=10?'bigwin':'win');win(prize,true);
      res.style.color='var(--ngr)';res.textContent=`üé± ${matchCount} matches! ${payMult}√ó WIN! +${fmtN(prize)}`;
      toast('üé± Keno '+matchCount+' matches! +'+fmtN(prize),payMult>=10?'gold':'success');
    } else{sfx('lose');res.style.color='#f44';res.textContent=`üé± ${matchCount} matches ‚Äî LOSE -${fmt(bet)}`;
      toast('üé± Keno: only '+matchCount+' matches','error');}
    document.getElementById('kenoBtn').disabled=false;updHUD();
  },1200);
}

const LBDATA=[
  {name:'GHOST_777',cash:48200000},{name:'LUCKY_LUNA',cash:12300000},
  {name:'NEON_RICO',cash:8900000},{name:'ZARA_ACE',cash:4560000},{name:'MAX_BLAZE',cash:2100000}
];

function updLobby(){
  const lb=document.getElementById('lbEl');
  const playerNet=S.cash+S.btc*S.btcPrice+portVal();
  const all=[...LBDATA,{name:'YOU ‚òÖ',cash:playerNet}].sort((a,b)=>b.cash-a.cash);
  lb.innerHTML='<div class="pt" style="margin-bottom:10px"><span class="em">üèÜ</span>LEADERBOARD</div>';
  all.slice(0,8).forEach((p,i)=>{
    const row=document.createElement('div');row.className='lr';
    const rc=i===0?'g':i===1?'s':i===2?'b':'';const md=['ü•á','ü•à','ü•â'];
    row.innerHTML=`<div class="lrk ${rc}">${i<3?md[i]:i+1}</div>
      <div class="lrn" style="${p.name.includes('YOU')?'color:var(--nc)':''}">${p.name}</div>
      <div class="lrc">${fmtN(p.cash)}</div>`;
    lb.appendChild(row);
  });
  const ps=document.getElementById('pStats');
  ps.innerHTML=`<div class="ui"><div class="ui-info"><div class="un">üí∞ Cash</div><div class="uc">${fmtN(S.cash)}</div></div></div>
    <div class="ui"><div class="ui-info"><div class="un">‚Çø BTC</div><div class="uc">${fmtB(S.btc)}</div></div></div>
    <div class="ui"><div class="ui-info"><div class="un">üìÖ Day</div><div class="uc">${S.day}</div></div></div>
    <div class="ui"><div class="ui-info"><div class="un">‚ö° Hashrate</div><div class="uc">${fmtH(S.hashrate)}</div></div></div>
    <div class="ui"><div class="ui-info"><div class="un">üèÜ Best Win</div><div class="uc">${fmtN(S.biggestWin)}</div></div></div>
    <div class="ui"><div class="ui-info"><div class="un">üî• Win Streak</div><div class="uc">${S.winStreak}</div></div></div>
    <div class="ui"><div class="ui-info"><div class="un">üë§ Active Char</div><div class="uc">${CHARS[S.activeChar].name} ${CHARS[S.activeChar].mult}√ó</div></div></div>
    <div class="ui"><div class="ui-info"><div class="un">üñ• PCs Built</div><div class="uc">${S.builtPCs.length}</div></div></div>
    ${S.stage2?`<div class="ui"><div class="ui-info"><div class="un" style="color:var(--ng)">‚≠ê STAGE</div><div class="uc" style="color:var(--ng)">II ‚Äî ASCENDED</div></div></div>`:''}`;
  updS2Gate();
}

S.stage2=false;
S.qAssets={};
S.qShorts={};
S.heistCooldown=0;
S.arenaActive=false;
S.arenaRound=0;
S.arenaBracket=[];
S.arenaEntryFee=0;

const STAGE2_COST=100e12;

const Q_ASSETS=[
  {id:'QBTC',name:'Quantum Bitcoin',icon:'üåå',color:'#ffd700',price:5000000,hist:[]},
  {id:'ENRG',name:'Dark Energy',icon:'‚ö°',color:'#ff006e',price:1200000,hist:[]},
  {id:'VOID',name:'VoidCoin',icon:'üîÆ',color:'#bf00ff',price:820000,hist:[]},
  {id:'NEXUS',name:'Nexus Protocol',icon:'üîó',color:'#00fff5',price:3100000,hist:[]},
  {id:'MATRIX',name:'Matrix Token',icon:'üü©',color:'#39ff14',price:450000,hist:[]}
];
Q_ASSETS.forEach(q=>{
  S.qAssets[q.id]={owned:0,avgBuy:0,short:0,shortAvg:0};
  for(let i=0;i<20;i++)q.hist.push(q.price*(0.7+Math.random()*0.6));
});

function updS2Gate(){
  const net=S.cash+S.btc*S.btcPrice+portVal();
  const pct=Math.min((net/STAGE2_COST)*100,100);
  const fill=document.getElementById('s2ProgressFill');
  const lbl=document.getElementById('s2ProgressLabel');
  const btn=document.getElementById('s2UnlockBtn');
  if(fill)fill.style.width=pct+'%';
  if(lbl)lbl.textContent=fmtN(net)+' / $100T';
  if(btn){
    if(net>=STAGE2_COST&&!S.stage2){btn.disabled=false;btn.textContent='‚≠ê UNLOCK STAGE II';btn.style.animation='s2pulse 1.5s infinite'}
    else if(S.stage2){btn.disabled=true;btn.textContent='‚úÖ ALREADY ASCENDED'}
    else{btn.disabled=true;btn.textContent='üîí STAGE II LOCKED'}
  }
}

function unlockStage2(){
  const net=S.cash+S.btc*S.btcPrice+portVal();
  if(net<STAGE2_COST){toast('Need $100T net worth!','error');return}
  if(S.stage2){toast('Already ascended!','info');return}
  S.stage2=true;
  sfx('jackpot');
  const overlay=document.getElementById('s2UnlockOverlay');
  overlay.classList.add('show');
  startS2Particles();
  const s2btn=document.getElementById('n-stage2');
  s2btn.style.display='';s2btn.classList.add('s2');
  buildQAssetsGrid();buildHeistMissions();buildArenaBracket();buildReMarket();
  buildQSelect();
}

function closeS2Overlay(){
  document.getElementById('s2UnlockOverlay').classList.remove('show');
  stopS2Particles();
  showSec('stage2');
}

let s2PaCanvas=null,s2PaCtx=null,s2PaAnim=null,s2PaPts=[];
function startS2Particles(){
  s2PaCanvas=document.getElementById('s2ParticlesCv');
  s2PaCanvas.width=innerWidth;s2PaCanvas.height=innerHeight;
  s2PaCtx=s2PaCanvas.getContext('2d');s2PaPts=[];
  for(let i=0;i<180;i++)s2PaPts.push({x:Math.random()*innerWidth,y:innerHeight+Math.random()*200,vx:(Math.random()-0.5)*3,vy:-(2+Math.random()*4),op:Math.random(),hue:Math.random()<0.5?45:30,sz:Math.random()*4+1});
  function frame(){s2PaCtx.clearRect(0,0,s2PaCanvas.width,s2PaCanvas.height);
    s2PaPts.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.op-=0.003;if(p.y<-20||p.op<=0){p.x=Math.random()*innerWidth;p.y=innerHeight+10;p.op=0.8+Math.random()*0.2;p.vy=-(2+Math.random()*4)}
      s2PaCtx.save();s2PaCtx.globalAlpha=p.op;s2PaCtx.fillStyle=`hsl(${p.hue},100%,60%)`;s2PaCtx.shadowBlur=10;s2PaCtx.shadowColor=`hsl(${p.hue},100%,60%)`;
      s2PaCtx.beginPath();s2PaCtx.arc(p.x,p.y,p.sz,0,Math.PI*2);s2PaCtx.fill();s2PaCtx.restore()});
    s2PaAnim=requestAnimationFrame(frame);}
  frame();
}
function stopS2Particles(){cancelAnimationFrame(s2PaAnim);}

function s2Tab(id){
  document.querySelectorAll('.s2-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.s2-content').forEach(c=>c.classList.remove('active'));
  document.getElementById('s2t-'+id).classList.add('active');
  document.getElementById('s2c-'+id).classList.add('active');
  sfx('click');
  if(id==='quantum')buildQAssetsGrid();
  if(id==='heist')buildHeistMissions();
  if(id==='arena')buildArenaBracket();
  if(id==='realestate'){buildReMarket();buildRePortfolio();updReStats();}
  if(id==='beyblade')buildBeyWorkshop();
}

function buildQSelect(){
  const sel=document.getElementById('qSelect');if(!sel)return;
  sel.innerHTML=Q_ASSETS.map(q=>`<option value="${q.id}">${q.icon} ${q.id}</option>`).join('');
}

function buildQAssetsGrid(){
  const g=document.getElementById('qAssetsGrid');if(!g)return;
  g.innerHTML='';
  Q_ASSETS.forEach(q=>{
    const own=S.qAssets[q.id];
    const prev=q.hist[q.hist.length-2]||q.price;
    const chg=((q.price-prev)/prev*100);
    const row=document.createElement('div');row.className='q-asset';
    row.innerHTML=`<div class="q-ico" style="background:${q.color}18;border:1px solid ${q.color}30">${q.icon}</div>
      <div class="q-info">
        <div class="q-ticker" style="color:${q.color}">${q.id}</div>
        <div class="q-price">${q.name}</div>
        ${own.owned>0?`<div style="font-size:9px;font-family:'Orbitron',monospace;color:rgba(255,255,255,0.4)">LONG: √ó${own.owned}</div>`:''}
        ${own.short>0?`<div style="font-size:9px;font-family:'Orbitron',monospace;color:rgba(255,0,110,0.6)">SHORT: √ó${own.short}</div>`:''}
      </div>
      <div style="text-align:right">
        <div style="font-family:'Orbitron',monospace;font-size:13px;font-weight:700;color:${q.color}">${fmtN(q.price)}</div>
        <div class="q-chg ${chg>=0?'up':'dn'}">${chg>=0?'‚ñ≤':'‚ñº'} ${Math.abs(chg).toFixed(1)}%</div>
      </div>`;
    g.appendChild(row);
  });
}

function qBuy(){
  const id=document.getElementById('qSelect').value;
  const qty=parseInt(document.getElementById('qQty').value)||1;
  const q=Q_ASSETS.find(a=>a.id===id);if(!q)return;
  const cost=q.price*qty;
  if(S.cash<cost){toast('Not enough cash!','error');sfx('lose');return}
  sfx('buy');S.cash-=cost;
  const own=S.qAssets[id];
  own.avgBuy=(own.avgBuy*own.owned+cost)/(own.owned+qty);own.owned+=qty;
  document.getElementById('qRes').textContent=`üìà LONG ${qty}√ó ${id} for ${fmtN(cost)}`;
  document.getElementById('qRes').style.color='var(--ngr)';
  toast('üåå Quantum LONG: '+qty+'√ó '+id,'success');buildQAssetsGrid();updHUD();
}

function qSell(){
  const id=document.getElementById('qSelect').value;
  const qty=parseInt(document.getElementById('qQty').value)||1;
  const q=Q_ASSETS.find(a=>a.id===id);if(!q)return;
  const cost=q.price*qty;
  if(S.cash<cost){toast('Need cash to cover short!','error');sfx('lose');return}
  sfx('sell');S.cash-=cost;
  const own=S.qAssets[id];
  own.shortAvg=(own.shortAvg*own.short+cost)/(own.short+qty);own.short+=qty;
  document.getElementById('qRes').textContent=`üìâ SHORT ${qty}√ó ${id} at ${fmtN(q.price)}`;
  document.getElementById('qRes').style.color='var(--np)';
  toast('üåå Quantum SHORT: '+qty+'√ó '+id,'info');buildQAssetsGrid();updHUD();
}

function qClose(){
  const id=document.getElementById('qSelect').value;
  const q=Q_ASSETS.find(a=>a.id===id);if(!q)return;
  const own=S.qAssets[id];let msg='';
  if(own.owned>0){
    const rev=q.price*own.owned*getMult();S.cash+=rev;S.totalWon+=rev;
    msg+=`LONG closed: +${fmtN(rev)} `;own.owned=0;own.avgBuy=0;sfx('bigwin');
  }
  if(own.short>0){
    const cover=q.price*own.short;const staked=own.shortAvg*own.short;
    const profit=(staked-cover)*getMult();
    if(profit>0){S.cash+=staked+profit;S.totalWon+=profit;msg+=`SHORT profit: +${fmtN(profit)}`;sfx('bigwin')}
    else{const loss=Math.min(Math.abs(profit),S.cash);S.cash=Math.max(0,S.cash-(cover-staked));S.totalLost+=Math.abs(profit);msg+=`SHORT loss: ${fmtN(profit)}`;sfx('lose')}
    own.short=0;own.shortAvg=0;
  }
  if(!msg){toast('No position to close!','info');return}
  document.getElementById('qRes').textContent=`‚úÖ Position closed ‚Äî ${msg}`;
  document.getElementById('qRes').style.color='var(--ng)';
  toast('üåå Position closed','success');buildQAssetsGrid();updHUD();
}

function tickQuantumMarket(){
  if(!S.stage2)return;
  const eventLog=document.getElementById('qEventLog');
  Q_ASSETS.forEach(q=>{
    const surge=Math.random()<0.05;
    const crash=Math.random()<0.04;
    let vol;
    if(surge){vol=q.price*(0.5+Math.random()*1.5);if(eventLog){const d=new Date();eventLog.innerHTML=`<span style="color:var(--ng)">‚ö° QUANTUM SURGE ‚Äî ${q.id} ‚Üë${(vol/q.price*100).toFixed(0)}%!</span> [Day ${S.day}]\n`+eventLog.innerHTML;}}
    else if(crash){vol=-q.price*(0.3+Math.random()*0.5);if(eventLog){eventLog.innerHTML=`<span style="color:#f44">üí• QUANTUM CRASH ‚Äî ${q.id} ‚Üì${(Math.abs(vol)/q.price*100).toFixed(0)}%!</span> [Day ${S.day}]\n`+eventLog.innerHTML;}}
    else{vol=q.price*(Math.random()-0.44)*0.4;}
    q.price=Math.max(10000,Math.round(q.price+vol));
    q.hist.push(q.price);if(q.hist.length>50)q.hist.shift();
  });
  buildQAssetsGrid();
}

const HEIST_MISSIONS=[
  {id:'atm',name:'CRYPTO ATM STING',icon:'üèß',risk:20,crew:2,crewCost:500000,payout:[3000000,8000000],time:2,desc:'Quick smash-and-grab on crypto ATM network. Low risk, moderate reward.'},
  {id:'bank',name:'QUANTUM BANK JOB',icon:'üè¶',risk:45,crew:4,crewCost:5000000,payout:[40000000,120000000],time:5,desc:'Full bank robbery with decoys and EMP. Serious heat but serious cash.'},
  {id:'exchange',name:'EXCHANGE HACK',icon:'üíª',risk:60,crew:3,crewCost:15000000,payout:[200000000,600000000],time:8,desc:'Breach a quantum exchange. Cyber-heist with astronomical upside.'},
  {id:'vault',name:'GOVERNMENT TREASURY',icon:'üèõ',risk:75,crew:6,crewCost:50000000,payout:[800000000,3000000000],time:12,desc:'Inside job on national treasury. Max crew, max risk, max payout.'},
  {id:'moon',name:'LUNAR COLONY VAULT',icon:'üåô',risk:90,crew:8,crewCost:200000000,payout:[5000000000,25000000000],time:20,desc:'The ultimate heist. Off-world vault in the lunar colony. 10% success rate. Insane payout.'}
];
const CREW_MEMBERS=[
  {id:'hacker',name:'ZERO',icon:'üíª',desc:'Elite hacker. Reduces digital risk.',cost:1000000,riskMod:-8},
  {id:'driver',name:'BLAZE',icon:'üöó',desc:'Getaway specialist. Increases escape odds.',cost:800000,riskMod:-5},
  {id:'demo',name:'DANTE',icon:'üí£',desc:'Demolitions expert. Bypasses barriers.',cost:1500000,riskMod:-6},
  {id:'inside',name:'RAVEN',icon:'ü¶Ö',desc:'Inside contact. Intel advantage.',cost:2500000,riskMod:-12},
  {id:'gunner',name:'IRON',icon:'üî´',desc:'Muscle. Extra protection.',cost:700000,riskMod:-3},
  {id:'ghost',name:'SPECTER',icon:'üëª',desc:'Infiltration expert. Reduces detection.',cost:3000000,riskMod:-15}
];
let selectedHeist=null,selectedCrew=new Set(),heistRunning=false;

function buildHeistMissions(){
  const g=document.getElementById('heistMissions');if(!g)return;
  g.innerHTML='';
  HEIST_MISSIONS.forEach(m=>{
    const card=document.createElement('div');card.className='heist-card'+(selectedHeist===m.id?' selected':'');
    card.onclick=()=>selectHeist(m.id);
    const riskColor=m.risk<30?'#39ff14':m.risk<60?'#ffd700':'#f44';
    card.innerHTML=`<div class="heist-name">${m.icon} ${m.name}</div>
      <div class="heist-meta"><span>RISK: ${m.risk}%</span><span>CREW: ${m.crew}+</span><span>PAYOUT: ${fmtN(m.payout[0])}‚Äì${fmtN(m.payout[1])}</span></div>
      <div class="heist-risk-bar"><div class="heist-risk-fill" style="width:${m.risk}%;background:${riskColor}"></div></div>
      <div style="font-size:10px;color:rgba(255,255,255,0.4);font-family:'Orbitron',monospace">${m.desc}</div>`;
    g.appendChild(card);
  });
  buildCrewGrid();
}

function selectHeist(id){
  selectedHeist=id;selectedCrew.clear();
  buildHeistMissions();buildCrewGrid();updHeistStats();
}

function buildCrewGrid(){
  const g=document.getElementById('crewGrid');if(!g)return;
  g.innerHTML='';
  CREW_MEMBERS.forEach(c=>{
    const sel=selectedCrew.has(c.id);
    const div=document.createElement('div');
    div.style.cssText=`padding:10px;border-radius:10px;border:1px solid ${sel?'#ff8c00':'rgba(255,150,0,0.15)'};background:${sel?'rgba(255,150,0,0.12)':'rgba(255,100,0,0.04)'};cursor:pointer;transition:all 0.2s;font-family:'Orbitron',monospace`;
    div.innerHTML=`<div style="font-size:22px;margin-bottom:4px">${c.icon}</div>
      <div style="font-size:11px;font-weight:700;color:#ff8c00">${c.name}</div>
      <div style="font-size:9px;color:rgba(255,255,255,0.4);margin:2px 0">${c.desc}</div>
      <div style="font-size:9px;color:rgba(255,150,0,0.6)">Cost: ${fmtN(c.cost)} | Risk -${Math.abs(c.riskMod)}%</div>`;
    div.onclick=()=>{
      if(sel)selectedCrew.delete(c.id);else selectedCrew.add(c.id);
      buildCrewGrid();updHeistStats();
    };
    g.appendChild(div);
  });
}

function updHeistStats(){
  const m=HEIST_MISSIONS.find(x=>x.id===selectedHeist);
  const crewCostEl=document.getElementById('crewCostLabel');
  const payoutEl=document.getElementById('heistPayoutLabel');
  if(!m){if(crewCostEl)crewCostEl.textContent='$0';if(payoutEl)payoutEl.textContent='$0';return}
  const crewCost=m.crewCost+[...selectedCrew].reduce((a,id)=>{const c=CREW_MEMBERS.find(x=>x.id===id);return a+(c?c.cost:0)},0);
  if(crewCostEl)crewCostEl.textContent=fmtN(crewCost);
  if(payoutEl)payoutEl.textContent=`${fmtN(m.payout[0])} ‚Äì ${fmtN(m.payout[1])}`;
}

const HEIST_EVENTS=[
  ['üö® Alarm triggered ‚Äî switching to Plan B...','Police scanner flooding with chatter...','Security response in 60 seconds...'],
  ['üëÅ Guard spotted. Crew member neutralized the threat.','Silent entry achieved. Moving to vault level...','Biometrics bypassed ‚Äî inner sanctum breached.'],
  ['üíª Encryption cracked. Data transfer at 94%...','Firewall collapsed. We are in the mainframe.','Quantum signature spoofed. System thinks we are authorized.'],
  ['üöó Getaway route clear. Thermal cams looping.','Underground tunnel access confirmed.','Extraction team standing by on rooftop.'],
  ['üí∞ First bag secured. Moving to secondary vault...','Cashier cages open. Crew loading bags.','Quantum keys validated ‚Äî vault sequence initiated.']
];

function launchHeist(){
  if(heistRunning)return;
  if(!selectedHeist){toast('Select a target first!','error');return}
  const m=HEIST_MISSIONS.find(x=>x.id===selectedHeist);
  const totalCrewCost=m.crewCost+[...selectedCrew].reduce((a,id)=>{const c=CREW_MEMBERS.find(x=>x.id===id);return a+(c?c.cost:0)},0);
  if(S.cash<totalCrewCost){toast('Not enough cash for crew!','error');return}
  sfx('click');heistRunning=true;S.cash-=totalCrewCost;updHUD();
  document.getElementById('heistGoBtn').disabled=true;
  let effectiveRisk=m.risk;
  selectedCrew.forEach(id=>{const c=CREW_MEMBERS.find(x=>x.id===id);if(c)effectiveRisk=Math.max(5,effectiveRisk+c.riskMod)});
  const log=document.getElementById('heistLog');
  const res=document.getElementById('heistRes');
  log.innerHTML='<span class="hl">‚ñ∂ OPERATION COMMENCED...</span>';
  res.textContent='';
  let step=0;
  const events=[...HEIST_EVENTS].sort(()=>Math.random()-0.5).slice(0,4);
  function heistStep(){
    if(step<events[0].length+events[1].length){
      const pool=[...events[0],...events[1],...events[2],...events[3]];
      const line=pool[step]||'...';
      log.innerHTML+=`\n<span class="hl">${line}</span>`;
      step++;setTimeout(heistStep,900);
    } else{
      const success=Math.random()*100>effectiveRisk;
      setTimeout(()=>{
        heistRunning=false;document.getElementById('heistGoBtn').disabled=false;
        if(success){
          sfx('jackpot');
          const payout=Math.round(m.payout[0]+Math.random()*(m.payout[1]-m.payout[0]));
          const actual=payout*getMult();S.cash+=actual;S.totalWon+=actual;
          if(actual>S.biggestWin)S.biggestWin=actual;
          log.innerHTML+=`\n<span class="hg">‚úÖ HEIST SUCCESSFUL! ${m.icon}</span>\n<span class="hg">üí∞ PAYOUT: ${fmtN(actual)}</span>`;
          res.style.color='var(--ngr)';res.textContent=`üí∞ HEIST SUCCESS! +${fmtN(actual)}`;
          toast('üî• HEIST COMPLETE! +'+fmtN(actual),'gold');
        } else{
          sfx('boom');
          log.innerHTML+=`\n<span class="hr">üö® MISSION COMPROMISED ‚Äî CREW SCATTERED</span>\n<span class="hr">üí∏ Crew cost lost. No payout.</span>`;
          res.style.color='#f44';res.textContent=`üí• HEIST FAILED ‚Äî Lost ${fmtN(totalCrewCost)}`;
          toast('üö® Heist failed! Crew cost lost.','error');
          S.totalLost+=totalCrewCost;
        }
        updHUD();
      },600);
    }
  }
  heistStep();
}

const ARENA_NAMES=['GHOST_X','CYPH3R','LUNA_BLADE','NEON_KING','VOID_ACE','MATRIX_7','DARKFIRE'];
let arenaPlayers=[],arenaRound=0,arenaAlive=[],arenaEntryFee2=0,arenaPot=0;

function buildArenaBracket(){
  const g=document.getElementById('arenaBracket');if(!g)return;
  if(!arenaPlayers.length){g.innerHTML='<div style="grid-column:1/4;text-align:center;font-family:Orbitron,monospace;font-size:11px;color:rgba(255,0,110,0.4);padding:20px">No active tournament.<br>Enter to begin!</div>';return}
  g.innerHTML='';
  arenaPlayers.forEach((p,i)=>{
    const div=document.createElement('div');
    const dead=!arenaAlive.includes(p);const isYou=p==='YOU ‚òÖ';const winner=arenaAlive.length===1&&arenaAlive[0]===p;
    div.className='arena-slot'+(isYou?' you':dead?' dead':winner?' winner':' alive');
    div.textContent=(isYou?'‚òÖ ':'')+(dead&&!winner?'üíÄ ':winner?'üèÜ ':'')+p;
    g.appendChild(div);
  });
}

function enterArena(){
  if(arenaPlayers.length&&arenaAlive.length>1){toast('Tournament in progress!','error');return}
  arenaEntryFee2=parseFloat(document.getElementById('arenaFee').value)||1000000;
  if(S.cash<arenaEntryFee2){toast('Not enough cash!','error');return}
  sfx('unlock');S.cash-=arenaEntryFee2;
  arenaPlayers=['YOU ‚òÖ',...ARENA_NAMES.sort(()=>Math.random()-0.5).slice(0,7)];
  arenaAlive=[...arenaPlayers];
  arenaRound=0;arenaPot=arenaEntryFee2*8;
  document.getElementById('arenaPrizePot').textContent=fmtN(arenaPot);
  document.getElementById('arenaRoundLabel').textContent='ROUND 0 ‚Äî READY';
  document.getElementById('arenaFightBtn').disabled=false;
  document.getElementById('arenaEnterBtn').disabled=true;
  const log=document.getElementById('arenaLog');
  log.innerHTML=`<span style="color:var(--ng)">‚öîÔ∏è TOURNAMENT BEGINS ‚Äî 8 fighters</span>\nEntry fee: ${fmtN(arenaEntryFee2)} each\nPrize pot: ${fmtN(arenaPot)}\nFighters: ${arenaPlayers.join(', ')}`;
  buildArenaBracket();updHUD();toast('‚öîÔ∏è Arena tournament started!','success');
}

const ARENA_GAMES=['COIN FLIP','DICE ROLL','CARD DRAW','HIGH CARD','DICE RACE'];
function arenaFight(){
  if(arenaAlive.length<=1){toast('Tournament over!','info');return}
  arenaRound++;
  const log=document.getElementById('arenaLog');
  const game=ARENA_GAMES[Math.floor(Math.random()*ARENA_GAMES.length)];
  document.getElementById('arenaRoundLabel').textContent=`ROUND ${arenaRound} ‚Äî ${game}`;
  log.innerHTML+=`\n\n<span style="color:var(--np)">‚ïê‚ïê‚ïê ROUND ${arenaRound}: ${game} ‚ïê‚ïê‚ïê</span>`;
  const thisRoundLoser=[];
  const pairs=[];
  const alive=[...arenaAlive];
  for(let i=0;i<alive.length-1;i+=2)pairs.push([alive[i],alive[i+1]]);
  if(alive.length%2!==0){log.innerHTML+=`\n<span style="color:rgba(255,215,0,0.5)">üéü ${alive[alive.length-1]} gets a bye this round.</span>`}
  let youLost=false;
  pairs.forEach(([a,b])=>{
    const aWins=Math.random()<0.5;const loser=aWins?b:a;const winner=aWins?a:b;
    if(loser==='YOU ‚òÖ')youLost=true;
    thisRoundLoser.push(loser);
    log.innerHTML+=`\n${a} vs ${b} ‚Üí <span style="color:${winner==='YOU ‚òÖ'?'var(--ngr)':'rgba(255,255,255,0.5)'}">${winner} WINS</span>`;
    sfx('flip');
  });
  arenaAlive=arenaAlive.filter(p=>!thisRoundLoser.includes(p));
  buildArenaBracket();
  const roundRes=document.getElementById('arenaRoundRes');
  if(youLost){
    sfx('lose');document.getElementById('arenaFightBtn').disabled=true;
    document.getElementById('arenaEnterBtn').disabled=false;
    arenaPlayers=[];
    roundRes.style.color='#f44';roundRes.textContent=`üíÄ You were eliminated in Round ${arenaRound}!`;
    log.innerHTML+=`\n<span style="color:#f44">üíÄ YOU WERE ELIMINATED.</span>`;
    toast('üíÄ Eliminated in Round '+arenaRound,'error');
  } else if(arenaAlive.length===1&&arenaAlive[0]==='YOU ‚òÖ'){
    sfx('jackpot');const prize=arenaPot*getMult();win(prize,true);
    document.getElementById('arenaFightBtn').disabled=true;document.getElementById('arenaEnterBtn').disabled=false;
    arenaPlayers=[];
    roundRes.style.color='var(--ng)';roundRes.textContent=`üèÜ CHAMPION! +${fmtN(prize)}`;
    log.innerHTML+=`\n<span style="color:var(--ng)">üèÜ YOU ARE THE CHAMPION!</span>\n<span style="color:var(--ng)">üí∞ PRIZE: ${fmtN(prize)}</span>`;
    toast('üèÜ ARENA CHAMPION! +'+fmtN(prize),'gold');
    document.getElementById('arenaRoundLabel').textContent='üèÜ CHAMPION!';
  } else if(arenaAlive.length===1){
    sfx('lose');document.getElementById('arenaFightBtn').disabled=true;
    document.getElementById('arenaEnterBtn').disabled=false;arenaPlayers=[];
    roundRes.style.color='#f44';roundRes.textContent=`The winner was ${arenaAlive[0]}`;
    log.innerHTML+=`\n<span style="color:#aaa">${arenaAlive[0]} wins the tournament.</span>`;
    toast('üíÄ Tournament over ‚Äî you lost!','error');
  } else{
    roundRes.style.color='var(--nc)';roundRes.textContent=`Round ${arenaRound} done ‚Äî ${arenaAlive.length} fighters remain`;
  }
  buildArenaBracket();updHUD();
}

function updSkipUI(){
  const remaining=2-S.daySkipsUsed;
  const btn=document.getElementById('nextDayBtn');
  const lbl=document.getElementById('skipCounter');
  const resetIn=S.daySkipResetAt-S.day;
  if(btn){
    btn.disabled=remaining<=0;
    btn.style.opacity=remaining<=0?'0.35':'1';
  }
  if(lbl){
    if(remaining<=0){
      lbl.textContent=`Skips reset in ${resetIn} day${resetIn!==1?'s':''} (Day ${S.daySkipResetAt})`;
      lbl.style.color='rgba(255,80,80,0.5)';
    } else {
      lbl.textContent=`Skips: ${remaining} / 2 remaining this period`;
      lbl.style.color=remaining===1?'rgba(255,180,0,0.5)':'rgba(255,255,255,0.3)';
    }
  }
}

function manualAdvanceDay(){
  if(S.daySkipsUsed>=2){
    toast('‚õî No skips left! Resets every 12 days.','error');sfx('lose');return;
  }
  S.daySkipsUsed++;
  advanceDay();
  updSkipUI();
}

// ‚îÄ‚îÄ‚îÄ REAL ESTATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const RE_PROPERTIES=[
  {id:'studio',name:'Studio Apartment',icon:'üè†',tier:1,price:10000000,rent:120000,upkeep:15000,maxOwn:5,upgradePrice:5000000,desc:'Entry-level rental in the city.'},
  {id:'office',name:'Downtown Office',icon:'üè¢',tier:2,price:80000000,rent:900000,upkeep:100000,maxOwn:3,upgradePrice:40000000,desc:'High-demand commercial space.'},
  {id:'mall',name:'Luxury Mall',icon:'üõç',tier:3,price:500000000,rent:8000000,upkeep:600000,maxOwn:2,upgradePrice:250000000,desc:'Premium retail complex with anchor tenants.'},
  {id:'tower',name:'Skyscraper Tower',icon:'üèô',tier:4,price:3000000000,rent:60000000,upkeep:4000000,maxOwn:1,upgradePrice:1500000000,desc:'Iconic city landmark. Massive passive income.'},
  {id:'island',name:'Private Island Resort',icon:'üèù',tier:5,price:20000000000,rent:500000000,upkeep:25000000,maxOwn:1,upgradePrice:10000000000,desc:'Exclusive ultra-luxury destination.'},
];
const RE_EVENTS=[
  {name:'Tenant Dispute',icon:'üò°',effect:-0.3,desc:'Tenant refusing to pay ‚Äî rent income down 30% this day.'},
  {name:'Market Boom',icon:'üìà',effect:0.5,desc:'Property values surge! Rent boosted 50% this day.'},
  {name:'Storm Damage',icon:'üå™',effect:-0.5,desc:'Severe storm ‚Äî 50% rent income lost to repairs.'},
  {name:'Tourism Spike',icon:'‚úàÔ∏è',effect:0.8,desc:'Record visitor numbers ‚Äî rent income up 80%!'},
  {name:'Renovation Bonus',icon:'üî®',effect:0.25,desc:'Recent upgrades paying off ‚Äî rent up 25%.'},
];
if(!S.rePortfolio)S.rePortfolio={};
if(!S.reRentAccrued)S.reRentAccrued=0;
if(!S.reEventMult)S.reEventMult=1;

function buildReMarket(){
  const g=document.getElementById('reMarket');if(!g)return;g.innerHTML='';
  RE_PROPERTIES.forEach(p=>{
    const owned=S.rePortfolio[p.id]||{count:0,level:1};
    const canBuy=owned.count<p.maxOwn;
    const div=document.createElement('div');div.className='re-property';
    div.innerHTML=`
      <div class="re-prop-header">
        <div class="re-prop-icon">${p.icon}</div>
        <div>
          <div class="re-prop-name">${p.name}</div>
          <div class="re-prop-tier">TIER ${p.tier} ‚Ä¢ ${p.desc}</div>
        </div>
      </div>
      <div class="re-prop-stats">
        <div class="re-stat"><div class="re-stat-lbl">PRICE</div><div class="re-stat-val">${fmtN(p.price)}</div></div>
        <div class="re-stat"><div class="re-stat-lbl">DAILY RENT</div><div class="re-stat-val" style="color:var(--ngr)">${fmtN(p.rent)}/day</div></div>
        <div class="re-stat"><div class="re-stat-lbl">UPKEEP</div><div class="re-stat-val" style="color:#f44">-${fmtN(p.upkeep)}/day</div></div>
        <div class="re-stat"><div class="re-stat-lbl">NET/DAY</div><div class="re-stat-val">${fmtN(p.rent-p.upkeep)}</div></div>
        <div class="re-stat"><div class="re-stat-lbl">OWNED</div><div class="re-stat-val" style="color:var(--nc)">${owned.count}/${p.maxOwn}</div></div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn btn-gd" onclick="reBuy('${p.id}')" ${!canBuy||S.cash<p.price?'disabled':''} style="font-size:10px">${canBuy?`üè† BUY ${fmtN(p.price)}`:'MAX OWNED'}</button>
        ${owned.count>0?`<button class="btn btn-sl" onclick="reSell('${p.id}')" style="font-size:10px">üí∞ SELL ${fmtN(Math.round(p.price*0.8))}</button>`:''}
      </div>`;
    g.appendChild(div);
  });
}
function reBuy(id){
  const p=RE_PROPERTIES.find(x=>x.id===id);
  if(!p||S.cash<p.price){toast('Not enough cash!','error');return}
  sfx('upgrade');S.cash-=p.price;S.totalLost+=p.price;
  if(!S.rePortfolio[id])S.rePortfolio[id]={count:0,level:1};
  S.rePortfolio[id].count++;
  toast(`üè† Bought ${p.name}!`,'gold');
  buildReMarket();buildRePortfolio();updReStats();updHUD();
  document.getElementById('rePortfolioPanel').style.display='';
}
function reSell(id){
  const p=RE_PROPERTIES.find(x=>x.id===id);
  if(!p||!S.rePortfolio[id]||S.rePortfolio[id].count<=0)return;
  sfx('sell');const val=Math.round(p.price*0.8);
  win(val,true);S.rePortfolio[id].count--;
  if(S.rePortfolio[id].count===0)delete S.rePortfolio[id];
  toast(`üí∞ Sold ${p.name} for ${fmtN(val)}`,'success');
  buildReMarket();buildRePortfolio();updReStats();updHUD();
  if(!Object.keys(S.rePortfolio).length)document.getElementById('rePortfolioPanel').style.display='none';
}
function buildRePortfolio(){
  const g=document.getElementById('rePortfolio');if(!g)return;g.innerHTML='';
  let hasAny=false;
  RE_PROPERTIES.forEach(p=>{
    const owned=S.rePortfolio[p.id];
    if(!owned||owned.count<=0)return;
    hasAny=true;
    const netPerDay=(p.rent-p.upkeep)*owned.count*S.reEventMult;
    const div=document.createElement('div');div.className='re-property';
    div.style.borderColor='rgba(255,215,0,0.25)';
    div.innerHTML=`
      <div class="re-prop-header">
        <div class="re-prop-icon">${p.icon}</div>
        <div><div class="re-prop-name">${p.name} √ó${owned.count}</div>
          <div class="re-prop-tier">Level ${owned.level}</div></div>
      </div>
      <div class="re-prop-stats">
        <div class="re-stat"><div class="re-stat-lbl">NET TODAY</div><div class="re-stat-val" style="color:var(--ngr)">${fmtN(netPerDay)}/day</div></div>
        <div class="re-stat"><div class="re-stat-lbl">TOTAL VALUE</div><div class="re-stat-val">${fmtN(p.price*owned.count)}</div></div>
      </div>`;
    g.appendChild(div);
  });
  if(!hasAny)document.getElementById('rePortfolioPanel').style.display='none';
}
function updReStats(){
  let totalVal=0,dailyRent=0,count=0;
  RE_PROPERTIES.forEach(p=>{
    const owned=S.rePortfolio[p.id];
    if(!owned||!owned.count)return;
    totalVal+=p.price*owned.count;
    dailyRent+=(p.rent-p.upkeep)*owned.count;
    count+=owned.count;
  });
  const tv=document.getElementById('reTotalVal');const dr=document.getElementById('reDailyRent');const rc=document.getElementById('reCount');
  if(tv)tv.textContent=fmtN(totalVal);
  if(dr)dr.textContent=fmtN(dailyRent)+'/day';
  if(rc)rc.textContent=count;
}
function collectRent(){
  if(!S.stage2)return;
  let total=0;
  RE_PROPERTIES.forEach(p=>{
    const owned=S.rePortfolio[p.id];
    if(!owned||!owned.count)return;
    total+=(p.rent-p.upkeep)*owned.count*S.reEventMult;
  });
  if(total<=0)return;
  const actual=total*getMult();win(actual,true);
  // Random event
  if(Math.random()<0.25){
    const evt=RE_EVENTS[Math.floor(Math.random()*RE_EVENTS.length)];
    S.reEventMult=Math.max(0.2,1+evt.effect);
    const log=document.getElementById('reEventLog');
    if(log)log.innerHTML=`<span style="color:var(--ng)">${evt.icon} ${evt.name}</span> ‚Äî ${evt.desc}`;
    setTimeout(()=>{S.reEventMult=1;},90000);
  }
  updReStats();
  if(total>0)toast(`üè† Rent collected: +${fmtN(actual)}`,'gold');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üåÄ  BEYBLADE SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const BEY_LAYERS=[
  {id:'dragoon',name:'DRAGOON',icon:'üêâ',atk:90,def:30,desc:'Aggressive attack layer. Max damage on collision.',
   power:{id:'dragon_rush',name:'Dragon Rush',desc:'Burst speed √ó3 for 2s',cd:12,key:'1'}},
  {id:'wolborg',name:'WOLBORG',icon:'üê∫',atk:40,def:90,desc:'Fortress defense layer. Absorbs knockback.',
   power:{id:'iron_shell',name:'Iron Shell',desc:'Block all damage for 3s',cd:15,key:'1'}},
  {id:'dranzer',name:'DRANZER',icon:'üî•',atk:70,def:70,desc:'Balanced fire type. Great combo potential.',
   power:{id:'flame_surge',name:'Flame Surge',desc:'Ring of fire ‚Äî +150% collision damage for 3s',cd:10,key:'1'}},
  {id:'voltaic',name:'VOLTAIC',icon:'‚ö°',atk:85,def:50,desc:'Electric charge. Surges unpredictably.',
   power:{id:'voltage_spike',name:'Voltage Spike',desc:'Next 3 hits deal √ó3 damage',cd:14,key:'1'}},
];
const BEY_DISCS=[
  {id:'heavy',name:'HEAVY',icon:'‚ö´',stamina:40,weight:90,desc:'Max weight. Crushing impact force.'},
  {id:'spread',name:'SPREAD',icon:'üåÄ',stamina:80,weight:50,desc:'Wide disc. Superior stamina retention.'},
  {id:'wave',name:'WAVE',icon:'„Ä∞Ô∏è',stamina:65,weight:65,desc:'Balanced. Good all-round performance.'},
  {id:'needle',name:'NEEDLE',icon:'üî±',stamina:50,weight:75,desc:'Sharp disc. Extra push on contact.'},
];
const BEY_DRIVERS=[
  {id:'assault',name:'ASSAULT',icon:'üí•',speed:90,control:40,desc:'Aggressive sliding. Huge rush power.',
   power:{id:'rampage',name:'Rampage',desc:'Auto-chase AI at full speed for 4s',cd:16,key:'2'}},
  {id:'defense',name:'DEFENSE',icon:'üõ°',speed:30,control:95,desc:'Rubber tip. Soaks hits near center.',
   power:{id:'anchor',name:'Anchor',desc:'Teleport to center, immune to pushback 3s',cd:12,key:'2'}},
  {id:'orbit',name:'ORBIT',icon:'üåê',speed:60,control:75,desc:'Gyroscopic orbit. Unpredictable path.',
   power:{id:'gyro',name:'Gyro Spin',desc:'Reverse AI orbit tracking for 3s',cd:10,key:'2'}},
  {id:'xtreme',name:'XTREME',icon:'üî¥',speed:85,control:55,desc:'Fastest aggressive driver.',
   power:{id:'turbo',name:'Turbo Boost',desc:'√ó3 speed, ignore arena edge for 3s',cd:13,key:'2'}},
];
const DISC_POWERS={
  heavy:{id:'smash',name:'Impact Smash',desc:'Instantly knock AI back 80px',cd:11,key:'3'},
  spread:{id:'vortex',name:'Spin Vortex',desc:'Pull AI toward you for 2s',cd:10,key:'3'},
  wave:{id:'ripple',name:'Ripple Guard',desc:'Next contact stuns AI for 1.5s',cd:12,key:'3'},
  needle:{id:'pierce',name:'Pierce Strike',desc:'Next hit drains 25% AI stamina',cd:9,key:'3'},
};

let beyBlade=null,beyBattleState=null,beyLoop=null;
let beyKeys={up:false,down:false,left:false,right:false};
let beyPCDs={},beyPA={};

function beyTab(id){
  document.querySelectorAll('[id^="beyt-"]').forEach(b=>b.classList.remove('active'));
  document.getElementById('beyt-'+id).classList.add('active');
  document.getElementById('beyc-build').style.display=id==='build'?'':'none';
  document.getElementById('beyc-battle').style.display=id==='battle'?'':'none';
  if(id==='build')buildBeyWorkshop();
  sfx('click');
}

function buildBeyWorkshop(){
  function grid(cid,parts,type){
    const g=document.getElementById(cid);if(!g)return;g.innerHTML='';
    parts.forEach(p=>{
      const d=document.createElement('div');
      d.className='bey-part'+(beyBlade&&beyBlade[type]===p.id?' selected':'');
      d.innerHTML=`<div class="bey-part-icon">${p.icon}</div><div class="bey-part-name">${p.name}</div><div class="bey-part-desc">${p.desc}</div>`;
      d.onclick=()=>{if(!beyBlade)beyBlade={};beyBlade[type]=p.id;grid(cid,parts,type);renderBladePrev();sfx('click');};
      g.appendChild(d);
    });
  }
  grid('beyLayerGrid',BEY_LAYERS,'layer');
  grid('beyDiscGrid',BEY_DISCS,'disc');
  grid('beyDriverGrid',BEY_DRIVERS,'driver');
  renderBladePrev();
}

function renderBladePrev(){
  const layer=BEY_LAYERS.find(x=>x.id===beyBlade?.layer);
  const disc=BEY_DISCS.find(x=>x.id===beyBlade?.disc);
  const driver=BEY_DRIVERS.find(x=>x.id===beyBlade?.driver);
  const ni=document.getElementById('beyBladeIcon');
  const nn=document.getElementById('beyBladeName');
  const nt=document.getElementById('beyBladeType');
  if(!layer||!disc||!driver){
    if(ni)ni.textContent='üåÄ';if(nn)nn.textContent='INCOMPLETE';if(nt)nt.textContent='Select all 3 parts';
    return;
  }
  if(ni)ni.textContent=layer.icon;
  if(nn)nn.textContent=`${layer.name} ${disc.name} ${driver.name}`;
  if(nt)nt.textContent=`${layer.icon}${disc.icon}${driver.icon}`;
  const stats={ATK:Math.round(layer.atk*.6+disc.weight*.2+driver.speed*.2),DEF:Math.round(layer.def*.6+disc.weight*.3+driver.control*.1),STA:Math.round(disc.stamina*.6+driver.control*.2+(100-layer.atk)*.2),SPD:Math.round(driver.speed*.6+disc.weight*.1+layer.atk*.3)};
  const cols={ATK:'#ff006e',DEF:'#00fff5',STA:'#39ff14',SPD:'#ffd700'};
  const sb=document.getElementById('beyStatBars');
  if(sb)sb.innerHTML=Object.entries(stats).map(([k,v])=>`<div class="bey-stat-row"><div class="bey-stat-lbl">${k}</div><div class="bey-stat-bar"><div class="bey-stat-fill" style="width:${v}%;background:${cols[k]}"></div></div><div class="bey-stat-val">${v}</div></div>`).join('');
  const powers=[layer.power,DISC_POWERS[disc.id],driver.power];
  const pl=document.getElementById('beyPowersList');
  if(pl)pl.innerHTML=powers.map((p,i)=>`<div class="bey-power-card"><div class="bey-power-name">[${i+1}] ${p.name}</div><div style="font-size:8px;color:rgba(255,255,255,0.4);margin-top:2px">${p.desc} ‚Äî ${p.cd}s cooldown</div></div>`).join('');
}

function beyBuild(){
  if(!beyBlade?.layer||!beyBlade?.disc||!beyBlade?.driver){toast('Select Layer + Disc + Driver first!','error');return;}
  sfx('bigwin');renderBladePrev();
  toast('üåÄ Blade forged! Go to Battle tab!','gold');
  document.getElementById('beyBattleStatus').textContent='Ready ‚Äî LET IT RIP!';
}

// ‚îÄ‚îÄ Battle constants ‚îÄ‚îÄ
const BCX=240,BCY=240,BAR=222;

function beyStartBattle(){
  if(!beyBlade?.layer||!beyBlade?.disc||!beyBlade?.driver){toast('Forge a blade first!','error');return;}
  const bet=parseFloat(document.getElementById('beyBet').value)||1000000;
  if(S.cash<bet){toast('Not enough cash!','error');return;}
  sfx('jackpot');lose(bet);updHUD();

  const layer=BEY_LAYERS.find(x=>x.id===beyBlade.layer);
  const disc=BEY_DISCS.find(x=>x.id===beyBlade.disc);
  const driver=BEY_DRIVERS.find(x=>x.id===beyBlade.driver);
  const spd=driver.speed/100*4+1;
  const atk=Math.round(layer.atk*.6+disc.weight*.2+driver.speed*.2);
  const def=Math.round(layer.def*.6+disc.weight*.3+driver.control*.1);

  beyBattleState={
    bet,running:true,frame:0,
    px:BCX-80,py:BCY,pvx:0,pvy:0,pStam:100,prot:0,
    ax:BCX+80,ay:BCY,avx:0,avy:0,aStam:100,arot:0,aAngle:Math.random()*Math.PI*2,
    pAtk:atk,pDef:def,pSpd:spd,
    aAtk:Math.min(90,Math.max(35,100-atk+Math.random()*25-12)),
    aDef:Math.min(90,Math.max(35,100-def+Math.random()*25-12)),
    aSpd:2+Math.random()*1.5,
    shield:false,pierceReady:false,rippleReady:false,vSpike:0,
  };
  const powers=[layer.power,DISC_POWERS[disc.id],driver.power];
  beyBattleState._powers=powers;
  beyPCDs={};beyPA={};
  powers.forEach(p=>{beyPCDs[p.id]=0;beyPA[p.id]=false;});

  // Render power buttons
  const pb=document.getElementById('beyPowerBtns');
  pb.innerHTML=powers.map((p,i)=>`<button class="bey-power-btn ready" id="bpb${i}" onclick="beyActivate(${i})">[${i+1}] ${p.name}</button>`).join('');

  document.getElementById('beyStartBtn').disabled=true;
  document.getElementById('beyStopBtn').disabled=false;
  document.getElementById('beyRes').textContent='';
  document.getElementById('beyRoundLabel').textContent='BATTLE!';
  document.getElementById('beyBattleStatus').textContent='';

  document.addEventListener('keydown',beyKD);
  document.addEventListener('keyup',beyKU);
  if(beyLoop)cancelAnimationFrame(beyLoop);
  beyFrame();
}

function beyKD(e){
  if(e.key==='ArrowUp'||e.key==='w'){beyKeys.up=true;e.preventDefault();}
  if(e.key==='ArrowDown'||e.key==='s'){beyKeys.down=true;e.preventDefault();}
  if(e.key==='ArrowLeft'||e.key==='a'){beyKeys.left=true;e.preventDefault();}
  if(e.key==='ArrowRight'||e.key==='d'){beyKeys.right=true;e.preventDefault();}
  if(e.key==='1')beyActivate(0);
  if(e.key==='2')beyActivate(1);
  if(e.key==='3')beyActivate(2);
}
function beyKU(e){
  if(e.key==='ArrowUp'||e.key==='w')beyKeys.up=false;
  if(e.key==='ArrowDown'||e.key==='s')beyKeys.down=false;
  if(e.key==='ArrowLeft'||e.key==='a')beyKeys.left=false;
  if(e.key==='ArrowRight'||e.key==='d')beyKeys.right=false;
}
function beySetDir(dir,on){beyKeys[dir]=on;}

function beyActivate(idx){
  const b=beyBattleState;if(!b||!b.running)return;
  const p=b._powers[idx];if(!p)return;
  if(beyPCDs[p.id]>0){toast(`${p.name} cooling! ${Math.ceil(beyPCDs[p.id]/60)}s`,'error');return;}
  sfx('upgrade');beyPCDs[p.id]=p.cd*60;
  const id=p.id;
  if(id==='dragon_rush'){b.pSpd*=3;setTimeout(()=>b.pSpd/=3,2000);}
  else if(id==='iron_shell'){b.shield=true;setTimeout(()=>b.shield=false,3000);}
  else if(id==='flame_surge'){beyPA[id]=true;setTimeout(()=>beyPA[id]=false,3000);}
  else if(id==='voltage_spike'){b.vSpike=3;}
  else if(id==='smash'){const dx=b.ax-b.px,dy=b.ay-b.py,d=Math.sqrt(dx*dx+dy*dy)||1;b.avx+=(dx/d)*15;b.avy+=(dy/d)*15;}
  else if(id==='vortex'){beyPA[id]=true;setTimeout(()=>beyPA[id]=false,2000);}
  else if(id==='ripple'){b.rippleReady=true;}
  else if(id==='pierce'){b.pierceReady=true;}
  else if(id==='rampage'){beyPA[id]=true;setTimeout(()=>beyPA[id]=false,4000);}
  else if(id==='anchor'){b.px=BCX;b.py=BCY;b.pvx=0;b.pvy=0;beyPA[id]=true;setTimeout(()=>beyPA[id]=false,3000);}
  else if(id==='gyro'){beyPA[id]=true;setTimeout(()=>beyPA[id]=false,3000);}
  else if(id==='turbo'){b.pSpd*=3;beyPA[id]=true;setTimeout(()=>{b.pSpd/=3;beyPA[id]=false;},3000);}
  toast(`‚ö° ${p.name} ACTIVATED!`,'gold');
}

function beyFrame(){
  const b=beyBattleState;
  if(!b||!b.running){beyLoop=null;return;}
  b.frame++;

  // Tick cooldowns
  b._powers.forEach(p=>{if(beyPCDs[p.id]>0)beyPCDs[p.id]--;});
  if(b.frame%8===0){
    b._powers.forEach((p,i)=>{
      const btn=document.getElementById('bpb'+i);if(!btn)return;
      const cd=beyPCDs[p.id]||0;
      const act=beyPA[p.id];
      if(act){btn.className='bey-power-btn active';btn.textContent=`‚ö° ${p.name}`;}
      else if(cd>0){btn.className='bey-power-btn cooling';btn.textContent=`${p.name} (${Math.ceil(cd/60)}s)`;}
      else{btn.className='bey-power-btn ready';btn.textContent=`[${b._powers.indexOf(p)+1}] ${p.name}`;}
    });
  }

  // Player movement
  if(!beyPA.anchor){
    const acc=b.pSpd*0.3;
    if(beyKeys.up)b.pvy-=acc;
    if(beyKeys.down)b.pvy+=acc;
    if(beyKeys.left)b.pvx-=acc;
    if(beyKeys.right)b.pvx+=acc;
  }
  if(beyPA.vortex){const dx=b.px-b.ax,dy=b.py-b.ay,d=Math.sqrt(dx*dx+dy*dy)||1;b.avx+=(dx/d)*1;b.avy+=(dy/d)*1;}
  if(beyPA.rampage){const dx=b.ax-b.px,dy=b.ay-b.py,d=Math.sqrt(dx*dx+dy*dy)||1;b.pvx+=(dx/d)*b.pSpd*.5;b.pvy+=(dy/d)*b.pSpd*.5;}
  b.pvx*=0.87;b.pvy*=0.87;b.px+=b.pvx;b.py+=b.pvy;
  b.prot+=0.14+b.pSpd*.02;

  // AI orbit logic
  b.aAngle+=(beyPA.gyro?-0.03:0.028);
  const orb=80+Math.sin(b.frame*.035)*28;
  const tx=BCX+Math.cos(b.aAngle)*orb,ty=BCY+Math.sin(b.aAngle)*orb;
  const dax=tx-b.ax,day=ty-b.ay,da=Math.sqrt(dax*dax+day*day)||1;
  b.avx+=(dax/da)*b.aSpd*.2;b.avy+=(day/da)*b.aSpd*.2;
  if(b.frame%80<22){const dx=b.px-b.ax,dy=b.py-b.ay,d=Math.sqrt(dx*dx+dy*dy)||1;b.avx+=(dx/d)*b.aSpd*.35;b.avy+=(dy/d)*b.aSpd*.35;}
  b.avx*=0.89;b.avy*=0.89;b.ax+=b.avx;b.ay+=b.avy;
  b.arot+=0.13;

  // Arena bounce
  function bounce(x,y,vx,vy,ignoreEdge){
    const dx=x-BCX,dy=y-BCY,dist=Math.sqrt(dx*dx+dy*dy);
    const lim=(ignoreEdge?BAR+30:BAR-12);
    if(dist>lim){const nx=dx/dist,ny=dy/dist;x=BCX+nx*lim;y=BCY+ny*lim;const dot=vx*nx+vy*ny;vx-=2*dot*nx;vy-=2*dot*ny;vx*=.55;vy*=.55;return{x,y,vx,vy,oob:true};}
    return{x,y,vx,vy,oob:false};
  }
  let pr=bounce(b.px,b.py,b.pvx,b.pvy,beyPA.turbo);
  b.px=pr.x;b.py=pr.y;b.pvx=pr.vx;b.pvy=pr.vy;
  let ar=bounce(b.ax,b.ay,b.avx,b.avy,false);
  b.ax=ar.x;b.ay=ar.y;b.avx=ar.vx;b.avy=ar.vy;

  // Stamina drain
  b.pStam=Math.max(0,b.pStam-.014-(pr.oob?.07:0));
  b.aStam=Math.max(0,b.aStam-.011-(ar.oob?.09:0));

  // Collision
  const cdx=b.px-b.ax,cdy=b.py-b.ay,cd=Math.sqrt(cdx*cdx+cdy*cdy);
  if(cd<22){
    const nx=cdx/cd,ny=cdy/cd;
    b.px=b.ax+nx*22;b.py=b.ay+ny*22;
    const dmgMult=(beyPA.flame_surge?2.5:1)*(b.vSpike>0?3:1);
    b.avx-=(b.pAtk/100)*dmgMult*nx*3.5;b.avy-=(b.pAtk/100)*dmgMult*ny*3.5;
    b.pvx+=(b.aAtk/100)*nx*1.8;b.pvy+=(b.aAtk/100)*ny*1.8;
    if(!b.shield)b.pStam-=(b.aAtk/100)*2.5*(1-b.pDef/200);
    b.aStam-=(b.pAtk/100)*2.5*(1-b.aDef/200)*dmgMult;
    if(b.vSpike>0){b.vSpike--;if(b.vSpike===0)b.vSpike=0;}
    if(b.pierceReady){b.aStam-=25;b.pierceReady=false;}
    if(b.rippleReady){b.avx*=-2.5;b.avy*=-2.5;b.rippleReady=false;}
    sfx('mine');
  }

  // Draw
  beyDrawFrame(b);

  // Stamina UI
  document.getElementById('beyPlayerStam').style.width=Math.max(0,b.pStam)+'%';
  document.getElementById('beyAiStam').style.width=Math.max(0,b.aStam)+'%';

  // End check
  if(b.pStam<=0||b.aStam<=0||b.frame>3600){
    beyEndBattle(b.aStam<=0&&b.pStam>0,b.frame>3600);return;
  }
  beyLoop=requestAnimationFrame(beyFrame);
}

function beyDrawFrame(b){
  const cv=document.getElementById('beyCanvas');if(!cv)return;
  const ctx=cv.getContext('2d'),W=480,H=480;
  ctx.clearRect(0,0,W,H);
  // Floor
  const g=ctx.createRadialGradient(BCX,BCY,0,BCX,BCY,BAR);
  g.addColorStop(0,'#1a1a3a');g.addColorStop(.7,'#0d0d20');g.addColorStop(1,'#05050f');
  ctx.fillStyle=g;ctx.beginPath();ctx.arc(BCX,BCY,BAR,0,Math.PI*2);ctx.fill();
  // Rings
  [60,120,180,BAR].forEach(r=>{
    ctx.beginPath();ctx.arc(BCX,BCY,r,0,Math.PI*2);
    ctx.strokeStyle=r===BAR?'rgba(255,215,0,0.4)':'rgba(255,215,0,0.05)';
    ctx.lineWidth=r===BAR?2:1;ctx.stroke();
  });
  // Cross
  ctx.strokeStyle='rgba(255,215,0,0.06)';ctx.lineWidth=1;
  [-1,1].forEach(s=>{ctx.beginPath();ctx.moveTo(BCX-BAR,BCY+s*0);ctx.lineTo(BCX+BAR,BCY);ctx.stroke();});
  ctx.beginPath();ctx.moveTo(BCX-BAR,BCY);ctx.lineTo(BCX+BAR,BCY);ctx.stroke();
  ctx.beginPath();ctx.moveTo(BCX,BCY-BAR);ctx.lineTo(BCX,BCY+BAR);ctx.stroke();

  // Power auras
  if(b.shield){
    ctx.save();ctx.strokeStyle='rgba(0,255,245,0.9)';ctx.lineWidth=3;
    ctx.shadowBlur=20;ctx.shadowColor='#00fff5';
    ctx.beginPath();ctx.arc(b.px,b.py,24,0,Math.PI*2);ctx.stroke();ctx.restore();
  }
  if(beyPA.flame_surge){
    ctx.save();const fg=ctx.createRadialGradient(b.px,b.py,0,b.px,b.py,38);
    fg.addColorStop(0,'rgba(255,80,0,.7)');fg.addColorStop(1,'transparent');
    ctx.fillStyle=fg;ctx.beginPath();ctx.arc(b.px,b.py,38,0,Math.PI*2);ctx.fill();ctx.restore();
  }

  // Blades
  function drawBlade(x,y,rot,mainCol,glowCol,lbl){
    ctx.save();ctx.translate(x,y);ctx.rotate(rot);
    ctx.shadowBlur=18;ctx.shadowColor=glowCol;
    ctx.beginPath();ctx.arc(0,0,13,0,Math.PI*2);
    const bg=ctx.createRadialGradient(0,0,2,0,0,13);
    bg.addColorStop(0,mainCol+'ff');bg.addColorStop(1,mainCol+'33');
    ctx.fillStyle=bg;ctx.fill();
    ctx.strokeStyle=glowCol+'bb';ctx.lineWidth=2;
    for(let i=0;i<4;i++){ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(Math.cos(i*Math.PI/2)*11,Math.sin(i*Math.PI/2)*11);ctx.stroke();}
    ctx.shadowBlur=0;ctx.rotate(-rot);
    ctx.font='bold 7px Orbitron,monospace';ctx.textAlign='center';
    ctx.fillStyle='rgba(255,255,255,.85)';ctx.fillText(lbl,0,-20);
    ctx.restore();
  }
  drawBlade(b.px,b.py,b.prot,'#2244cc','#00fff5','YOU');
  drawBlade(b.ax,b.ay,b.arot,'#cc2222','#ff006e','AI');
}

function beyEndBattle(playerWon,timeout){
  const b=beyBattleState;if(!b)return;
  b.running=false;
  if(beyLoop){cancelAnimationFrame(beyLoop);beyLoop=null;}
  document.removeEventListener('keydown',beyKD);
  document.removeEventListener('keyup',beyKU);
  beyKeys={up:false,down:false,left:false,right:false};
  document.getElementById('beyStartBtn').disabled=false;
  document.getElementById('beyStopBtn').disabled=true;

  const bet=b.bet;
  const res=document.getElementById('beyRes');
  const lbl=document.getElementById('beyRoundLabel');
  if(playerWon){
    const prize=bet*2.5*getMult();sfx('jackpot');win(prize,true);
    res.style.color='var(--ngr)';res.textContent=`üèÜ YOUR BLADE WINS! +${fmtN(prize)}`;
    lbl.textContent='CHAMPION!';
    toast('üåÄ BEYBLADE VICTORY! +'+fmtN(prize),'gold');
  } else if(timeout){
    if(b.pStam>b.aStam){
      const prize=bet*1.5*getMult();sfx('win');win(prize,true);
      res.style.color='var(--ng)';res.textContent=`‚è± TIME! You had more stamina! +${fmtN(prize)}`;
      lbl.textContent='TIME WIN!';toast('üåÄ Time win! +'+fmtN(prize),'success');
    } else{
      sfx('lose');res.style.color='#f44';res.textContent=`‚è± TIME! AI had more stamina. Lost ${fmtN(bet)}`;
      lbl.textContent='TIME LOSS';toast('üåÄ AI wins on stamina','error');
    }
  } else{
    sfx('lose');res.style.color='#f44';res.textContent=`üí• KNOCKED OUT! Lost ${fmtN(bet)}`;
    lbl.textContent='DEFEATED!';toast('üåÄ Blade knocked out!','error');
  }
  document.getElementById('beyBattleStatus').textContent='Battle over ‚Äî forge or battle again!';
  updHUD();
}
function beyForfeit(){if(beyBattleState)beyEndBattle(false,false);}

function init(){
  initSlots();renderMinesGrid();buildUpgrades();buildStocksUI();initCrash();
  startPassiveMine();drawWheel(0);drawRoulette(0);buildKenoGrid();
  document.getElementById('btcPrDisp').textContent=S.btcPrice.toLocaleString();
  document.getElementById('sDayNum').textContent=S.day;
  updHUD();updLocks();pcTab('shop');updSkipUI();
  setInterval(advanceDay,90000);
  document.getElementById('invCount').textContent='(0 parts)';
}
init();
</script>
</body>
</html>